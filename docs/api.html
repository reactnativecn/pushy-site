<!doctype html>
<html lang="en">
  <head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>API参考 - Pushy 极速热更新</title>
<link href="/static/css/styles.5863677add.css" rel="stylesheet">
<script defer src="/static/js/styles.b870503bf3.js"></script>
<script defer src="/static/js/lib-react.95becf39cf.js"></script>
<script defer src="/static/js/lib-router.cb3c8eabdf.js"></script>
<script defer src="/static/js/3496.8b35aa0f5c.js"></script>
<script defer src="/static/js/index.3788437e3f.js"></script>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Rspress v2.0.3">
<meta property="og:keywords" content="热更新,hotupdate,免审核,快速上架">
<link rel="icon" href="/logo.svg" type="image/svg+xml">
<meta property="og:type" content="website">
<meta property="og:title" content="API参考 - Pushy 极速热更新">
<meta name="description" content="Pushy 极速热更新">
<meta property="og:description" content="Pushy 极速热更新"></head>

  <body>
    <div id="__rspress_root"><link rel="preload" as="image" href="/images/logo.svg"/><link rel="preload" as="image" href="/static/image/testqrcode.24c22c1ebe.png"/><header class="rp-nav"><div class="rp-nav__left"><div class="rp-nav__title"><a href="/" class="rp-nav__title__link rp-link"><div class="rp-nav__title__logo"><img src="/images/logo.svg" alt="logo" id="logo" class="rspress-logo rp-nav__title__logo-image rp-nav__title__logo-image--light"/><img src="/images/logo.svg" alt="logo" id="logo" class="rspress-logo rp-nav__title__logo-image rp-nav__title__logo-image--dark"/></div><span>Pushy 极速热更新</span></a></div></div><div class="rp-nav__right"><button class="rp-search-button"><div class="rp-search-button__content"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="none" viewBox="0 0 20 21" class="rp-search-button__icon"><path fill="currentColor" d="M8.333 1.913A6.667 6.667 0 0 1 15 8.58c0 1.54-.525 2.957-1.402 4.085l4.49 4.492a.834.834 0 0 1-1.177 1.178l-4.491-4.49a6.64 6.64 0 0 1-4.087 1.402 6.667 6.667 0 0 1 0-13.334m0 1.667a5 5 0 1 0 0 10 5 5 0 0 0 0-10"></path></svg><span class="rp-search-button__word">Search</span></div><div class="rp-search-button__hotkey" style="opacity:0"><span></span><span>K</span></div></button><div class="rp-search-button--mobile"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="none" viewBox="0 0 20 21"><path fill="currentColor" d="M8.333 1.913A6.667 6.667 0 0 1 15 8.58c0 1.54-.525 2.957-1.402 4.085l4.49 4.492a.834.834 0 0 1-1.177 1.178l-4.491-4.49a6.64 6.64 0 0 1-4.087 1.402 6.667 6.667 0 0 1 0-13.334m0 1.667a5 5 0 1 0 0 10 5 5 0 0 0 0-10"></path></svg></div><ul class="rp-nav-menu rp-nav-menu--right"><li class="rp-nav-menu__item rp-nav-menu__item--active"><a href="/index.html" class="rp-nav-menu__item__container rp-link">首页</a></li><li class="rp-nav-menu__item rp-nav-menu__item--active"><a href="/docs/intro.html" class="rp-nav-menu__item__container rp-link">文档</a></li><li class="rp-nav-menu__item"><a href="/pricing.html" class="rp-nav-menu__item__container rp-link">价格</a></li><li class="rp-nav-menu__item"><a href="/docs/faq.html" class="rp-nav-menu__item__container rp-link">常见问题</a></li><li class="rp-nav-menu__item"><a href="https://pushy-admin.reactnative.cn/#/user" target="_blank" rel="noopener noreferrer" class="rp-nav-menu__item__container rp-link">登录</a></li><li class="rp-nav-menu__item"><a href="https://pushy-admin.reactnative.cn/#/register" target="_blank" rel="noopener noreferrer" class="rp-nav-menu__item__container rp-link">注册</a></li></ul><div class="rp-nav__others"><div class="rp-nav-menu__divider"></div><div class="rp-social-links"><a href="https://github.com/reactnativecn/react-native-update" target="_blank" rel="noopener noreferrer" class="rp-social-links__item"><div class="rp-social-links__icon"><div class="rp-social-links__icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 24 24"><path fill="currentColor" d="M12 .297c-6.63 0-12 5.373-12 12c0 5.303 3.438 9.8 8.205 11.385c.6.113.82-.258.82-.577c0-.285-.01-1.04-.015-2.04c-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729c1.205.084 1.838 1.236 1.838 1.236c1.07 1.835 2.809 1.305 3.495.998c.108-.776.417-1.305.76-1.605c-2.665-.3-5.466-1.332-5.466-5.93c0-1.31.465-2.38 1.235-3.22c-.135-.303-.54-1.523.105-3.176c0 0 1.005-.322 3.3 1.23c.96-.267 1.98-.399 3-.405c1.02.006 2.04.138 3 .405c2.28-1.552 3.285-1.23 3.285-1.23c.645 1.653.24 2.873.12 3.176c.765.84 1.23 1.91 1.23 3.22c0 4.61-2.805 5.625-5.475 5.92c.42.36.81 1.096.81 2.22c0 1.606-.015 2.896-.015 3.286c0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></div></div></a><ul class="rp-hover-group rp-hover-group--hidden rp-hover-group--right"></ul></div></div><button aria-label="mobile hamburger" class="rp-nav-hamburger rp-nav-hamburger__sm"><svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" fill="none" viewBox="0 0 21 21"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.667" d="M3.645 5.225h13.333M3.645 10.225h13.333M3.645 15.225h13.333"></path></svg></button><button aria-label="mobile hamburger" class="rp-nav-hamburger rp-nav-hamburger__md"><svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" fill="none" viewBox="0 0 21 21"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.667" d="M3.645 5.225h13.333M3.645 10.225h13.333M3.645 15.225h13.333"></path></svg><ul class="rp-hover-group rp-hover-group--hidden rp-hover-group--right"><div class="rp-nav-menu__others-mobile__container"><div class="rp-nav-hamburger__md__hover-group"><div class="rp-nav-screen-divider"></div><div class="rp-social-links"><a href="https://github.com/reactnativecn/react-native-update" target="_blank" rel="noopener noreferrer" class="rp-social-links__item"><div class="rp-social-links__icon"><div class="rp-social-links__icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 24 24"><path fill="currentColor" d="M12 .297c-6.63 0-12 5.373-12 12c0 5.303 3.438 9.8 8.205 11.385c.6.113.82-.258.82-.577c0-.285-.01-1.04-.015-2.04c-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729c1.205.084 1.838 1.236 1.838 1.236c1.07 1.835 2.809 1.305 3.495.998c.108-.776.417-1.305.76-1.605c-2.665-.3-5.466-1.332-5.466-5.93c0-1.31.465-2.38 1.235-3.22c-.135-.303-.54-1.523.105-3.176c0 0 1.005-.322 3.3 1.23c.96-.267 1.98-.399 3-.405c1.02.006 2.04.138 3 .405c2.28-1.552 3.285-1.23 3.285-1.23c.645 1.653.24 2.873.12 3.176c.765.84 1.23 1.91 1.23 3.22c0 4.61-2.805 5.625-5.475 5.92c.42.36.81 1.096.81 2.22c0 1.606-.015 2.896-.015 3.286c0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></div></div></a><ul class="rp-hover-group rp-hover-group--hidden rp-hover-group--right"></ul></div></div></div></ul></button></div></header><div class="rp-doc-layout__menu"><div class="rp-sidebar-menu"><button type="button" class="rp-sidebar-menu__left"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M4 6h24v2H4zm0 18h24v2H4zm0-12h24v2H4zm0 6h24v2H4z"></path></svg><span>Menu</span></button><button type="button" class="rp-sidebar-menu__right"><span class="rp-sidebar-menu__right__text">ON THIS PAGE</span><svg width="14" height="14" class="rp-progress-circle"><circle cx="7" cy="7" r="6" stroke-linecap="round" fill="none" stroke="var(--rp-c-divider-light)" stroke-width="2"></circle><circle cx="7" cy="7" r="6" stroke-linecap="round" fill="none" stroke="var(--rp-c-brand)" stroke-width="2" stroke-dasharray="37.69911184307752" stroke-dashoffset="37.69911184307752" transform="rotate(-90 7 7)" style="transition:stroke-dashoffset 0.3s"></circle></svg><svg width="1em" height="1em" viewBox="0 0 32 32" class="rp-sidebar-menu__right__icon" style="transform:rotate(0deg);transition:transform 0.2s ease-out"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></button></div></div><div class="rp-doc-layout__container"><aside class="rp-doc-layout__sidebar rp-scrollbar"><div class="rp-sidebar-item rp-sidebar-group" style="padding-left:12px" data-depth="0"><div class="rp-sidebar-item__left"><span>快速入门</span></div><div class="rp-sidebar-item__right"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(90deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div style="display:grid;grid-template-rows:1fr;transition:grid-template-rows 0.2s ease-out"><div style="overflow:hidden"><a href="/docs/intro.html" class="rp-sidebar-item rp-sidebar-item--group-item rp-link" style="padding-left:calc(12px * 1 + 12px)" data-depth="1"><div class="rp-sidebar-item__left"><span>产品简介</span></div><div class="rp-sidebar-item__right"></div></a><a href="/docs/getting-started.html" class="rp-sidebar-item rp-sidebar-item--group-item rp-link" style="padding-left:calc(12px * 1 + 12px)" data-depth="1"><div class="rp-sidebar-item__left"><span>安装配置</span></div><div class="rp-sidebar-item__right"></div></a><a href="/docs/integration.html" class="rp-sidebar-item rp-sidebar-item--group-item rp-link" style="padding-left:calc(12px * 1 + 12px)" data-depth="1"><div class="rp-sidebar-item__left"><span>代码集成</span></div><div class="rp-sidebar-item__right"></div></a><a href="/docs/publish.html" class="rp-sidebar-item rp-sidebar-item--group-item rp-link" style="padding-left:calc(12px * 1 + 12px)" data-depth="1"><div class="rp-sidebar-item__left"><span>发布流程</span></div><div class="rp-sidebar-item__right"></div></a></div></div><div class="rp-sidebar-item rp-sidebar-group" style="padding-left:12px" data-depth="0"><div class="rp-sidebar-item__left"><span>高阶用法</span></div><div class="rp-sidebar-item__right"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(90deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div style="display:grid;grid-template-rows:1fr;transition:grid-template-rows 0.2s ease-out"><div style="overflow:hidden"><a href="/docs/api.html" class="rp-sidebar-item rp-sidebar-item--active rp-sidebar-item--group-item rp-link" style="padding-left:calc(12px * 1 + 12px)" data-depth="1"><div class="rp-sidebar-item__left"><span>API 文档</span></div><div class="rp-sidebar-item__right"></div></a><a href="/docs/api-token.html" class="rp-sidebar-item rp-sidebar-item--group-item rp-link" style="padding-left:calc(12px * 1 + 12px)" data-depth="1"><div class="rp-sidebar-item__left"><span>API Token</span></div><div class="rp-sidebar-item__right"></div></a><a href="/docs/cli.html" class="rp-sidebar-item rp-sidebar-item--group-item rp-link" style="padding-left:calc(12px * 1 + 12px)" data-depth="1"><div class="rp-sidebar-item__left"><span>命令行工具（内置）</span></div><div class="rp-sidebar-item__right"></div></a><a href="/docs/cli_module.html" class="rp-sidebar-item rp-sidebar-item--group-item rp-link" style="padding-left:calc(12px * 1 + 12px)" data-depth="1"><div class="rp-sidebar-item__left"><span>命令行工具（自定义模块）</span></div><div class="rp-sidebar-item__right"></div></a><a href="/docs/bestpractice.html" class="rp-sidebar-item rp-sidebar-item--group-item rp-link" style="padding-left:calc(12px * 1 + 12px)" data-depth="1"><div class="rp-sidebar-item__left"><span>场景实践</span></div><div class="rp-sidebar-item__right"></div></a><a href="/docs/skills.html" class="rp-sidebar-item rp-sidebar-item--group-item rp-link" style="padding-left:calc(12px * 1 + 12px)" data-depth="1"><div class="rp-sidebar-item__left"><span>Skills 安装与使用</span></div><div class="rp-sidebar-item__right"></div></a></div></div><div class="rp-sidebar-item rp-sidebar-group" style="padding-left:12px" data-depth="0"><div class="rp-sidebar-item__left"><span>其他</span></div><div class="rp-sidebar-item__right"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(90deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div style="display:grid;grid-template-rows:1fr;transition:grid-template-rows 0.2s ease-out"><div style="overflow:hidden"><a href="/docs/faq.html" class="rp-sidebar-item rp-sidebar-item--group-item rp-link" style="padding-left:calc(12px * 1 + 12px)" data-depth="1"><div class="rp-sidebar-item__left"><span>常见问题</span></div><div class="rp-sidebar-item__right"></div></a></div></div></aside><div class="rp-doc-layout__doc"><main class="rp-doc-layout__doc-container"><div class="rp-doc rspress-doc"><h1 class="rp-toc-include" id="api参考"><span>API参考</span><a href="#api参考" class="rp-header-anchor rp-link" aria-hidden="true">#</a> </h1><!--$--><h3 class="rp-toc-include" id="javascript-方法"><a href="#javascript-方法" class="rp-header-anchor rp-link" aria-hidden="true">#</a>JavaScript 方法</h3>
<h4 class="rp-toc-include" id="new-pushyoptions-pushyoptions"><a href="#new-pushyoptions-pushyoptions" class="rp-header-anchor rp-link" aria-hidden="true">#</a>new Pushy(options: PushyOptions)</h4>
<p>创建 Pushy 热更新服务实例，其构造参数如下：</p>
<div class="rp-codeblock language-ts"><div class="rp-codeblock__content"><div class="rp-codeblock__content__scroll-container rp-scrollbar rp-scrollbar--always"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0" data-lang="ts"><code><span class="line"><span style="color:var(--shiki-token-keyword)">interface</span><span style="color:var(--shiki-token-function)"> PushyOptions</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 必填，通过pushy createApp或selectApp命令，或在网页管理端获取</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">  appKey</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-constant)"> string</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 自定义日志输出，也可用于上报统计数据</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">  logger</span><span style="color:var(--shiki-token-keyword)">?:</span><span style="color:var(--shiki-foreground)"> ({ type</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-foreground)"> data }</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-foreground)"> { type</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> EventType</span><span style="color:var(--shiki-foreground)">; data</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> EventData</span><span style="color:var(--shiki-foreground)"> }) </span><span style="color:var(--shiki-token-keyword)">=&gt;</span><span style="color:var(--shiki-token-constant)"> void</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 触发自动检查更新的策略</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">  checkStrategy</span><span style="color:var(--shiki-token-keyword)">?:</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">    |</span><span style="color:var(--shiki-token-string-expression)"> &quot;onAppStart&quot;</span><span style="color:var(--shiki-token-comment)"> // 仅在app启动时</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">    |</span><span style="color:var(--shiki-token-string-expression)"> &quot;onAppResume&quot;</span><span style="color:var(--shiki-token-comment)"> // 仅在app从后台切换到前台时</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">    |</span><span style="color:var(--shiki-token-string-expression)"> &quot;both&quot;</span><span style="color:var(--shiki-foreground)">; </span><span style="color:var(--shiki-token-comment)">// 默认值，同时包含前两个场景</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">    |</span><span style="color:var(--shiki-foreground)"> null; </span><span style="color:var(--shiki-token-comment)">// 不自动检查更新，必须手动调用checkUpdate方法，此选项需 v10.4.2+ 版本</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 自动下载和应用更新的策略</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">  updateStrategy</span><span style="color:var(--shiki-token-keyword)">?:</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">    |</span><span style="color:var(--shiki-token-string-expression)"> &quot;alwaysAlert&quot;</span><span style="color:var(--shiki-token-comment)"> // 调试环境（__DEV__）默认值，使用系统默认的alert页面提示热更且会在有报错时弹出提示</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">    |</span><span style="color:var(--shiki-token-string-expression)"> &quot;alertUpdateAndIgnoreError&quot;</span><span style="color:var(--shiki-token-comment)"> // 生产环境默认值，在有热更时使用系统默认的alert页面提示热更，但不弹出任何报错提示</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">    |</span><span style="color:var(--shiki-token-string-expression)"> &quot;silentAndNow&quot;</span><span style="color:var(--shiki-token-comment)"> // 自动静默下载并立刻应用热更</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">    |</span><span style="color:var(--shiki-token-string-expression)"> &quot;silentAndLater&quot;</span><span style="color:var(--shiki-foreground)">; </span><span style="color:var(--shiki-token-comment)">// 自动静默下载，但仅在用户退出app后重启时应用更新</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">    |</span><span style="color:var(--shiki-foreground)"> null; </span><span style="color:var(--shiki-token-comment)">// 不自动下载和应用更新，如需自定义热更界面请选择此项</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 是否在热更重启后自动标记为成功，默认为true</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 一般情况下不建议手动标记</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">  autoMarkSuccess</span><span style="color:var(--shiki-token-keyword)">?:</span><span style="color:var(--shiki-token-constant)"> boolean</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 是否在若干ms后自动清除最后的报错，默认为不清除</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">  dismissErrorAfter</span><span style="color:var(--shiki-token-keyword)">?:</span><span style="color:var(--shiki-token-constant)"> number</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 是否在开发环境中检查热更，默认为false。如需在开发环境中调试热更，请打开此选项。</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 但即便打开此选项，也仅能检查、下载热更，并不能实际应用热更。实际应用热更必须在release包中进行。</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 此选项需 v10.4.2+ 版本</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">  debug</span><span style="color:var(--shiki-token-keyword)">?:</span><span style="color:var(--shiki-token-constant)"> boolean</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 是否在调用 checkUpdate 和 downloadUpdate 时抛出错误，默认为不抛出错误，通过 lastError 获取错误信息</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 启用后可以使用 try catch 语句 捕获错误，同时 lastError 也仍然可用</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // try {</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  //   await checkUpdate();</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // } catch (e) {</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  //   console.error(e);</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // }</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 此选项需 v10.15.2+ 版本</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">  throwError</span><span style="color:var(--shiki-token-keyword)">?:</span><span style="color:var(--shiki-token-constant)"> boolean</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 在检查更新前执行，返回 false 则取消检查更新</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 此选项需 v10.12.0+ 版本</span></span>
<span class="line"><span style="color:var(--shiki-token-function)">  beforeCheckUpdate</span><span style="color:var(--shiki-token-keyword)">?:</span><span style="color:var(--shiki-foreground)"> () </span><span style="color:var(--shiki-token-keyword)">=&gt;</span><span style="color:var(--shiki-token-function)"> Promise</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-constant)">boolean</span><span style="color:var(--shiki-foreground)">&gt;;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 在下载更新前执行，返回 false 则取消下载更新，可以配合自定义的 metaInfo 做一些条件控制</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 此选项需 v10.12.0+ 版本</span></span>
<span class="line"><span style="color:var(--shiki-token-function)">  beforeDownloadUpdate</span><span style="color:var(--shiki-token-keyword)">?:</span><span style="color:var(--shiki-foreground)"> (info</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> UpdateInfo</span><span style="color:var(--shiki-foreground)">) </span><span style="color:var(--shiki-token-keyword)">=&gt;</span><span style="color:var(--shiki-token-function)"> Promise</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-constant)">boolean</span><span style="color:var(--shiki-foreground)">&gt;;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 在下载更新后执行，返回 false 则取消内置策略进一步执行，可以配合自定义的 metaInfo 做一些条件控制</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 此选项需 v10.27.0+ 版本</span></span>
<span class="line"><span style="color:var(--shiki-token-function)">  afterDownloadUpdate</span><span style="color:var(--shiki-token-keyword)">?:</span><span style="color:var(--shiki-foreground)"> (info</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> UpdateInfo</span><span style="color:var(--shiki-foreground)">) </span><span style="color:var(--shiki-token-keyword)">=&gt;</span><span style="color:var(--shiki-token-function)"> Promise</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-constant)">boolean</span><span style="color:var(--shiki-foreground)">&gt;;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 在原生包过期时执行，返回 false 则取消内置策略进一步执行，可以配合自定义的 metaInfo 做一些条件控制</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 此选项需 v10.28.2+ 版本</span></span>
<span class="line"><span style="color:var(--shiki-token-function)">  onPackageExpired</span><span style="color:var(--shiki-token-keyword)">?:</span><span style="color:var(--shiki-foreground)"> (info</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> UpdateInfo</span><span style="color:var(--shiki-foreground)">) </span><span style="color:var(--shiki-token-keyword)">=&gt;</span><span style="color:var(--shiki-token-function)"> Promise</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-constant)">boolean</span><span style="color:var(--shiki-foreground)">&gt;;</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)">// 日志事件类型</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">type</span><span style="color:var(--shiki-token-function)"> EventType</span><span style="color:var(--shiki-token-keyword)"> =</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 更新失败，重启后发生回滚</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">  |</span><span style="color:var(--shiki-token-string-expression)"> &quot;rollback&quot;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 检查更新时报错</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">  |</span><span style="color:var(--shiki-token-string-expression)"> &quot;errorChecking&quot;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 正在发起检查</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">  |</span><span style="color:var(--shiki-token-string-expression)"> &quot;checking&quot;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 正在下载更新</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">  |</span><span style="color:var(--shiki-token-string-expression)"> &quot;downloading&quot;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 已下载更新</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">  |</span><span style="color:var(--shiki-token-string-expression)"> &quot;downloadSuccess&quot;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 更新失败</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">  |</span><span style="color:var(--shiki-token-string-expression)"> &quot;errorUpdate&quot;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 更新成功</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">  |</span><span style="color:var(--shiki-token-string-expression)"> &quot;markSuccess&quot;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 下载apk</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">  |</span><span style="color:var(--shiki-token-string-expression)"> &quot;downloadingApk&quot;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 下载apk前申请存储权限被用户拒绝</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">  |</span><span style="color:var(--shiki-token-string-expression)"> &quot;rejectStoragePermission&quot;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 下载apk前申请存储权限发生错误</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">  |</span><span style="color:var(--shiki-token-string-expression)"> &quot;errorStoragePermission&quot;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 下载apk时发生错误</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">  |</span><span style="color:var(--shiki-token-string-expression)"> &quot;errorDownloadAndInstallApk&quot;</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)">// 日志事件数据</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">interface</span><span style="color:var(--shiki-token-function)"> EventData</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 当前已完成的热更hash值，如尚未热更则为空字符串</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">  currentVersion</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-constant)"> string</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 客户端版本信息</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">  cInfo</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    rnu</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-constant)"> string</span><span style="color:var(--shiki-foreground)">; </span><span style="color:var(--shiki-token-comment)">// 当前 react-native-update 版本</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    rn</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-constant)"> string</span><span style="color:var(--shiki-foreground)">; </span><span style="color:var(--shiki-token-comment)">// 当前 react-native 版本</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    os</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-constant)"> string</span><span style="color:var(--shiki-foreground)">; </span><span style="color:var(--shiki-token-comment)">// 当前操作系统及版本</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    uuid</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-constant)"> string</span><span style="color:var(--shiki-foreground)">; </span><span style="color:var(--shiki-token-comment)">// 用户标识符</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">  };</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 客户端原生版本号</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">  packageVersion</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-constant)"> string</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 编译时间戳</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">  buildTime</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-constant)"> number</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 报错相关的信息</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">  message</span><span style="color:var(--shiki-token-keyword)">?:</span><span style="color:var(--shiki-token-constant)"> string</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 发生回滚的版本hash值</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">  rolledBackVersion</span><span style="color:var(--shiki-token-keyword)">?:</span><span style="color:var(--shiki-token-constant)"> string</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 更新失败的新版本hash值</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">  newVersion</span><span style="color:var(--shiki-token-keyword)">?:</span><span style="color:var(--shiki-token-constant)"> string</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 其他一些数据</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">  [key</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-constant)"> string</span><span style="color:var(--shiki-foreground)">]</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-constant)"> any</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div><div class="rp-code-button-group"><button class="rp-code-button-group__button rp-code-wrap-button" title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="rp-code-button-group__icon rp-code-button-group__icon--wrapped"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="rp-code-button-group__icon rp-code-button-group__icon--wrap"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="rp-code-button-group__button rp-code-copy-button" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="rp-code-button-group__icon rp-code-copy-button__icon rp-code-copy-button__icon--copy"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="rp-code-button-group__icon rp-code-copy-button__icon rp-code-copy-button__icon--success"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<h4 class="rp-toc-include" id="useupdate"><a href="#useupdate" class="rp-header-anchor rp-link" aria-hidden="true">#</a>useUpdate()</h4>
<p>热更相关的工具函数。此方法也可使用别名 <code>usePushy</code> 引入。</p>
<div class="rp-callout rp-callout--info"><div class="rp-callout__title">Info</div><div class="rp-callout__content"><p>
注意，在使用 <code>&lt;UpdateProvider&gt;</code> 的当前组件（一般是根组件）中无法直接调用<code>useUpdate</code>，只有当前组件的子组件才能调用。</p></div></div>
<div class="rp-codeblock language-js"><div class="rp-codeblock__content"><div class="rp-codeblock__content__scroll-container rp-scrollbar rp-scrollbar--always"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0" data-lang="js"><code><span class="line"><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-constant)">  checkUpdate</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-token-constant)">  switchVersion</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-token-constant)">  switchVersionLater</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-token-constant)">  markSuccess</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-token-constant)">  dismissError</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-token-constant)">  downloadUpdate</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-token-constant)">  downloadAndInstallApk</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-token-constant)">  getCurrentVersionInfo</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-token-constant)">  currentVersionInfo</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-token-constant)">  parseTestQrCode</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-token-constant)">  currentHash</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-token-constant)">  packageVersion</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-token-constant)">  client</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-token-constant)">  progress</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-token-constant)">  updateInfo</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-token-constant)">  lastError</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-token-constant)">  restartApp</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">} </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-function)"> useUpdate</span><span style="color:var(--shiki-foreground)">();</span></span></code></pre></div><div class="rp-code-button-group"><button class="rp-code-button-group__button rp-code-wrap-button" title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="rp-code-button-group__icon rp-code-button-group__icon--wrapped"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="rp-code-button-group__icon rp-code-button-group__icon--wrap"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="rp-code-button-group__button rp-code-copy-button" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="rp-code-button-group__icon rp-code-copy-button__icon rp-code-copy-button__icon--copy"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="rp-code-button-group__icon rp-code-copy-button__icon rp-code-copy-button__icon--success"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p>其类型定义和功能如下：</p>
<div class="rp-codeblock language-ts"><div class="rp-codeblock__content"><div class="rp-codeblock__content__scroll-container rp-scrollbar rp-scrollbar--always"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0" data-lang="ts"><code><span class="line"><span style="color:var(--shiki-token-keyword)">interface</span><span style="color:var(--shiki-token-function)"> UpdateContext</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 检查更新（注意在 v10.26.0 版本之前，`checkUpdate`方法本身没有返回值，只能从`useUpdate()`返回的`updateInfo`中获取）</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 我们也仍然推荐优先从`useUpdate()`中获取`updateInfo`</span></span>
<span class="line"><span style="color:var(--shiki-token-function)">  checkUpdate</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-foreground)"> () </span><span style="color:var(--shiki-token-keyword)">=&gt;</span><span style="color:var(--shiki-token-function)"> Promise</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-constant)">void</span><span style="color:var(--shiki-token-keyword)"> |</span><span style="color:var(--shiki-token-function)"> UpdateInfo</span><span style="color:var(--shiki-foreground)">&gt;;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 下载热更完成后调用，立即重启切换新版本</span></span>
<span class="line"><span style="color:var(--shiki-token-function)">  switchVersion</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-foreground)"> () </span><span style="color:var(--shiki-token-keyword)">=&gt;</span><span style="color:var(--shiki-token-constant)"> void</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 下载热更完成后调用，用户手动重启app后切换新版本（静默更新）</span></span>
<span class="line"><span style="color:var(--shiki-token-function)">  switchVersionLater</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-foreground)"> () </span><span style="color:var(--shiki-token-keyword)">=&gt;</span><span style="color:var(--shiki-token-constant)"> void</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 热更完成重启后，手动标记热更完成</span></span>
<span class="line"><span style="color:var(--shiki-token-function)">  markSuccess</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-foreground)"> () </span><span style="color:var(--shiki-token-keyword)">=&gt;</span><span style="color:var(--shiki-token-constant)"> void</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 清除最后的报错状态</span></span>
<span class="line"><span style="color:var(--shiki-token-function)">  dismissError</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-foreground)"> () </span><span style="color:var(--shiki-token-keyword)">=&gt;</span><span style="color:var(--shiki-token-constant)"> void</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 下载热更, v10.16.0+ 版本返回值为`boolean`，表示是否下载成功</span></span>
<span class="line"><span style="color:var(--shiki-token-function)">  downloadUpdate</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-foreground)"> () </span><span style="color:var(--shiki-token-keyword)">=&gt;</span><span style="color:var(--shiki-token-function)"> Promise</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-constant)">boolean</span><span style="color:var(--shiki-token-keyword)"> |</span><span style="color:var(--shiki-token-constant)"> void</span><span style="color:var(--shiki-foreground)">&gt;;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 下载并安装apk</span></span>
<span class="line"><span style="color:var(--shiki-token-function)">  downloadAndInstallApk</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-foreground)"> (url</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-constant)"> string</span><span style="color:var(--shiki-foreground)">) </span><span style="color:var(--shiki-token-keyword)">=&gt;</span><span style="color:var(--shiki-token-function)"> Promise</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-constant)">void</span><span style="color:var(--shiki-foreground)">&gt;;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 异步获取当前已热更版本的信息，v10.31.2 版本后用 `currentVersionInfo` 代替</span></span>
<span class="line"><span style="color:var(--shiki-token-function)">  getCurrentVersionInfo</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-foreground)"> () </span><span style="color:var(--shiki-token-keyword)">=&gt;</span><span style="color:var(--shiki-token-function)"> Promise</span><span style="color:var(--shiki-foreground)">&lt;{</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    name</span><span style="color:var(--shiki-token-keyword)">?:</span><span style="color:var(--shiki-token-constant)"> string</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    description</span><span style="color:var(--shiki-token-keyword)">?:</span><span style="color:var(--shiki-token-constant)"> string</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    metaInfo</span><span style="color:var(--shiki-token-keyword)">?:</span><span style="color:var(--shiki-token-constant)"> string</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">  }&gt;;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 当前已热更版本的信息，需 v10.31.2+ 版本</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">  currentVersionInfo</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    name</span><span style="color:var(--shiki-token-keyword)">?:</span><span style="color:var(--shiki-token-constant)"> string</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    description</span><span style="color:var(--shiki-token-keyword)">?:</span><span style="color:var(--shiki-token-constant)"> string</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    metaInfo</span><span style="color:var(--shiki-token-keyword)">?:</span><span style="color:var(--shiki-token-constant)"> string</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">  };</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 解析测试二维码，此方法需 v10.11.2+ 版本</span></span>
<span class="line"><span style="color:var(--shiki-token-function)">  parseTestQrCode</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-foreground)"> (qrCode</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-constant)"> string</span><span style="color:var(--shiki-foreground)">) </span><span style="color:var(--shiki-token-keyword)">=&gt;</span><span style="color:var(--shiki-token-constant)"> void</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 当前的版本hash</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">  currentHash</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-constant)"> string</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 当前的原生版本号</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">  packageVersion</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-constant)"> string</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 当前的pushy热更服务实例</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">  client</span><span style="color:var(--shiki-token-keyword)">?:</span><span style="color:var(--shiki-token-function)"> Pushy</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 下载开始后的进度数据</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">  progress</span><span style="color:var(--shiki-token-keyword)">?:</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    hash</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-constant)"> string</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">    // 已下载的字节数</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    received</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-constant)"> number</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">    // 待下载的总字节数</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    total</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-constant)"> number</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">  };</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 热更相关信息</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">  updateInfo</span><span style="color:var(--shiki-token-keyword)">?:</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">    // 已是最新版本，无需热更</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    upToDate</span><span style="color:var(--shiki-token-keyword)">?:</span><span style="color:var(--shiki-token-constant)"> true</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">    // 当前原生版本已过期，需要下载新的原生版本</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    expired</span><span style="color:var(--shiki-token-keyword)">?:</span><span style="color:var(--shiki-token-constant)"> true</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">    // 在pushy网页管理端设置的原生版本下载地址</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    downloadUrl</span><span style="color:var(--shiki-token-keyword)">?:</span><span style="color:var(--shiki-token-constant)"> string</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">    // 是否存在新的热更</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    update</span><span style="color:var(--shiki-token-keyword)">?:</span><span style="color:var(--shiki-token-constant)"> true</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">    // 新热更的版本名称</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    name</span><span style="color:var(--shiki-token-keyword)">?:</span><span style="color:var(--shiki-token-constant)"> string</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">    // 新热更的hash值</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    hash</span><span style="color:var(--shiki-token-keyword)">?:</span><span style="color:var(--shiki-token-constant)"> string</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">    // 新热更的更新说明</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    description</span><span style="color:var(--shiki-token-keyword)">?:</span><span style="color:var(--shiki-token-constant)"> string</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">    // 新热更携带的额外元数据</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    metaInfo</span><span style="color:var(--shiki-token-keyword)">?:</span><span style="color:var(--shiki-token-constant)"> string</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">    // 当前热更是否已暂停</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    paused</span><span style="color:var(--shiki-token-keyword)">?:</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">      |</span><span style="color:var(--shiki-token-string-expression)"> &quot;app&quot;</span><span style="color:var(--shiki-token-comment)"> // 当前应用所有原生版本暂停</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">      |</span><span style="color:var(--shiki-token-string-expression)"> &quot;package&quot;</span><span style="color:var(--shiki-token-comment)"> // 仅当前原生版本暂停</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">      |</span><span style="color:var(--shiki-token-string-expression)"> &quot;quota&quot;</span><span style="color:var(--shiki-foreground)">; </span><span style="color:var(--shiki-token-comment)">// 因检查次数超限而暂停</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">    // 其他信息</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    message</span><span style="color:var(--shiki-token-keyword)">?:</span><span style="color:var(--shiki-token-constant)"> string</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">  };</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">  // 检查、下载、应用热更等过程中的最近一次报错</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">  lastError</span><span style="color:var(--shiki-token-keyword)">?:</span><span style="color:var(--shiki-token-function)"> Error</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div><div class="rp-code-button-group"><button class="rp-code-button-group__button rp-code-wrap-button" title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="rp-code-button-group__icon rp-code-button-group__icon--wrapped"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="rp-code-button-group__icon rp-code-button-group__icon--wrap"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="rp-code-button-group__button rp-code-copy-button" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="rp-code-button-group__icon rp-code-copy-button__icon rp-code-copy-button__icon--copy"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="rp-code-button-group__icon rp-code-copy-button__icon rp-code-copy-button__icon--success"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<hr/>
<h4 class="rp-toc-include" id="async-function-checkupdate"><a href="#async-function-checkupdate" class="rp-header-anchor rp-link" aria-hidden="true">#</a>async function checkUpdate()</h4>
<p>触发更新检查，返回<code>updateInfo</code>（注意在 v10.26.0 版本之前，<code>checkUpdate</code>方法本身没有返回值，只能从<code>useUpdate()</code>返回的<code>updateInfo</code>中获取，且我们仍然推荐优先使用<code>useUpdate()</code>来获取），返回值有三种情形：</p>
<ol>
<li><code>{expired: true}</code>：该应用原生包已过期（三种情况：1. 主动设置为过期状态，2. 主动删除，3. 从未上传），需要引导用户下载或跳转到应用市场(需要在网页管理端设置中填写<code>downloadUrl</code>)。如需在应用内执行 apk 更新，还需配置<a href="/docs/api.html#async-function-downloadandinstallapkurl" class="rp-link">安装权限</a>。</li>
</ol>
<div class="rp-codeblock language-js"><div class="rp-codeblock__content"><div class="rp-codeblock__content__scroll-container rp-scrollbar rp-scrollbar--always"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0" data-lang="js"><code><span class="line"><span style="color:var(--shiki-foreground)">{</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    expired</span><span style="color:var(--shiki-token-punctuation)">:</span><span style="color:var(--shiki-token-constant)"> true</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    downloadUrl</span><span style="color:var(--shiki-token-punctuation)">:</span><span style="color:var(--shiki-token-string-expression)"> &#x27;http://appstore/downloadUrl&#x27;</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div><div class="rp-code-button-group"><button class="rp-code-button-group__button rp-code-wrap-button" title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="rp-code-button-group__icon rp-code-button-group__icon--wrapped"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="rp-code-button-group__icon rp-code-button-group__icon--wrap"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="rp-code-button-group__button rp-code-copy-button" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="rp-code-button-group__icon rp-code-copy-button__icon rp-code-copy-button__icon--copy"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="rp-code-button-group__icon rp-code-copy-button__icon rp-code-copy-button__icon--success"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<ol start="2">
<li>
<p><code>{upToDate: true}</code>：当前已经更新到最新，无需进行更新。</p>
</li>
<li>
<p><code>{update: true}</code>：当前有新版本可以更新。<code>name</code>、<code>description</code>字段可以用于展示给用户版本号，更新内容等信息，而<code>metaInfo</code>字段则可以根据你的需求自定义一些标记(如是否静默更新、是否强制更新等等，自己根据标记的属性做一些条件流程控制)，具体用法可参考<a href="/docs/bestpractice.html#%E5%85%83%E4%BF%A1%E6%81%AFmeta-info%E7%9A%84%E4%BD%BF%E7%94%A8" class="rp-link">场景实践</a>。另外还有几个字段，包含了热更新文件的下载地址，</p>
</li>
</ol>
<div class="rp-codeblock language-js"><div class="rp-codeblock__content"><div class="rp-codeblock__content__scroll-container rp-scrollbar rp-scrollbar--always"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0" data-lang="js"><code><span class="line"><span style="color:var(--shiki-foreground)">{</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    update</span><span style="color:var(--shiki-token-punctuation)">:</span><span style="color:var(--shiki-token-constant)"> true</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    name</span><span style="color:var(--shiki-token-punctuation)">:</span><span style="color:var(--shiki-token-string-expression)"> &#x27;1.0.3-rc&#x27;</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    hash</span><span style="color:var(--shiki-token-punctuation)">:</span><span style="color:var(--shiki-token-string-expression)"> &#x27;hash&#x27;</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    description</span><span style="color:var(--shiki-token-punctuation)">:</span><span style="color:var(--shiki-token-string-expression)"> &#x27;添加聊天功能\n修复商城页面BUG&#x27;</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    metaInfo</span><span style="color:var(--shiki-token-punctuation)">:</span><span style="color:var(--shiki-token-string-expression)"> &#x27;{&quot;silent&quot;:true}&#x27;</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    pdiffUrl</span><span style="color:var(--shiki-token-punctuation)">:</span><span style="color:var(--shiki-token-string-expression)"> &#x27;http://update-packages.reactnative.cn/hash&#x27;</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    diffUrl</span><span style="color:var(--shiki-token-punctuation)">:</span><span style="color:var(--shiki-token-string-expression)"> &#x27;http://update-packages.reactnative.cn/hash&#x27;</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div><div class="rp-code-button-group"><button class="rp-code-button-group__button rp-code-wrap-button" title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="rp-code-button-group__icon rp-code-button-group__icon--wrapped"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="rp-code-button-group__icon rp-code-button-group__icon--wrap"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="rp-code-button-group__button rp-code-copy-button" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="rp-code-button-group__icon rp-code-copy-button__icon rp-code-copy-button__icon--copy"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="rp-code-button-group__icon rp-code-copy-button__icon rp-code-copy-button__icon--success"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<hr/>
<h4 class="rp-toc-include" id="async-function-downloadupdate"><a href="#async-function-downloadupdate" class="rp-header-anchor rp-link" aria-hidden="true">#</a>async function downloadUpdate()</h4>
<p>下载热更包。仅当<code>update:true</code>时实际进行下载。会更新<code>progress</code>数据。v10.16.0+ 版本返回值为<code>boolean</code>，表示是否下载成功。</p>
<hr/>
<h4 class="rp-toc-include" id="async-function-downloadandinstallapkurl"><a href="#async-function-downloadandinstallapkurl" class="rp-header-anchor rp-link" aria-hidden="true">#</a>async function downloadAndInstallApk(url)</h4>
<p>下载更新的 apk 包并直接安装。<code>url</code>必须为可直接下载到 apk 文件的地址。</p>
<p>由于系统安全限制等各种外部因素，此功能并不能保证一定正常调用。在应用当前运行周期内，如果下载或者安装失败，则再次调用时不会重试，只会静默失败。</p>
<p>注意要使用这个功能还需要在<code>AndroidManifest.xml</code>中手动添加安装权限，如果需要考虑 Android 7.0 以下的客户，则还需要添加外部存储权限。</p>
<div class="rp-codeblock language-xml"><div class="rp-codeblock__content"><div class="rp-codeblock__content__scroll-container rp-scrollbar rp-scrollbar--always"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0" data-lang="xml"><code><span class="line"><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-string-expression)">uses-permission</span><span style="color:var(--shiki-token-function)"> android</span><span style="color:var(--shiki-token-punctuation)">:</span><span style="color:var(--shiki-token-function)">name</span><span style="color:var(--shiki-foreground)">=</span><span style="color:var(--shiki-token-string-expression)">&quot;android.permission.REQUEST_INSTALL_PACKAGES&quot;</span><span style="color:var(--shiki-foreground)"> /&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)">&lt;!-- 如果需要考虑Android 7.0以下的客户，则还需要添加外部存储权限 --&gt;</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-string-expression)">uses-permission</span><span style="color:var(--shiki-token-function)"> android</span><span style="color:var(--shiki-token-punctuation)">:</span><span style="color:var(--shiki-token-function)">name</span><span style="color:var(--shiki-foreground)">=</span><span style="color:var(--shiki-token-string-expression)">&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;</span><span style="color:var(--shiki-foreground)"> /&gt;</span></span></code></pre></div><div class="rp-code-button-group"><button class="rp-code-button-group__button rp-code-wrap-button" title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="rp-code-button-group__icon rp-code-button-group__icon--wrapped"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="rp-code-button-group__icon rp-code-button-group__icon--wrap"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="rp-code-button-group__button rp-code-copy-button" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="rp-code-button-group__icon rp-code-copy-button__icon rp-code-copy-button__icon--copy"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="rp-code-button-group__icon rp-code-copy-button__icon rp-code-copy-button__icon--success"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<p>注意某些应用市场可能会因为上述权限拒绝应用上架。去掉上述两个权限并不影响热更新功能。</p>
<hr/>
<h4 class="rp-toc-include" id="function-marksuccess"><a href="#function-marksuccess" class="rp-header-anchor rp-link" aria-hidden="true">#</a>function markSuccess()</h4>
<p><strong>一般情况下请勿手动调用此函数</strong>。调用此函数作为更新成功的标记（否则下次启动会默认失败自动回滚）。</p>
<hr/>
<h4 class="rp-toc-include" id="async-function-getcurrentversioninfo"><a href="#async-function-getcurrentversioninfo" class="rp-header-anchor rp-link" aria-hidden="true">#</a>async function getCurrentVersionInfo()</h4>
<p>获取当前已热更版本的信息（如尚未热更过则返回空对象）。v10.31.2 版本之后可以直接用 <code>currentVersionInfo</code> 代替。</p>
<p>返回值示例：</p>
<div class="rp-codeblock language-js"><div class="rp-codeblock__content"><div class="rp-codeblock__content__scroll-container rp-scrollbar rp-scrollbar--always"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0" data-lang="js"><code><span class="line"><span style="color:var(--shiki-foreground)">{</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    name</span><span style="color:var(--shiki-token-punctuation)">:</span><span style="color:var(--shiki-token-string-expression)"> &#x27;1.0.3-rc&#x27;</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    description</span><span style="color:var(--shiki-token-punctuation)">:</span><span style="color:var(--shiki-token-string-expression)"> &#x27;添加聊天功能\n修复商城页面BUG&#x27;</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    metaInfo</span><span style="color:var(--shiki-token-punctuation)">:</span><span style="color:var(--shiki-token-string-expression)"> &#x27;{&quot;silent&quot;:true}&#x27;</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div><div class="rp-code-button-group"><button class="rp-code-button-group__button rp-code-wrap-button" title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="rp-code-button-group__icon rp-code-button-group__icon--wrapped"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="rp-code-button-group__icon rp-code-button-group__icon--wrap"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="rp-code-button-group__button rp-code-copy-button" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="rp-code-button-group__icon rp-code-copy-button__icon rp-code-copy-button__icon--copy"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="rp-code-button-group__icon rp-code-copy-button__icon rp-code-copy-button__icon--success"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<hr/>
<h4 class="rp-toc-include" id="function-restartapp"><a href="#function-restartapp" class="rp-header-anchor rp-link" aria-hidden="true">#</a>function restartApp()</h4>
<p>立即重启应用。v10.28.2+ 版本可用。</p>
<hr/>
<h4 class="rp-toc-include" id="function-switchversion"><a href="#function-switchversion" class="rp-header-anchor rp-link" aria-hidden="true">#</a>function switchVersion()</h4>
<p>立即重启应用，并加载已经下载完毕的版本。</p>
<blockquote>
<p>注意!不可依赖<code>progress</code>来判断下载完成，必须要在<code>await downloadUpdate()</code>之后再调用此方法。</p>
</blockquote>
<hr/>
<h4 class="rp-toc-include" id="function-switchversionlater"><a href="#function-switchversionlater" class="rp-header-anchor rp-link" aria-hidden="true">#</a>function switchVersionLater()</h4>
<p>在下一次启动应用的时候加载已经下载完毕的版本。</p>
<blockquote>
<p>注意!不可依赖<code>progress</code>来判断下载完成，必须要在<code>await downloadUpdate()</code>之后再调用此方法。</p>
</blockquote>
<hr/>
<h4 class="rp-toc-include" id="function-parsetestqrcodeqrcode-string"><a href="#function-parsetestqrcodeqrcode-string" class="rp-header-anchor rp-link" aria-hidden="true">#</a>function parseTestQrCode(qrCode: string)</h4>
<p>解析测试二维码，一般用于给 QA 人员测试热更新。如果在应用中已有扫码功能，则可以在应用中扫描 pushy 后台的测试二维码来测试任意版本的热更包。
注意如果你使用自定义的(更新策略（updateStrategy）)[<a href="https://pushy.reactnative.cn/docs/integration#updatestrategy%E6%9B%B4%E6%96%B0%E5%BA%94%E7%94%A8%E7%AD%96%E7%95%A5%5D%EF%BC%8C%E8%AF%B7%E5%8A%A1%E5%BF%85%E4%BB%8E" target="_blank" rel="noopener noreferrer" class="rp-link">https://pushy.reactnative.cn/docs/integration#updatestrategy%E6%9B%B4%E6%96%B0%E5%BA%94%E7%94%A8%E7%AD%96%E7%95%A5]，请务必从</a> <code>useUpdate()</code> 中获取 <code>updateInfo</code> ，而不要依赖 checkUpdate 方法的返回值，否则扫码不会有后续动作。</p>
<p><img alt="testqrcode" src="/static/image/testqrcode.24c22c1ebe.png"/></p>
<p>注意使用此方法，上述界面中的&quot;使用 Deep Link&quot;选项 <u><b>请不要</b></u> 勾选。</p>
<p>代码示例：</p>
<div class="rp-codeblock language-js"><div class="rp-codeblock__content"><div class="rp-codeblock__content__scroll-container rp-scrollbar rp-scrollbar--always"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0" data-lang="js"><code><span class="line"><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-constant)">Camera</span></span>
<span class="line"><span style="color:var(--shiki-token-function)">  onReadCode</span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)">{({ nativeEvent: { codeStringValue } }) </span><span style="color:var(--shiki-token-keyword)">=&gt;</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">    // 识别到二维码后先关闭相机</span></span>
<span class="line"><span style="color:var(--shiki-token-function)">    setShowCamera</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-constant)">false</span><span style="color:var(--shiki-foreground)">);</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">    // 先解析是否是pushy的测试二维码</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">    if</span><span style="color:var(--shiki-foreground)"> (</span><span style="color:var(--shiki-token-function)">parseTestQrCode</span><span style="color:var(--shiki-foreground)">(codeStringValue)) {</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">      // 如果是pushy的测试二维码，则不再做其他业务扫码逻辑</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">      return</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">    }</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">    // 如果不是，继续处理其他业务扫码逻辑</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">  }}</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">/&gt;</span></span></code></pre></div><div class="rp-code-button-group"><button class="rp-code-button-group__button rp-code-wrap-button" title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="rp-code-button-group__icon rp-code-button-group__icon--wrapped"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="rp-code-button-group__icon rp-code-button-group__icon--wrap"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="rp-code-button-group__button rp-code-copy-button" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="rp-code-button-group__icon rp-code-copy-button__icon rp-code-copy-button__icon--copy"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="rp-code-button-group__icon rp-code-copy-button__icon rp-code-copy-button__icon--success"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div>
<hr/>
<h3 class="rp-toc-include" id="android-方法"><a href="#android-方法" class="rp-header-anchor rp-link" aria-hidden="true">#</a>Android 方法</h3>
<h4 class="rp-toc-include" id="updatecontextsetcustominstancemanagerreactinstancemanager-instancemanager"><a href="#updatecontextsetcustominstancemanagerreactinstancemanager-instancemanager" class="rp-header-anchor rp-link" aria-hidden="true">#</a>UpdateContext.setCustomInstanceManager(ReactInstanceManager instanceManager)</h4>
<p>如果是集成/混编 Android 方案，则可以使用此方法传入你自行创建的 ReactInstanceManager。自<code>v5.5.8</code>版本起可用。</p>
<p>示例：</p>
<div class="rp-codeblock language-java"><div class="rp-codeblock__content"><div class="rp-codeblock__content__scroll-container rp-scrollbar rp-scrollbar--always"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0" data-lang="java"><code><span class="line"><span style="color:var(--shiki-token-keyword)">import</span><span style="color:var(--shiki-token-keyword)"> cn</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-keyword)">reactnative</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-keyword)">modules</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-keyword)">update</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-keyword)">UpdateContext</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">mReactInstanceManager = ReactInstanceManager</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-keyword)">builder()</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">                // ...各种setter，但注意不要调用setBundleAssetName</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">                .</span><span style="color:var(--shiki-token-keyword)">setJSBundleFile(UpdateContext</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-keyword)">getBundleUrl(mContext, &quot;assets:</span><span style="color:var(--shiki-token-comment)">//index.android.bundle&quot;))</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation)">                .</span><span style="color:var(--shiki-token-keyword)">build()</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-constant)">UpdateContext</span><span style="color:var(--shiki-token-punctuation)">.</span><span style="color:var(--shiki-token-function)">setCustomInstanceManager</span><span style="color:var(--shiki-foreground)">(mReactInstanceManager);</span></span></code></pre></div><div class="rp-code-button-group"><button class="rp-code-button-group__button rp-code-wrap-button" title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="rp-code-button-group__icon rp-code-button-group__icon--wrapped"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="rp-code-button-group__icon rp-code-button-group__icon--wrap"><path fill="currentColor" d="M16 7H3V5h13zM3 19h13v-2H3zm19-7-4-3v2H3v2h15v2z"></path></svg></button><button class="rp-code-button-group__button rp-code-copy-button" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="rp-code-button-group__icon rp-code-copy-button__icon rp-code-copy-button__icon--copy"><path fill="currentColor" d="M28 10v18H10V10zm0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="rp-code-button-group__icon rp-code-copy-button__icon rp-code-copy-button__icon--success"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9z"></path></svg></button></div></div></div><!--/$--></div><footer class="rp-doc-footer"><div class="rp-doc-footer__edit"></div><div class="rp-doc-footer__divider"></div><div class="rp-prev-next-page"><a href="/docs/publish.html" class="rp-prev-next-page__item rp-prev-next-page__prev rp-link"><span class="rp-prev-next-page__item__desc">Previous page</span><span class="rp-prev-next-page__item__title"><svg width="1em" height="1em" viewBox="0 0 32 32" class="rp-prev-next-page__icon rp-prev-next-page__rotate_180"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg><span>发布流程</span></span></a><a href="/docs/api-token.html" class="rp-prev-next-page__item rp-prev-next-page__next rp-link"><span class="rp-prev-next-page__item__desc">Next page</span><span class="rp-prev-next-page__item__title"><span>API Token</span><svg width="1em" height="1em" viewBox="0 0 32 32" class="rp-prev-next-page__icon"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></span></a></div></footer></main></div><aside class="rp-doc-layout__outline rp-scrollbar"><div class="rp-outline"><div class="rp-outline__title">ON THIS PAGE<svg width="14" height="14" class="rp-progress-circle"><circle cx="7" cy="7" r="6" stroke-linecap="round" fill="none" stroke="var(--rp-c-divider-light)" stroke-width="2"></circle><circle cx="7" cy="7" r="6" stroke-linecap="round" fill="none" stroke="var(--rp-c-brand)" stroke-width="2" stroke-dasharray="37.69911184307752" stroke-dashoffset="37.69911184307752" transform="rotate(-90 7 7)" style="transition:stroke-dashoffset 0.3s"></circle></svg></div><nav class="rp-outline__toc rp-scrollbar"><a href="#javascript-方法" class="rp-toc-item rp-link" title="JavaScript 方法" style="padding-left:12px" data-depth="1"><span class="rp-toc-item__text rp-doc">JavaScript 方法</span></a><a href="#new-pushyoptions-pushyoptions" class="rp-toc-item rp-link" title="new Pushy(options: PushyOptions)" style="padding-left:24px" data-depth="2"><span class="rp-toc-item__text rp-doc">new Pushy(options: PushyOptions)</span></a><a href="#useupdate" class="rp-toc-item rp-link" title="useUpdate()" style="padding-left:24px" data-depth="2"><span class="rp-toc-item__text rp-doc">useUpdate()</span></a><a href="#async-function-checkupdate" class="rp-toc-item rp-link" title="async function checkUpdate()" style="padding-left:24px" data-depth="2"><span class="rp-toc-item__text rp-doc">async function checkUpdate()</span></a><a href="#async-function-downloadupdate" class="rp-toc-item rp-link" title="async function downloadUpdate()" style="padding-left:24px" data-depth="2"><span class="rp-toc-item__text rp-doc">async function downloadUpdate()</span></a><a href="#async-function-downloadandinstallapkurl" class="rp-toc-item rp-link" title="async function downloadAndInstallApk(url)" style="padding-left:24px" data-depth="2"><span class="rp-toc-item__text rp-doc">async function downloadAndInstallApk(url)</span></a><a href="#function-marksuccess" class="rp-toc-item rp-link" title="function markSuccess()" style="padding-left:24px" data-depth="2"><span class="rp-toc-item__text rp-doc">function markSuccess()</span></a><a href="#async-function-getcurrentversioninfo" class="rp-toc-item rp-link" title="async function getCurrentVersionInfo()" style="padding-left:24px" data-depth="2"><span class="rp-toc-item__text rp-doc">async function getCurrentVersionInfo()</span></a><a href="#function-restartapp" class="rp-toc-item rp-link" title="function restartApp()" style="padding-left:24px" data-depth="2"><span class="rp-toc-item__text rp-doc">function restartApp()</span></a><a href="#function-switchversion" class="rp-toc-item rp-link" title="function switchVersion()" style="padding-left:24px" data-depth="2"><span class="rp-toc-item__text rp-doc">function switchVersion()</span></a><a href="#function-switchversionlater" class="rp-toc-item rp-link" title="function switchVersionLater()" style="padding-left:24px" data-depth="2"><span class="rp-toc-item__text rp-doc">function switchVersionLater()</span></a><a href="#function-parsetestqrcodeqrcode-string" class="rp-toc-item rp-link" title="function parseTestQrCode(qrCode: string)" style="padding-left:24px" data-depth="2"><span class="rp-toc-item__text rp-doc">function parseTestQrCode(qrCode: string)</span></a><a href="#android-方法" class="rp-toc-item rp-link" title="Android 方法" style="padding-left:12px" data-depth="1"><span class="rp-toc-item__text rp-doc">Android 方法</span></a><a href="#updatecontextsetcustominstancemanagerreactinstancemanager-instancemanager" class="rp-toc-item rp-link" title="UpdateContext.setCustomInstanceManager(ReactInstanceManager instanceManager)" style="padding-left:24px" data-depth="2"><span class="rp-toc-item__text rp-doc">UpdateContext.setCustomInstanceManager(ReactInstanceManager instanceManager)</span></a></nav><div class="rp-outline__divider"></div><div class="rp-outline__bottom"><button class="rp-outline__scroll-to-top"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.99967 14.6667C11.6816 14.6667 14.6663 11.6819 14.6663 8.00001C14.6663 4.31811 11.6816 1.33334 7.99967 1.33334C4.31777 1.33334 1.33301 4.31811 1.33301 8.00001C1.33301 11.6819 4.31777 14.6667 7.99967 14.6667Z" stroke="currentColor" stroke-opacity="0.8" stroke-width="1.33333"></path><path d="M7.99967 14.6667C11.6816 14.6667 14.6663 11.6819 14.6663 8.00001C14.6663 4.31811 11.6816 1.33334 7.99967 1.33334C4.31777 1.33334 1.33301 4.31811 1.33301 8.00001C1.33301 11.6819 4.31777 14.6667 7.99967 14.6667Z" stroke="currentColor" stroke-opacity="0.8" stroke-width="1.33333" stroke-linejoin="round"></path><path d="M11 9L8 6L5 9" stroke="currentColor" stroke-opacity="0.8" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"></path></svg><span>Back to top</span></button></div></div></aside></div></div>
    <div id="__rspress_modal_container"></div>
  </body>
</html>
