{"componentChunkName":"component---src-templates-docs-tsx","path":"/docs/bestpractice.html","result":{"data":{"markdownRemark":{"html":"<h4 id=\"优化原生和热更包体积\" style=\"position:relative;\"><a href=\"#%E4%BC%98%E5%8C%96%E5%8E%9F%E7%94%9F%E5%92%8C%E7%83%AD%E6%9B%B4%E5%8C%85%E4%BD%93%E7%A7%AF\" aria-label=\"优化原生和热更包体积 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>优化原生和热更包体积</h4>\n<h5 id=\"ios-原生包优化ipa\" style=\"position:relative;\"><a href=\"#ios-%E5%8E%9F%E7%94%9F%E5%8C%85%E4%BC%98%E5%8C%96ipa\" aria-label=\"ios 原生包优化ipa permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>iOS 原生包优化(ipa)</h5>\n<p>在导出 ipa 以便上传到 pushy 服务时，可以取消 bitcode 选项以大幅减小 ipa 大小。上架 app store 或者通过 testflight 分发测试包时仍然可以保留 bitcode 选项，不影响热更新。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1a1e4a4e9357dfca110d7c542fb6e5be/c2cf1/bitcode.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.13513513513513%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABmUlEQVQoz62SyW7bMBCG9f7nvkmBHHvvqUWRoKqtODYpRztXbdbCv0PKiREkh7boAD+GQ3I+DjmMGGPY7XZIkiQojuMt3u+RZxnyPA++IO8V4jy7apsriuJVkWgE2ra9yVq0fY92GDBOE8Z5Jn+VH8/LNn+53NbGEReKlVKIPOSdsUcgfQKKM7B/AHb3wMM3IP4BJD8BTmuHeIur/DXNsyJLFXlzXnTyWmYY0xMG9oSBHzGyA4bjI9ZnBuRnODrEEcQrxHkKZ3VgeNYbIIYOa8YhiwwNZxBnDpU/k08xSoHZGkxGYfbSClNrsVQFXF1uFb4BBuIKkSmckxPk6YD6eMAsatpp4AjgtLyJoPCV+fE4fAQMRAha46WCJIBQGrWUwQutt1hINPT40hho26Kjhnz8hgHoMM0OSlsYo2EpyejNW7puT90P6joM/heQJuruSzHvgC/Qv7X1CrRUcWTo9GVZ8D9s6Ako6Y1MuJL9J7XUaV50+JX2YNTQqGkacM5RliXqukZVVX8kv5f5PPpin79qfLpr8eW7wm9L6pmPI91XoAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/1a1e4a4e9357dfca110d7c542fb6e5be/89a28/bitcode.webp 148w,\n/static/1a1e4a4e9357dfca110d7c542fb6e5be/d4a17/bitcode.webp 295w,\n/static/1a1e4a4e9357dfca110d7c542fb6e5be/1ebe6/bitcode.webp 590w,\n/static/1a1e4a4e9357dfca110d7c542fb6e5be/fbcfa/bitcode.webp 745w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/1a1e4a4e9357dfca110d7c542fb6e5be/4ef9d/bitcode.png 148w,\n/static/1a1e4a4e9357dfca110d7c542fb6e5be/87239/bitcode.png 295w,\n/static/1a1e4a4e9357dfca110d7c542fb6e5be/bc1df/bitcode.png 590w,\n/static/1a1e4a4e9357dfca110d7c542fb6e5be/c2cf1/bitcode.png 745w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/1a1e4a4e9357dfca110d7c542fb6e5be/bc1df/bitcode.png\"\n          alt=\"bitcode\"\n          title=\"bitcode\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<h5 id=\"android-原生包优化apk\" style=\"position:relative;\"><a href=\"#android-%E5%8E%9F%E7%94%9F%E5%8C%85%E4%BC%98%E5%8C%96apk\" aria-label=\"android 原生包优化apk permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Android 原生包优化(apk)</h5>\n<p>apk 的优化主要考虑两个方向：</p>\n<ul>\n<li><a href=\"https://reactnative.cn/docs/signed-apk-android#%E5%90%AF%E7%94%A8proguard%E6%9D%A5%E5%87%8F%E5%B0%91apk%E7%9A%84%E5%A4%A7%E5%B0%8F%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89\">启用 proguard 压缩混淆源码</a>。但这一步可能导致一些使用反射的代码运行时报错，启用后需要充分测试每个页面和功能，以及需要阅读一些第三方关于 proguard 的特别设置说明。</li>\n<li><a href=\"https://reactnative.cn/docs/signed-apk-android#%E9%92%88%E5%AF%B9%E4%B8%8D%E5%90%8C%E7%9A%84-cpu-%E6%9E%B6%E6%9E%84%E7%94%9F%E6%88%90-apk-%E4%BB%A5%E5%87%8F%E5%B0%8F-apk-%E6%96%87%E4%BB%B6%E7%9A%84%E5%A4%A7%E5%B0%8F\">分开编译不同的 cpu 架构</a>。找到<code>android/app/build.gradle</code>中的 cpu 架构部分，如下所示启用<code>enable</code>选项：</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\">splits {\n<span class=\"token unchanged\">    abi {\n        reset()\n</span><span class=\"token deleted-sign deleted\">-       enable enableSeparateBuildPerCPUArchitecture\n</span><span class=\"token inserted-sign inserted\">+       enable true        // 启用单独的 cpu 架构编译\n</span><span class=\"token unchanged\">        universalApk false  // If true, also generate a universal APK\n    }\n</span>}</code></pre></div>\n<p>如此一来会在编译目录中输出多个 apk 文件，分发和上传到热更新服务时只需要使用<code>app-arm64-v8a-release.apk</code>文件，可以大幅减小 apk 的大小。</p>\n<h5 id=\"热更新包优化ppk\" style=\"position:relative;\"><a href=\"#%E7%83%AD%E6%9B%B4%E6%96%B0%E5%8C%85%E4%BC%98%E5%8C%96ppk\" aria-label=\"热更新包优化ppk permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>热更新包优化(ppk)</h5>\n<p>热更新包的主要内容是 js 包和其所引用的静态资源（主要是图片）。</p>\n<ul>\n<li>js 包成分分析。可以借助一些第三方工具（如<a href=\"https://github.com/IjzerenHein/react-native-bundle-visualizer\">react-native-bundle-visualizer</a>）来分析 js 文件中哪些占比较大，是否可以用其他库替换等（如 dayjs 替换 moment，lodash-es 替换 lodash）。</li>\n<li>\n<p>图片优化。</p>\n<ul>\n<li>在保证体验的情况下，使用一些工具对图片进行裁剪压缩。</li>\n<li>如不需要图片的透明像素，可以考虑将 png 格式转为 jpg 格式。</li>\n<li>还可以进一步考虑压缩比更高的图片格式，例如 webp 格式（需要第三方原生插件例如<a href=\"https://github.com/Aleksefo/react-native-webp-format#readme\">react-native-webp-format</a>），heif 格式（iOS 11 和 Android 10 以上原生支持）等。这里有个图片格式对比可供参考 <a href=\"https://compare.rokka.io/_compare/#heif=40&#x26;jpeg=80&#x26;webp=80&#x26;av1=40&#x26;width=800\">https://compare.rokka.io/_compare/#heif=40&#x26;jpeg=80&#x26;webp=80&#x26;av1=40&#x26;width=800</a>。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"有很多渠道包需要热更，如何操作比较方便？\" style=\"position:relative;\"><a href=\"#%E6%9C%89%E5%BE%88%E5%A4%9A%E6%B8%A0%E9%81%93%E5%8C%85%E9%9C%80%E8%A6%81%E7%83%AD%E6%9B%B4%EF%BC%8C%E5%A6%82%E4%BD%95%E6%93%8D%E4%BD%9C%E6%AF%94%E8%BE%83%E6%96%B9%E4%BE%BF%EF%BC%9F\" aria-label=\"有很多渠道包需要热更，如何操作比较方便？ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>有很多渠道包需要热更，如何操作比较方便？</h4>\n<ol>\n<li>如果渠道包的<code>js代码和初始资源</code>有差别（无论多么细微的差别），那么只能单独生成 apk，分别上传和绑定。可以考虑写一些脚本自动调用 cli 来执行批量操作。</li>\n<li>如果渠道包的<code>js代码和初始资源</code>完全一致，可以考虑使用一些动态生成渠道包的方案（比如<a href=\"https://github.com/Tencent/VasDolly\">腾讯的 VasDolly</a>，<a href=\"https://github.com/Meituan-Dianping/walle\">美团的 walle</a>等），所有的渠道包基于同一个基础 apk 生成。这样可以只用上传一个基础 apk，对此 apk 的热更操作可以对所有渠道包生效。</li>\n</ol>\n<h4 id=\"如何支持-aab-格式的原生包？\" style=\"position:relative;\"><a href=\"#%E5%A6%82%E4%BD%95%E6%94%AF%E6%8C%81-aab-%E6%A0%BC%E5%BC%8F%E7%9A%84%E5%8E%9F%E7%94%9F%E5%8C%85%EF%BC%9F\" aria-label=\"如何支持 aab 格式的原生包？ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>如何支持 aab 格式的原生包？</h4>\n<p>如果您需要使用 aab 格式的 android 原生包，那么可以在上传到 Google play 之后，在其控制台中下载转换后的 apk 格式（见下图），然后将这个 apk 包上传到热更新的后台，即可正常支持热更新。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6a53ae93bb93308be157635991cbfafc/f836e/aab.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.62162162162163%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAACEElEQVQ4y3VUy5LbIBDU//9ZTskplYttSS7Z69UbkAQS0JlG8mad2qWqC4Shp6dncKbNhKK6w2gNrtdtw+Y9Rm3QDWOCkv3FrdDTnM4YzoJpnuGcxSyztRbDMCDzcnlZLEII4ODcti1OpxOKosDlcpH1OcE5hxCjECxyZ4HbPIwDjI0JHJkWZeOo0mEOBuB313Xo+l7IOzRNm2ZjTIJSko3cm0RlP3loG+BDRJRg2TCOGJX6UEhCprKuK5yA3zxIcE07/AuC3BV1x5mMERtJkcT0gURd16O63VBer0kd974bXjyfpilZcBBO2MSLcETY0gGavYK/0fTFOlEWPzIg9rHfYXack4dUwJRpNMn2Ii0pCBUzm9sQkNcrZhfhZM/a3e+nFZ+RsQA0fBaSZ5UZ5JLnyPMiqdwORYeIb8kSodYjtBpFkdtTEMJe+qmqKhRlibK8opdqs9dYWc7/jydZSvlyNzjfZ/wpR1Stk7RCIlBiw+cLQVQmsBuOb1r0JEryqfCtkZ4bZyxSSLsJnE+vYJa+jEnz11iFWEl1NxZkmRCO/cxoJcThXxtIFPOQp1icsdyu8PUb0NWI7fsLuLc+bghdA/z+Cf/rB+K2IuNrYGEGebNMh4Sqfkedn/EQLG0NTBqRgc0rXN/CqwFxlv+ARgJJv2ZsF/YdDX+2jRHjFdNm//FJsfpfpG15PsbDgn3+CxwsQWiif6qwAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/6a53ae93bb93308be157635991cbfafc/89a28/aab.webp 148w,\n/static/6a53ae93bb93308be157635991cbfafc/d4a17/aab.webp 295w,\n/static/6a53ae93bb93308be157635991cbfafc/1ebe6/aab.webp 590w,\n/static/6a53ae93bb93308be157635991cbfafc/858dd/aab.webp 885w,\n/static/6a53ae93bb93308be157635991cbfafc/2c242/aab.webp 1093w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/6a53ae93bb93308be157635991cbfafc/4ef9d/aab.png 148w,\n/static/6a53ae93bb93308be157635991cbfafc/87239/aab.png 295w,\n/static/6a53ae93bb93308be157635991cbfafc/bc1df/aab.png 590w,\n/static/6a53ae93bb93308be157635991cbfafc/16fbe/aab.png 885w,\n/static/6a53ae93bb93308be157635991cbfafc/f836e/aab.png 1093w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/6a53ae93bb93308be157635991cbfafc/bc1df/aab.png\"\n          alt=\"aab\"\n          title=\"aab\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<h4 id=\"ci-的集成\" style=\"position:relative;\"><a href=\"#ci-%E7%9A%84%E9%9B%86%E6%88%90\" aria-label=\"ci 的集成 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CI 的集成</h4>\n<p>在开发环境中，每次 bundle 都会生成一个不同名字的 ppk 文件，这不利于持续集成(CI)系统的引入。</p>\n<p>要解决这个问题,你可以使用<code>--output</code>参数来指定输出 ppk 文件的名字和路径，便于进行自动发布。</p>\n<h4 id=\"测试、发布与回滚\" style=\"position:relative;\"><a href=\"#%E6%B5%8B%E8%AF%95%E3%80%81%E5%8F%91%E5%B8%83%E4%B8%8E%E5%9B%9E%E6%BB%9A\" aria-label=\"测试、发布与回滚 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>测试、发布与回滚</h4>\n<p>我们强烈建议您先发布一个<strong>测试包</strong>，再发布一个除了版本号以外均完全相同的<strong>正式包</strong>。</p>\n<p>例如，假设我们有一个正式包，版本为<code>1.6.0</code>，那么可以修改版本号重新打包一个<code>1001.6.0</code>，以一个明显不太正常的版本号来标识它是一个测试版本，同时后几位相同，可以表明它和某个正式版本存在关联（内容/依赖一致）。</p>\n<p>在每次往发布包发起热更新之前，先对<strong>测试包</strong><code>1001.6.0</code>进行更新操作，基本测试通过之后，再在网页后台上将热更包重新绑定到<strong>正式包</strong><code>1.6.0</code>上。如果在测试包中发现了重大问题，你就可以先进行修复，更新测试确认通过后再部署到正式线上环境。这样，可以最大程度的避免发生线上事故。</p>\n<p>万一确实发生线上事故需要回滚的话，首先利用版本控制系统回滚代码到正常的状态，然后重新生成热更包并推送即可。</p>\n<h4 id=\"元信息meta-info的使用\" style=\"position:relative;\"><a href=\"#%E5%85%83%E4%BF%A1%E6%81%AFmeta-info%E7%9A%84%E4%BD%BF%E7%94%A8\" aria-label=\"元信息meta info的使用 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>元信息(Meta Info)的使用</h4>\n<p>在发布热更新版本时，或者在网页端，你可以编辑版本的元信息。这是一段在检查更新时可以获得的字符串，你可以在其中按你所想的格式（一般建议用<a href=\"https://developer.mozilla.org/zh-CN/docs/Learn/JavaScript/Objects/JSON\">JSON 格式</a>）保存一些信息。</p>\n<p>比如我们可以在元信息中约定字段标志<code>silent</code>，表示需要静默更新。当我们上传热更包填写 metainfo 时，以<a href=\"https://developer.mozilla.org/zh-CN/docs/Learn/JavaScript/Objects/JSON\">JSON 格式</a>输入：</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span> <span class=\"token property\">\"silent\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>请注意，我们并不对输入做任何格式校验和约束，请自行校验输入是否正确。</p>\n</blockquote>\n<p>此时在客户端检查更新时，能获取到我们刚刚输入的元信息，但它并不具备任何功能，只是一个字符串而已。所以我们其实需要<strong>预先</strong>在更新流程中加入对应的处理逻辑：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// 调用 checkUpdate 获取 info</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">.</span>expired<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ... 原生包版本过期，下载或跳转下载页面</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">.</span>upToDate<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ... 没有更新，弹提示或忽略</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 有更新，一般来说我们在这里给用户弹窗提示，让用户选择是否更新</span>\n  <span class=\"token comment\">// 那么静默更新的本质其实就是不弹窗，直接执行，所以可以在这里加入额外的判断流程</span>\n  Alert<span class=\"token punctuation\">.</span><span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'提示'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'检查到新的版本'</span> <span class=\"token operator\">+</span> info<span class=\"token punctuation\">.</span>name <span class=\"token operator\">+</span> <span class=\"token string\">',是否下载?\\n'</span> <span class=\"token operator\">+</span> info<span class=\"token punctuation\">.</span>description<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      text<span class=\"token operator\">:</span> <span class=\"token string\">'是'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function-variable function\">onPress</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">doUpdate</span><span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> text<span class=\"token operator\">:</span> <span class=\"token string\">'否'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>我们在原有的更新流程中加入元信息的读取和判断：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> metaInfo <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 注意 JSON 输入有可能有错误，需要用 try 语句来避免应用被带崩</span>\n  metaInfo <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">.</span>metaInfo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 异常处理，忽略或上报？</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>metaInfo<span class=\"token punctuation\">.</span>silent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 如果热更包携带有 silent 字段，不询问用户，直接执行更新</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">doUpdate</span><span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 否则还是走之前的询问流程</span>\n  <span class=\"token comment\">// Alert.alert('提示', '检查到新的版本.......</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>又比如，可能某个版本包含一些重要的公告内容，所以还可以在上面插入一个公告字段等等。如何使用元信息，完全取决于您的想象力！</p>","tableOfContents":"<ul>\n<li>\n<p><a href=\"/docs/bestpractice/#%E4%BC%98%E5%8C%96%E5%8E%9F%E7%94%9F%E5%92%8C%E7%83%AD%E6%9B%B4%E5%8C%85%E4%BD%93%E7%A7%AF\">优化原生和热更包体积</a></p>\n<ul>\n<li><a href=\"/docs/bestpractice/#ios-%E5%8E%9F%E7%94%9F%E5%8C%85%E4%BC%98%E5%8C%96ipa\">iOS 原生包优化(ipa)</a></li>\n<li><a href=\"/docs/bestpractice/#android-%E5%8E%9F%E7%94%9F%E5%8C%85%E4%BC%98%E5%8C%96apk\">Android 原生包优化(apk)</a></li>\n<li><a href=\"/docs/bestpractice/#%E7%83%AD%E6%9B%B4%E6%96%B0%E5%8C%85%E4%BC%98%E5%8C%96ppk\">热更新包优化(ppk)</a></li>\n</ul>\n</li>\n<li><a href=\"/docs/bestpractice/#%E6%9C%89%E5%BE%88%E5%A4%9A%E6%B8%A0%E9%81%93%E5%8C%85%E9%9C%80%E8%A6%81%E7%83%AD%E6%9B%B4%EF%BC%8C%E5%A6%82%E4%BD%95%E6%93%8D%E4%BD%9C%E6%AF%94%E8%BE%83%E6%96%B9%E4%BE%BF%EF%BC%9F\">有很多渠道包需要热更，如何操作比较方便？</a></li>\n<li><a href=\"/docs/bestpractice/#%E5%A6%82%E4%BD%95%E6%94%AF%E6%8C%81-aab-%E6%A0%BC%E5%BC%8F%E7%9A%84%E5%8E%9F%E7%94%9F%E5%8C%85%EF%BC%9F\">如何支持 aab 格式的原生包？</a></li>\n<li><a href=\"/docs/bestpractice/#ci-%E7%9A%84%E9%9B%86%E6%88%90\">CI 的集成</a></li>\n<li><a href=\"/docs/bestpractice/#%E6%B5%8B%E8%AF%95%E3%80%81%E5%8F%91%E5%B8%83%E4%B8%8E%E5%9B%9E%E6%BB%9A\">测试、发布与回滚</a></li>\n<li><a href=\"/docs/bestpractice/#%E5%85%83%E4%BF%A1%E6%81%AFmeta-info%E7%9A%84%E4%BD%BF%E7%94%A8\">元信息(Meta Info)的使用</a></li>\n</ul>","frontmatter":{"title":"场景实践","order":13,"type":"开发指南"},"fields":{"path":"/docs/bestpractice.md","slug":"/docs/bestpractice","modifiedTime":1673451553306}},"allMarkdownRemark":{"edges":[{"node":{"frontmatter":{"title":"常见问题","order":23,"type":"其他"},"fields":{"slug":"/docs/faq","path":"/docs/faq.md"}}},{"node":{"frontmatter":{"title":"更新日志","order":22,"type":"其他"},"fields":{"slug":"/docs/changelog","path":"/docs/changelog.md"}}},{"node":{"frontmatter":{"title":"场景实践","order":13,"type":"开发指南"},"fields":{"slug":"/docs/bestpractice","path":"/docs/bestpractice.md"}}},{"node":{"frontmatter":{"title":"命令行工具","order":12,"type":"开发指南"},"fields":{"slug":"/docs/cli","path":"/docs/cli.md"}}},{"node":{"frontmatter":{"title":"API参考","order":11,"type":"开发指南"},"fields":{"slug":"/docs/api","path":"/docs/api.md"}}},{"node":{"frontmatter":{"title":"发布热更新","order":2,"type":"快速入门"},"fields":{"slug":"/docs/publish","path":"/docs/publish.md"}}},{"node":{"frontmatter":{"title":"代码集成","order":1,"type":"快速入门"},"fields":{"slug":"/docs/integration","path":"/docs/integration.md"}}},{"node":{"frontmatter":{"title":"安装配置","order":0,"type":"快速入门"},"fields":{"slug":"/docs/getting-started","path":"/docs/getting-started.md"}}}]}},"pageContext":{"slug":"/docs/bestpractice","type":"/docs/"}},"staticQueryHashes":[]}