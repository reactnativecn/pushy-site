{"componentChunkName":"component---src-templates-docs-tsx","path":"/docs/publish.html","result":{"data":{"markdownRemark":{"html":"<p>现在你的应用已经具备了检测更新的功能，下面我们来尝试发布并更新它。流程可参考下图：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"https://cdn.jsdelivr.net/gh/reactnativecn/pushy-site@gh-pages/static/9e996cf8e294c5b381891a404478340e/fbaec/publishflow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 98.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAADcElEQVQ4y4VUa3fiNhDl//+cntMP3WR3aTYLXZIAwcEYbMsPbGPM27zx4/ZKQMJue1qdM7Y0Gl3NnRlNpSxLyCH/ZVmgKD5EDmHHeHoaYDBIOJ/R8Gx7ayflilM5A50Xv47T6QhHRAp0FKXw3Ak2m92/2l5xKh8KYBpbMHo69F4Pk0mC4/H4j4PL1RIdTYOu6+jRTggBy7Le9yub9Qaz2Rz9/gAPf1bx+Pgdd3f36p8kE4xGMYFPyLKMl0wRhhE+fbrDw8M33N9/xpcvX1Gr1ZVdkiSoLJdz+L6gYqjEdU14noUgcDEcCq4tHA57Bei6AnE85J6DKPJgmjpBQto5F/FQKYqQjsYMbILx2EC3W0f3rYblQlA/pYTcmzAkuZoDCdapB8t8oW0NfaOh1lIPjFDJcheLkY9u24XWidB8cfBXvY9vDxoaPwQmY08Z5vmJwDZix8Nr0+GlMV6ebdRrPdqbsM2Qlzqo5ATMTi72e5+0AqSpwGJuqvl+J3WCQJJBRhE4HjwcaLteu6RvYLf11FmpL0v3DAjILAmWhIFms866q+KUDZQOMOndB+BZ5/AiE5pWZXx1tZYYN4C2MrSsBur1r5Qqs9lUurK8ApJy7iAemnCFw9p00NP7GPoBfC/EeCQpq6SQ8kEgnTn0MEYw7CMKTWw5T1cRwewLZRlDZt7SYegWBn0Bx/Zg2z5fkYcoiM6AJRiPpIdu9RGdtxCdV8HEmPy7DHzI+EgvYwJfKTtK0m0fmv4dp6NxCcMN5ZIGRenzuXiYzgyWj0YDT3l0pSwBJdB08gbXaeGZsf7t9z/QbrN0Bk+YTt/UmZ9iKBXDoMXCfeZ8qAA+Ynj2sChkAskqNViLDex2prKTeuVhwc8udRHaASs/Rq9LqprDmhTo9wI2CFfFUHpYlgSkA4FlQ9cEXtsmbYWqQZmwEpKyrK2djdXERzIOKQE7i3x2NsZ8ZllmIS9GlxhaKkmz0YDJsxHyCfp8puPYJ6ClLiTlNWtuju0upjcTbLcRsx3w4Eyt83xBoJ1qTXmeEnxFiilldZHzPM9Xal+1r80+Q+O5CdsS6HQ0vlGdDSNgAxjhtr3dzn+V9/aV5wXm44Q0F6S7YcGOlIzjlLoVn+H+cqB8b6L/JZXTMYfR+IHWC717DaBR2i0fraaLdtOH56x+Avy/8Tf28eDawjZdagAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"https://cdn.jsdelivr.net/gh/reactnativecn/pushy-site@gh-pages/static/9e996cf8e294c5b381891a404478340e/89a28/publishflow.webp 148w,\nhttps://cdn.jsdelivr.net/gh/reactnativecn/pushy-site@gh-pages/static/9e996cf8e294c5b381891a404478340e/d4a17/publishflow.webp 295w,\nhttps://cdn.jsdelivr.net/gh/reactnativecn/pushy-site@gh-pages/static/9e996cf8e294c5b381891a404478340e/1ebe6/publishflow.webp 590w,\nhttps://cdn.jsdelivr.net/gh/reactnativecn/pushy-site@gh-pages/static/9e996cf8e294c5b381891a404478340e/48d89/publishflow.webp 670w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"https://cdn.jsdelivr.net/gh/reactnativecn/pushy-site@gh-pages/static/9e996cf8e294c5b381891a404478340e/4ef9d/publishflow.png 148w,\nhttps://cdn.jsdelivr.net/gh/reactnativecn/pushy-site@gh-pages/static/9e996cf8e294c5b381891a404478340e/87239/publishflow.png 295w,\nhttps://cdn.jsdelivr.net/gh/reactnativecn/pushy-site@gh-pages/static/9e996cf8e294c5b381891a404478340e/bc1df/publishflow.png 590w,\nhttps://cdn.jsdelivr.net/gh/reactnativecn/pushy-site@gh-pages/static/9e996cf8e294c5b381891a404478340e/fbaec/publishflow.png 670w\"\n          sizes=\"(max-width: 590px) 100vw, 590px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"https://cdn.jsdelivr.net/gh/reactnativecn/pushy-site@gh-pages/static/9e996cf8e294c5b381891a404478340e/bc1df/publishflow.png\"\n          alt=\"publishflow\"\n          title=\"publishflow\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<p>一般来说我们需要先发布原生基准版本，然后在基准版本之上迭代业务逻辑，发布热更新版本。如果迭代过程中有原生方面的修改，则需要发布新的基准版本。可以只保留一个原生基准版本，也可以多版本同时维护。</p>\n<h2 id=\"发布原生基准版本\" style=\"position:relative;\"><a href=\"#%E5%8F%91%E5%B8%83%E5%8E%9F%E7%94%9F%E5%9F%BA%E5%87%86%E7%89%88%E6%9C%AC\" aria-label=\"发布原生基准版本 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>发布原生基准版本</h2>\n<h3 id=\"ios\" style=\"position:relative;\"><a href=\"#ios\" aria-label=\"ios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>iOS</h3>\n<p>首先参考<a href=\"https://reactnative.cn/docs/running-on-device\">文档-在设备上运行</a>，确定你正在使用离线包。然后点击菜单。</p>\n<p>按照正常的发布流程打包<code>.ipa</code>文件：</p>\n<ol>\n<li>Xcode 中运行设备选真机或 Generic iOS Device</li>\n<li>菜单中选择 Product - Archive</li>\n<li>Archive 完成后选择<code>Export</code>生成.ipa 文件，此时建议取消 bitcode 选项以减少 ipa 大小</li>\n<li>然后运行如下命令上传到 pushy 服务器以供后续版本比对之用</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ pushy uploadIpa <span class=\"token operator\">&lt;</span>ipa后缀文件<span class=\"token operator\">></span></code></pre></div>\n<p>此 ipa 的<code>CFBundleShortVersionString</code>字段(位于<code>ios/项目名/Info.plist</code>中)会被记录为原生版本号<code>packageVersion</code>。</p>\n<p>随后你可以选择往 AppStore 上传这个版本（注意是刚刚已经 archive 完成的包重新选择 Upload 选项，且此时应该勾选 bitcode 选项），也可以先通过<a href=\"https://developer.apple.com/cn/testflight/\">Test flight</a>或<a href=\"https://www.pgyer.com/doc/view/build_ipa\">蒲公英</a>等渠道进行真机安装测试。请注意：暂不支持通过 Xcode 直接进行热更新测试。</p>\n<p>如果后续需要再次打包（例如修改原生代码或配置），请先<strong>更改版本号</strong>，并再次<code>uploadIpa</code>到服务器端记录，否则后续生成的相同版本的原生包会由于<a href=\"faq.html#%E7%83%AD%E6%9B%B4%E6%96%B0%E6%8A%A5%E9%94%99%EF%BC%9A%E7%83%AD%E6%9B%B4%E6%96%B0%E5%B7%B2%E6%9A%82%E5%81%9C%EF%BC%8C%E5%8E%9F%E5%9B%A0%EF%BC%9Abuildtime-mismatch%E3%80%82\">编译时间戳不一致而<code>无法获取热更新</code></a>。</p>\n<blockquote>\n<p>注意：如果你在上传之前就运行了新的原生版本，由于服务器端没有记录，会暂停其更新数小时。可在删除原先安装的 app 再重新安装以清空暂停设置。在上传之后安装的客户端不会受此影响。</p>\n</blockquote>\n<h3 id=\"android\" style=\"position:relative;\"><a href=\"#android\" aria-label=\"android permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Android</h3>\n<p>首先参考<a href=\"https://reactnative.cn/docs/signed-apk-android\">文档-打包 APK</a>设置签名，然后在 android 文件夹下运行<code>./gradlew assembleRelease</code>或<code>./gradlew aR</code>，你就可以在<code>android/app/build/outputs/apk/release/app-release.apk</code>中找到你的应用包。</p>\n<blockquote>\n<p>如果你需要使用 aab 格式（android app bundle，google 市场专用）的包，请参考这里的<a href=\"bestpractice.html#%E5%A6%82%E4%BD%95%E6%94%AF%E6%8C%81-aab-%E6%A0%BC%E5%BC%8F%E7%9A%84%E5%8E%9F%E7%94%9F%E5%8C%85%EF%BC%9F\">做法</a>将其转换为 apk 格式后再操作。</p>\n</blockquote>\n<p>然后运行如下命令</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ pushy uploadApk android/app/build/outputs/apk/release/app-release.apk</code></pre></div>\n<p>即可上传 apk 以供后续版本比对之用。此 apk 的<code>versionName</code>字段(位于<code>android/app/build.gralde</code>中)会被记录为原生版本号<code>packageVersion</code>。</p>\n<p>随后你可以选择往应用市场发布这个版本，也可以先往设备上直接安装这个 apk 文件以进行测试。</p>\n<p>如果后续需要再次打包（例如修改原生代码或配置），请先<strong>更改版本号</strong>，并再次<code>uploadApk</code>到服务器端记录，否则后续生成的相同版本的原生包会由于<a href=\"faq.html#%E7%83%AD%E6%9B%B4%E6%96%B0%E6%8A%A5%E9%94%99%EF%BC%9A%E7%83%AD%E6%9B%B4%E6%96%B0%E5%B7%B2%E6%9A%82%E5%81%9C%EF%BC%8C%E5%8E%9F%E5%9B%A0%EF%BC%9Abuildtime-mismatch%E3%80%82\">编译时间戳不一致而<code>无法获取热更新</code></a>。</p>\n<blockquote>\n<p>注意：如果你在上传之前就运行了新的原生版本，由于服务器端没有记录，会暂停其更新数小时。可删除原先安装的 app 再重新安装以清空暂停设置。在上传之后安装的客户端不会受此影响。</p>\n</blockquote>\n<h2 id=\"发布热更新版本\" style=\"position:relative;\"><a href=\"#%E5%8F%91%E5%B8%83%E7%83%AD%E6%9B%B4%E6%96%B0%E7%89%88%E6%9C%AC\" aria-label=\"发布热更新版本 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>发布热更新版本</h2>\n<p>你可以尝试修改一行代码(譬如将版本一修改为版本二)，然后使用<code>pushy bundle --platform &#x3C;ios|android></code>命令来生成新的热更新版本。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ pushy bundle --platform android\nBundling with React Native version:  <span class=\"token number\">0.22</span>.2\n<span class=\"token operator\">&lt;</span>各种进度输出<span class=\"token operator\">></span>\nBundled saved to: build/output/android.1459850548545.ppk\nWould you like to publish it?<span class=\"token punctuation\">(</span>Y/N<span class=\"token punctuation\">)</span></code></pre></div>\n<p>如果想要立即上传，此时输入 Y。当然，你也可以在将来使用<code>pushy publish --platform android build/output/android.1459850548545.ppk</code>来上传刚才打包好的热更新包。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  Uploading [========================================================] 100% 0.0s\nEnter version name: &lt;输入热更新版本名字，如1.0.0-rc&gt;\nEnter description: &lt;输入热更新版本描述&gt;\nEnter meta info: {&quot;ok&quot;:1}\nOk.\nWould you like to bind packages to this version?(Y/N)</code></pre></div>\n<p>此时版本已经提交到 pushy 服务，但用户暂时看不到此更新，你需要先将特定的原生包版本绑定到此热更新版本上。</p>\n<p>此时输入 Y 立即绑定，你也可以在将来使用<code>pushy update --platform &#x3C;ios|android></code>来对已上传的热更包和原生包进行绑定。除此以外，你还可以在网页端操作，简单的将对应的原生包版本拖到需要的热更新版本下即可。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">┌────────────┬──────────────────────────────────────┐\n│ Package Id │               Version                │\n├────────────┼──────────────────────────────────────┤\n│   46272    │ 2.0(normal)                          │\n├────────────┼──────────────────────────────────────┤\n│   45577    │ 1.0(normal)                          │\n└────────────┴──────────────────────────────────────┘\n共 2 个包\n输入原生包 id: 46272</code></pre></div>\n<p>版本绑定完毕后，服务器会在几秒内生成差量补丁，客户端就可以获取到更新了。</p>\n<p>后续要继续发布新的热更新，只需反复执行<code>pushy bundle</code>命令即可。</p>\n<p>恭喜你，至此为止，你已经完成了植入代码热更新的全部工作。</p>","tableOfContents":"<ul>\n<li>\n<p><a href=\"/docs/publish/#%E5%8F%91%E5%B8%83%E5%8E%9F%E7%94%9F%E5%9F%BA%E5%87%86%E7%89%88%E6%9C%AC\">发布原生基准版本</a></p>\n<ul>\n<li><a href=\"/docs/publish/#ios\">iOS</a></li>\n<li><a href=\"/docs/publish/#android\">Android</a></li>\n</ul>\n</li>\n<li><a href=\"/docs/publish/#%E5%8F%91%E5%B8%83%E7%83%AD%E6%9B%B4%E6%96%B0%E7%89%88%E6%9C%AC\">发布热更新版本</a></li>\n</ul>","frontmatter":{"title":"发布热更新","order":2,"type":"快速入门"},"fields":{"path":"/docs/publish.md","slug":"/docs/publish","modifiedTime":1647417906461}},"allMarkdownRemark":{"edges":[{"node":{"frontmatter":{"title":"常见问题","order":23,"type":"其他"},"fields":{"slug":"/docs/faq","path":"/docs/faq.md"}}},{"node":{"frontmatter":{"title":"更新日志","order":22,"type":"其他"},"fields":{"slug":"/docs/changelog","path":"/docs/changelog.md"}}},{"node":{"frontmatter":{"title":"场景实践","order":13,"type":"开发指南"},"fields":{"slug":"/docs/bestpractice","path":"/docs/bestpractice.md"}}},{"node":{"frontmatter":{"title":"命令行工具","order":12,"type":"开发指南"},"fields":{"slug":"/docs/cli","path":"/docs/cli.md"}}},{"node":{"frontmatter":{"title":"API参考","order":11,"type":"开发指南"},"fields":{"slug":"/docs/api","path":"/docs/api.md"}}},{"node":{"frontmatter":{"title":"发布热更新","order":2,"type":"快速入门"},"fields":{"slug":"/docs/publish","path":"/docs/publish.md"}}},{"node":{"frontmatter":{"title":"代码集成","order":1,"type":"快速入门"},"fields":{"slug":"/docs/integration","path":"/docs/integration.md"}}},{"node":{"frontmatter":{"title":"安装配置","order":0,"type":"快速入门"},"fields":{"slug":"/docs/getting-started","path":"/docs/getting-started.md"}}}]}},"pageContext":{"slug":"/docs/publish","type":"/docs/"}},"staticQueryHashes":[]}