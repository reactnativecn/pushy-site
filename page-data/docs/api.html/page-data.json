{"componentChunkName":"component---src-templates-docs-tsx","path":"/docs/api.html","result":{"data":{"markdownRemark":{"html":"<h3 id=\"javascript-常量\" style=\"position:relative;\"><a href=\"#javascript-%E5%B8%B8%E9%87%8F\" aria-label=\"javascript 常量 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JavaScript 常量</h3>\n<hr>\n<h4 id=\"downloadrootdir\" style=\"position:relative;\"><a href=\"#downloadrootdir\" aria-label=\"downloadrootdir permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>downloadRootDir</h4>\n<p>下载的根目录。你可以使用<code>react-native-fs</code>等第三方组件读取其中的内容。</p>\n<hr>\n<h4 id=\"packageversion\" style=\"position:relative;\"><a href=\"#packageversion\" aria-label=\"packageversion permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>packageVersion</h4>\n<p>当前应用原生包的版本。其中 android 取自<code>versionName</code>字段(位于<code>android/app/build.gradle</code>中)。ios 取自<code>CFBundleShortVersionString</code>字段(位于<code>ios/项目名/Info.plist</code>中)。</p>\n<hr>\n<h4 id=\"currentversion\" style=\"position:relative;\"><a href=\"#currentversion\" aria-label=\"currentversion permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>currentVersion</h4>\n<p>当前热更新版本（jsbundle 文件）的 Hash 号。</p>\n<hr>\n<h4 id=\"isfirsttime\" style=\"position:relative;\"><a href=\"#isfirsttime\" aria-label=\"isfirsttime permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>isFirstTime</h4>\n<p>是否更新后的首次启动。当此项为真时，你需要在合适的时候调用<code>markSuccess()</code>以确保更新成功。否则应用下一次启动时将会回滚。</p>\n<hr>\n<h4 id=\"isrolledback\" style=\"position:relative;\"><a href=\"#isrolledback\" aria-label=\"isrolledback permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>isRolledBack</h4>\n<p>是否刚刚经历了一次回滚。</p>\n<h3 id=\"javascript-方法\" style=\"position:relative;\"><a href=\"#javascript-%E6%96%B9%E6%B3%95\" aria-label=\"javascript 方法 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JavaScript 方法</h3>\n<hr>\n<h4 id=\"async-function-checkupdateappkey\" style=\"position:relative;\"><a href=\"#async-function-checkupdateappkey\" aria-label=\"async function checkupdateappkey permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>async function checkUpdate(appKey)</h4>\n<p>检查更新，返回值有三种情形：</p>\n<ol>\n<li><code>{expired: true}</code>：该应用原生包版本被设置为过期（或已从 pushy 服务器中删除，或从未上传），需要前往应用市场下载新的版本(在设置中填写 downloadUrl)。</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n    expired<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    downloadUrl<span class=\"token operator\">:</span> <span class=\"token string\">'http://appstore/downloadUrl'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"2\">\n<li><code>{upToDate: true}</code>：当前已经更新到最新，无需进行更新。</li>\n<li><code>{update: true}</code>：当前有新版本可以更新。info 的<code>name</code>、<code>description</code>字段可以用于提示用户，而<code>metaInfo</code>字段则可以根据你的需求自定义一些标记(如是否静默更新、是否强制更新等等，自己根据标记的属性做一些条件流程控制)，具体用法可参考<a href=\"bestpractice.html#%E5%85%83%E4%BF%A1%E6%81%AFmeta-info%E7%9A%84%E4%BD%BF%E7%94%A8\">场景实践</a>。另外还有几个字段，包含了热更新文件的下载地址，</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n    update<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    name<span class=\"token operator\">:</span> <span class=\"token string\">'1.0.3-rc'</span><span class=\"token punctuation\">,</span>\n    hash<span class=\"token operator\">:</span> <span class=\"token string\">'hash'</span><span class=\"token punctuation\">,</span>\n    description<span class=\"token operator\">:</span> <span class=\"token string\">'添加聊天功能\\n修复商城页面BUG'</span><span class=\"token punctuation\">,</span>\n    metaInfo<span class=\"token operator\">:</span> <span class=\"token string\">'{\"silent\":true}'</span><span class=\"token punctuation\">,</span>\n    pdiffUrl<span class=\"token operator\">:</span> <span class=\"token string\">'http://update-packages.reactnative.cn/hash'</span><span class=\"token punctuation\">,</span>\n    diffUrl<span class=\"token operator\">:</span> <span class=\"token string\">'http://update-packages.reactnative.cn/hash'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<hr>\n<h4 id=\"async-function-downloadupdateinfo-callbacks\" style=\"position:relative;\"><a href=\"#async-function-downloadupdateinfo-callbacks\" aria-label=\"async function downloadupdateinfo callbacks permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>async function downloadUpdate(info, callbacks)</h4>\n<p>下载更新版本。<code>info</code>为<code>checkUpdate</code>函数的返回值，并且仅当<code>update:true</code>时实际进行下载。</p>\n<p>从<code>v5.8.3</code>版本开始新增接受第二个可选参数，为下载进度的回调函数（<code>onDownloadProgress</code>）。可根据回调参数自行设计进度的展示。示例：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> hash <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">downloadUpdate</span><span class=\"token punctuation\">(</span>\n  info<span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// 下载回调为可选参数，自v5.8.3版本起可用</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">onDownloadProgress</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> received<span class=\"token punctuation\">,</span> total <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// 已下载的字节数, 总字节数</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>received<span class=\"token punctuation\">,</span> total<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<hr>\n<h4 id=\"async-function-downloadandinstallapk-url-ondownloadprogress-\" style=\"position:relative;\"><a href=\"#async-function-downloadandinstallapk-url-ondownloadprogress-\" aria-label=\"async function downloadandinstallapk url ondownloadprogress  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>async function downloadAndInstallApk({ url, onDownloadProgress })</h4>\n<p>下载更新的 apk 包并直接安装。<code>url</code>必须为可直接下载到 apk 文件的地址，<code>onDownloadProgress</code>为可选的下载进度回调函数，可根据回调参数自行设计进度的展示。自<code>v5.9.0</code>版本起可用。</p>\n<p>注意从<code>v9.1.0</code>版本起，要使用这个功能需要在<code>AndroidManifest.xml</code>中手动添加安装权限，如果需要考虑 Android 7.0 以下的客户，则还需要添加外部存储权限。</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>uses-permission</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>android.permission.REQUEST_INSTALL_PACKAGES<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n<span class=\"token comment\">&lt;!-- 如果需要考虑Android 7.0以下的客户，则还需要添加外部存储权限 --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>uses-permission</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>android.permission.WRITE_EXTERNAL_STORAGE<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></code></pre></div>\n<p>注意某些应用市场可能会因为上述权限拒绝应用上架。去掉上述两个权限并不影响热更新功能。</p>\n<hr>\n<h4 id=\"function-marksuccess\" style=\"position:relative;\"><a href=\"#function-marksuccess\" aria-label=\"function marksuccess permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>function markSuccess()</h4>\n<p>在<code>isFirstTime</code>为<code>true</code>时，必须调用此函数作为更新成功的标记（否则下次启动会默认失败自动回滚）。</p>\n<hr>\n<h4 id=\"async-function-getcurrentversioninfo\" style=\"position:relative;\"><a href=\"#async-function-getcurrentversioninfo\" aria-label=\"async function getcurrentversioninfo permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>async function getCurrentVersionInfo()</h4>\n<p>获取当前已热更版本的信息（如尚未热更过则返回空对象）。</p>\n<p>返回值示例：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n    name<span class=\"token operator\">:</span> <span class=\"token string\">'1.0.3-rc'</span><span class=\"token punctuation\">,</span>\n    description<span class=\"token operator\">:</span> <span class=\"token string\">'添加聊天功能\\n修复商城页面BUG'</span><span class=\"token punctuation\">,</span>\n    metaInfo<span class=\"token operator\">:</span> <span class=\"token string\">'{\"silent\":true}'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<hr>\n<h4 id=\"function-switchversionhash\" style=\"position:relative;\"><a href=\"#function-switchversionhash\" aria-label=\"function switchversionhash permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>function switchVersion(hash)</h4>\n<p>立即重启应用，并加载已经下载完毕的版本。</p>\n<hr>\n<h4 id=\"function-switchversionlaterhash\" style=\"position:relative;\"><a href=\"#function-switchversionlaterhash\" aria-label=\"function switchversionlaterhash permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>function switchVersionLater(hash)</h4>\n<p>在下一次启动应用的时候加载已经下载完毕的版本。</p>\n<hr>\n<h4 id=\"function-simpleupdateapp-componenttype--appkey-string-onpushyevents--type-eventtype-data-eventdata---void-\" style=\"position:relative;\"><a href=\"#function-simpleupdateapp-componenttype--appkey-string-onpushyevents--type-eventtype-data-eventdata---void-\" aria-label=\"function simpleupdateapp componenttype  appkey string onpushyevents  type eventtype data eventdata   void  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>function simpleUpdate(App: ComponentType, { appKey: string; onPushyEvents?: ({ type: EventType; data: EventData }) => void })</h4>\n<p>极简热更新集成，示例请见<a href=\"/docs/integration.html#%E6%9E%81%E7%AE%80%E5%BF%AB%E9%80%9F%E9%9B%86%E6%88%90\">集成文档</a>，其中<code>onPushyEvents</code>参数请看下面的方法说明。</p>\n<hr>\n<h4 id=\"function-onpushyevents-type-eventtype-data-eventdata---void\" style=\"position:relative;\"><a href=\"#function-onpushyevents-type-eventtype-data-eventdata---void\" aria-label=\"function onpushyevents type eventtype data eventdata   void permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>function onPushyEvents(({ type: EventType; data: EventData }) => void)</h4>\n<p>发生某个事件时的回调，可用于上报统计数据。自<code>v8.4.0</code>版本后可用。其中回调参数构型具体如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">// 回调事件类型</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">type</span> EventType <span class=\"token operator\">=</span>\n  <span class=\"token operator\">|</span> <span class=\"token string\">'rollback'</span> <span class=\"token comment\">// 回滚</span>\n  <span class=\"token operator\">|</span> <span class=\"token string\">'errorChecking'</span> <span class=\"token comment\">// 查询热更时出错</span>\n  <span class=\"token operator\">|</span> <span class=\"token string\">'checking'</span> <span class=\"token comment\">// 正在查询热更</span>\n  <span class=\"token operator\">|</span> <span class=\"token string\">'downloading'</span> <span class=\"token comment\">// 正在下载热更</span>\n  <span class=\"token operator\">|</span> <span class=\"token string\">'errorUpdate'</span> <span class=\"token comment\">// 热更时出错</span>\n  <span class=\"token operator\">|</span> <span class=\"token string\">'markSuccess'</span> <span class=\"token comment\">// 热更后成功标记</span>\n  <span class=\"token operator\">|</span> <span class=\"token string\">'downloadingApk'</span> <span class=\"token comment\">// 正在下载apk</span>\n  <span class=\"token operator\">|</span> <span class=\"token string\">'rejectStoragePermission'</span> <span class=\"token comment\">// 下载apk前申请存储权限被用户拒绝</span>\n  <span class=\"token operator\">|</span> <span class=\"token string\">'errorStoragePermission'</span> <span class=\"token comment\">// 下载apk前申请存储权限出错</span>\n  <span class=\"token operator\">|</span> <span class=\"token string\">'errowDownloadAndInstallApk'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 下载或安装apk时出错</span>\n\n<span class=\"token comment\">// 回调事件数据</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">EventData</span> <span class=\"token punctuation\">{</span>\n  currentVersion<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 当前版本hash</span>\n  cInfo<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    pushy<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 当前pushy版本</span>\n    rn<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 当前rn版本</span>\n    os<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 当前操作系统及版本</span>\n    uuid<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 用户标识符</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  packageVersion<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 原生包版本</span>\n  buildTime<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 原生包编译时间戳</span>\n  message<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 相关说明信息</span>\n  rolledBackVersion<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 热更失败，回滚后的版本hash</span>\n  newVersion<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 已下载但热更失败的hash</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<hr>\n<h3 id=\"android-方法\" style=\"position:relative;\"><a href=\"#android-%E6%96%B9%E6%B3%95\" aria-label=\"android 方法 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Android 方法</h3>\n<h4 id=\"updatecontextsetcustominstancemanagerreactinstancemanager-instancemanager\" style=\"position:relative;\"><a href=\"#updatecontextsetcustominstancemanagerreactinstancemanager-instancemanager\" aria-label=\"updatecontextsetcustominstancemanagerreactinstancemanager instancemanager permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>UpdateContext.setCustomInstanceManager(ReactInstanceManager instanceManager)</h4>\n<p>如果是集成/混编 Android 方案，则可以使用此方法传入你自行创建的 ReactInstanceManager。自<code>v5.5.8</code>版本起可用。</p>\n<p>示例：</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">import</span> <span class=\"token namespace\">cn<span class=\"token punctuation\">.</span>reactnative<span class=\"token punctuation\">.</span>modules<span class=\"token punctuation\">.</span>update</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">UpdateContext</span>\n\nmReactInstanceManager <span class=\"token operator\">=</span> <span class=\"token class-name\">ReactInstanceManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token comment\">// ...各种setter，但注意不要调用setBundleAssetName</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">setJSBundleFile</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UpdateContext</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBundleUrl</span><span class=\"token punctuation\">(</span>mContext<span class=\"token punctuation\">,</span> <span class=\"token string\">\"assets://index.android.bundle\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">UpdateContext</span><span class=\"token punctuation\">.</span><span class=\"token function\">setCustomInstanceManager</span><span class=\"token punctuation\">(</span>mReactInstanceManager<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>","tableOfContents":"<ul>\n<li>\n<p><a href=\"/docs/api/#javascript-%E5%B8%B8%E9%87%8F\">JavaScript 常量</a></p>\n<ul>\n<li><a href=\"/docs/api/#downloadrootdir\">downloadRootDir</a></li>\n<li><a href=\"/docs/api/#packageversion\">packageVersion</a></li>\n<li><a href=\"/docs/api/#currentversion\">currentVersion</a></li>\n<li><a href=\"/docs/api/#isfirsttime\">isFirstTime</a></li>\n<li><a href=\"/docs/api/#isrolledback\">isRolledBack</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/docs/api/#javascript-%E6%96%B9%E6%B3%95\">JavaScript 方法</a></p>\n<ul>\n<li><a href=\"/docs/api/#async-function-checkupdateappkey\">async function checkUpdate(appKey)</a></li>\n<li><a href=\"/docs/api/#async-function-downloadupdateinfo-callbacks\">async function downloadUpdate(info, callbacks)</a></li>\n<li><a href=\"/docs/api/#async-function-downloadandinstallapk-url-ondownloadprogress-\">async function downloadAndInstallApk({ url, onDownloadProgress })</a></li>\n<li><a href=\"/docs/api/#function-marksuccess\">function markSuccess()</a></li>\n<li><a href=\"/docs/api/#async-function-getcurrentversioninfo\">async function getCurrentVersionInfo()</a></li>\n<li><a href=\"/docs/api/#function-switchversionhash\">function switchVersion(hash)</a></li>\n<li><a href=\"/docs/api/#function-switchversionlaterhash\">function switchVersionLater(hash)</a></li>\n<li><a href=\"/docs/api/#function-simpleupdateapp-componenttype--appkey-string-onpushyevents--type-eventtype-data-eventdata---void-\">function simpleUpdate(App: ComponentType, { appKey: string; onPushyEvents?: ({ type: EventType; data: EventData }) => void })</a></li>\n<li><a href=\"/docs/api/#function-onpushyevents-type-eventtype-data-eventdata---void\">function onPushyEvents(({ type: EventType; data: EventData }) => void)</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/docs/api/#android-%E6%96%B9%E6%B3%95\">Android 方法</a></p>\n<ul>\n<li><a href=\"/docs/api/#updatecontextsetcustominstancemanagerreactinstancemanager-instancemanager\">UpdateContext.setCustomInstanceManager(ReactInstanceManager instanceManager)</a></li>\n</ul>\n</li>\n</ul>","frontmatter":{"title":"API参考","order":11,"type":"开发指南"},"fields":{"path":"/docs/api.md","slug":"/docs/api","modifiedTime":1698489776587}},"allMarkdownRemark":{"edges":[{"node":{"frontmatter":{"title":"常见问题","order":23,"type":"其他"},"fields":{"slug":"/docs/faq","path":"/docs/faq.md"}}},{"node":{"frontmatter":{"title":"更新日志","order":22,"type":"其他"},"fields":{"slug":"/docs/changelog","path":"/docs/changelog.md"}}},{"node":{"frontmatter":{"title":"场景实践","order":13,"type":"开发指南"},"fields":{"slug":"/docs/bestpractice","path":"/docs/bestpractice.md"}}},{"node":{"frontmatter":{"title":"命令行工具","order":12,"type":"开发指南"},"fields":{"slug":"/docs/cli","path":"/docs/cli.md"}}},{"node":{"frontmatter":{"title":"API参考","order":11,"type":"开发指南"},"fields":{"slug":"/docs/api","path":"/docs/api.md"}}},{"node":{"frontmatter":{"title":"发布热更新","order":2,"type":"快速入门"},"fields":{"slug":"/docs/publish","path":"/docs/publish.md"}}},{"node":{"frontmatter":{"title":"代码集成","order":1,"type":"快速入门"},"fields":{"slug":"/docs/integration","path":"/docs/integration.md"}}},{"node":{"frontmatter":{"title":"安装配置","order":0,"type":"快速入门"},"fields":{"slug":"/docs/getting-started","path":"/docs/getting-started.md"}}}]}},"pageContext":{"slug":"/docs/api","type":"/docs/"}},"staticQueryHashes":[]}