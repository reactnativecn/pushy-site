{"componentChunkName":"component---src-templates-docs-tsx","path":"/docs/integration.html","result":{"data":{"markdownRemark":{"html":"<p>安装配置完成后，确定应用编译顺利通过，下面我们来进行代码集成。</p>\n<h2 id=\"极简快速集成\" style=\"position:relative;\"><a href=\"#%E6%9E%81%E7%AE%80%E5%BF%AB%E9%80%9F%E9%9B%86%E6%88%90\" aria-label=\"极简快速集成 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>极简快速集成</h2>\n<p>我们从 v7.x 版本开始提供极简的一行式集成（老版本只能使用自定义集成方式）：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> simpleUpdate <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-native-update'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 整个应用的根组件</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 对根组件使用simpleUpdate方法封装后导出</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token function\">simpleUpdate</span><span class=\"token punctuation\">(</span>App<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>此方式默认在 App 启动，以及从后台切换到前台时触发更新检查，弹出提示的内容也固定。如需自定义触发时机，以及修改界面提示等，请参考下面的自定义集成方式。</p>\n<h2 id=\"自定义集成\" style=\"position:relative;\"><a href=\"#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%9B%86%E6%88%90\" aria-label=\"自定义集成 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>自定义集成</h2>\n<h3 id=\"获取-appkey\" style=\"position:relative;\"><a href=\"#%E8%8E%B7%E5%8F%96-appkey\" aria-label=\"获取 appkey permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>获取 appKey</h3>\n<p>检查更新时必须提供你的<code>appKey</code>，这个值保存在<code>update.json</code>中，并且根据平台不同而不同。你可以用如下的代码获取：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Platform <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-native'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> _updateConfig <span class=\"token keyword\">from</span> <span class=\"token string\">'./update.json'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> appKey <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> _updateConfig<span class=\"token punctuation\">[</span>Platform<span class=\"token punctuation\">.</span><span class=\"token constant\">OS</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>如果你不使用 pushy 命令行，也可以从网页端查看到两个应用 appKey，并根据平台的不同来选择。</p>\n<h3 id=\"检查更新、下载更新\" style=\"position:relative;\"><a href=\"#%E6%A3%80%E6%9F%A5%E6%9B%B4%E6%96%B0%E3%80%81%E4%B8%8B%E8%BD%BD%E6%9B%B4%E6%96%B0\" aria-label=\"检查更新、下载更新 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>检查更新、下载更新</h3>\n<p>异步函数<a href=\"api.html#async-function-checkupdateappkey\"><code>checkUpdate</code></a>可以检查当前版本是否需要更新：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> info <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">checkUpdate</span><span class=\"token punctuation\">(</span>appKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>返回的<a href=\"api.html#async-function-checkupdateappkey\"><code>info</code></a>有三种情况：</p>\n<ol>\n<li><code>{expired: true}</code>：该应用原生包已过期（已从 pushy 服务器中删除），开发者应该在 pushy 控制台添加一个更新下载链接，并自行提示用户下载。</li>\n<li><code>{upToDate: true}</code>：当前已经更新到最新，无需进行更新。</li>\n<li><code>{update: true}</code>：当前有新版本可以更新。info 的<code>name</code>、<code>description</code>字段可以用于提示用户，而<code>metaInfo</code>字段则可以根据你的需求自定义其它属性(如是否静默更新、是否强制更新等等)，具体用法可参考<a href=\"bestpractice.html#%E5%85%83%E4%BF%A1%E6%81%AFmeta-info%E7%9A%84%E4%BD%BF%E7%94%A8\">场景实践</a>。另外还有几个字段，包含了补丁包的下载地址等。 pushy 会首先尝试耗费流量更少的更新方式。将<code>info</code>对象传递给<code>downloadUpdate</code>方法作为参数即可。</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> hash <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">downloadUpdate</span><span class=\"token punctuation\">(</span>\n  info<span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// 下载回调为可选参数，从v5.8.3版本开始加入</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">onDownloadProgress</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> received<span class=\"token punctuation\">,</span> total <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// 已下载的字节数, 总字节数</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>received<span class=\"token punctuation\">,</span> total<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code>downloadUpdate</code>方法从<code>v5.8.3</code>版本开始新增接受第二个可选参数，为下载进度的回调函数（<code>onDownloadProgress</code>）。可根据回调参数自行设计进度的展示。</p>\n<h3 id=\"切换版本\" style=\"position:relative;\"><a href=\"#%E5%88%87%E6%8D%A2%E7%89%88%E6%9C%AC\" aria-label=\"切换版本 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>切换版本</h3>\n<p><code>downloadUpdate</code>的返回值是一个 hash 字符串，它是当前热更新版本的唯一标识。</p>\n<p>你可以使用<code>switchVersion(hash)</code>函数立即切换版本(此时应用会立即重新加载)，或者选择调用 <code>switchVersionLater(hash)</code>，让应用在下一次启动的时候再加载新的版本。</p>\n<h3 id=\"首次启动、回滚\" style=\"position:relative;\"><a href=\"#%E9%A6%96%E6%AC%A1%E5%90%AF%E5%8A%A8%E3%80%81%E5%9B%9E%E6%BB%9A\" aria-label=\"首次启动、回滚 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>首次启动、回滚</h3>\n<p>在每次更新完毕后的首次启动时，<code>isFirstTime</code>常量会为<code>true</code>。你必须在应用退出前合适的任何时机，调用<code>markSuccess</code>，否则应用下一次启动的时候将会进行回滚操作。这一机制称作“反触发”，这样当你应用启动初期即遭遇问题的时候，也能在下一次启动时恢复运作。</p>\n<p>你可以通过<code>isFirstTime</code>来获知这是当前版本的首次启动，也可以通过<code>isRolledBack</code>来获知应用刚刚经历了一次回滚操作。你可以在此时给予用户合理的提示。</p>\n<p>以上提及的所有 api 的说明文档可在<a href=\"api.html\">这里</a>查看。</p>\n<h3 id=\"完整的示例\" style=\"position:relative;\"><a href=\"#%E5%AE%8C%E6%95%B4%E7%9A%84%E7%A4%BA%E4%BE%8B\" aria-label=\"完整的示例 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>完整的示例</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> Component <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> StyleSheet<span class=\"token punctuation\">,</span> Platform<span class=\"token punctuation\">,</span> Text<span class=\"token punctuation\">,</span> View<span class=\"token punctuation\">,</span> Alert<span class=\"token punctuation\">,</span> TouchableOpacity<span class=\"token punctuation\">,</span> Linking <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-native'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n  isFirstTime<span class=\"token punctuation\">,</span>\n  isRolledBack<span class=\"token punctuation\">,</span>\n  packageVersion<span class=\"token punctuation\">,</span>\n  currentVersion<span class=\"token punctuation\">,</span>\n  checkUpdate<span class=\"token punctuation\">,</span>\n  downloadUpdate<span class=\"token punctuation\">,</span>\n  switchVersion<span class=\"token punctuation\">,</span>\n  switchVersionLater<span class=\"token punctuation\">,</span>\n  markSuccess<span class=\"token punctuation\">,</span>\n  downloadAndInstallApk<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-native-update'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> _updateConfig <span class=\"token keyword\">from</span> <span class=\"token string\">'./update.json'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> appKey <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> _updateConfig<span class=\"token punctuation\">[</span>Platform<span class=\"token punctuation\">.</span><span class=\"token constant\">OS</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyProject</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span>\n  state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    received<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    total<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isFirstTime<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// 必须调用此更新成功标记方法</span>\n      <span class=\"token comment\">// 否则默认更新失败，下一次启动会自动回滚</span>\n      <span class=\"token function\">markSuccess</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'更新完成'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isRolledBack<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'刚刚更新失败了,版本被回滚.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function-variable function\">doUpdate</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">info</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> hash <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">downloadUpdate</span><span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function-variable function\">onDownloadProgress</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> received<span class=\"token punctuation\">,</span> total <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            received<span class=\"token punctuation\">,</span>\n            total<span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>hash<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      Alert<span class=\"token punctuation\">.</span><span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'提示'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'下载完毕,是否重启应用?'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n          text<span class=\"token operator\">:</span> <span class=\"token string\">'是'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token function-variable function\">onPress</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">switchVersion</span><span class=\"token punctuation\">(</span>hash<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span> text<span class=\"token operator\">:</span> <span class=\"token string\">'否'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n          text<span class=\"token operator\">:</span> <span class=\"token string\">'下次启动时'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token function-variable function\">onPress</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">switchVersionLater</span><span class=\"token punctuation\">(</span>hash<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      Alert<span class=\"token punctuation\">.</span><span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'更新失败'</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function-variable function\">checkUpdate</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>__DEV__<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// 开发模式不支持热更新，跳过检查</span>\n      <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">let</span> info<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      info <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">checkUpdate</span><span class=\"token punctuation\">(</span>appKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      Alert<span class=\"token punctuation\">.</span><span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'更新检查失败'</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">.</span>expired<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      Alert<span class=\"token punctuation\">.</span><span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'提示'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'您的应用版本已更新，点击确定下载安装新版本'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n          text<span class=\"token operator\">:</span> <span class=\"token string\">'确定'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token function-variable function\">onPress</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">.</span>downloadUrl<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token comment\">// apk可直接下载安装</span>\n              <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Platform<span class=\"token punctuation\">.</span><span class=\"token constant\">OS</span> <span class=\"token operator\">===</span> <span class=\"token string\">'android'</span> <span class=\"token operator\">&amp;&amp;</span> info<span class=\"token punctuation\">.</span>downloadUrl<span class=\"token punctuation\">.</span><span class=\"token function\">endsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.apk'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">downloadAndInstallApk</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                  url<span class=\"token operator\">:</span> info<span class=\"token punctuation\">.</span>downloadUrl<span class=\"token punctuation\">,</span>\n                  <span class=\"token function-variable function\">onDownloadProgress</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> received<span class=\"token punctuation\">,</span> total <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                      received<span class=\"token punctuation\">,</span>\n                      total<span class=\"token punctuation\">,</span>\n                    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n              <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                Linking<span class=\"token punctuation\">.</span><span class=\"token function\">openURL</span><span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">.</span>downloadUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n              <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">.</span>upToDate<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      Alert<span class=\"token punctuation\">.</span><span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'提示'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'您的应用版本已是最新.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      Alert<span class=\"token punctuation\">.</span><span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'提示'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'检查到新的版本'</span> <span class=\"token operator\">+</span> info<span class=\"token punctuation\">.</span>name <span class=\"token operator\">+</span> <span class=\"token string\">',是否下载?\\n'</span> <span class=\"token operator\">+</span> info<span class=\"token punctuation\">.</span>description<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n          text<span class=\"token operator\">:</span> <span class=\"token string\">'是'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token function-variable function\">onPress</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">doUpdate</span><span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span> text<span class=\"token operator\">:</span> <span class=\"token string\">'否'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> received<span class=\"token punctuation\">,</span> total <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token operator\">&lt;</span>View style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>styles<span class=\"token punctuation\">.</span>container<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>Text style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>styles<span class=\"token punctuation\">.</span>welcome<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>欢迎使用热更新服务<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Text<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>Text style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>styles<span class=\"token punctuation\">.</span>instructions<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n          这是版本一 <span class=\"token punctuation\">{</span><span class=\"token string\">'\\n'</span><span class=\"token punctuation\">}</span>\n          当前原生包版本号<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>packageVersion<span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">{</span><span class=\"token string\">'\\n'</span><span class=\"token punctuation\">}</span>\n          当前热更新版本Hash<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>currentVersion <span class=\"token operator\">||</span> <span class=\"token string\">'(空)'</span><span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">{</span><span class=\"token string\">'\\n'</span><span class=\"token punctuation\">}</span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Text<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>Text<span class=\"token operator\">></span>\n          下载进度：<span class=\"token punctuation\">{</span>received<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">{</span>total<span class=\"token punctuation\">}</span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Text<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>TouchableOpacity onPress<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>checkUpdate<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span>Text style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>styles<span class=\"token punctuation\">.</span>instructions<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>点击这里检查更新<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Text<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>TouchableOpacity<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>View<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> styles <span class=\"token operator\">=</span> StyleSheet<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  container<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    flex<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n    justifyContent<span class=\"token operator\">:</span> <span class=\"token string\">'center'</span><span class=\"token punctuation\">,</span>\n    alignItems<span class=\"token operator\">:</span> <span class=\"token string\">'center'</span><span class=\"token punctuation\">,</span>\n    backgroundColor<span class=\"token operator\">:</span> <span class=\"token string\">'#F5FCFF'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  welcome<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    fontSize<span class=\"token operator\">:</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span>\n    textAlign<span class=\"token operator\">:</span> <span class=\"token string\">'center'</span><span class=\"token punctuation\">,</span>\n    margin<span class=\"token operator\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  instructions<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    textAlign<span class=\"token operator\">:</span> <span class=\"token string\">'center'</span><span class=\"token punctuation\">,</span>\n    color<span class=\"token operator\">:</span> <span class=\"token string\">'#333333'</span><span class=\"token punctuation\">,</span>\n    marginBottom<span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>现在，你的应用已经可以通过 pushy 服务检查版本并进行更新了。下一步，你可以开始尝试发布应用包和版本，请参阅<a href=\"publish\">发布热更新</a>。</p>","tableOfContents":"<ul>\n<li><a href=\"/docs/integration/#%E6%9E%81%E7%AE%80%E5%BF%AB%E9%80%9F%E9%9B%86%E6%88%90\">极简快速集成</a></li>\n<li>\n<p><a href=\"/docs/integration/#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%9B%86%E6%88%90\">自定义集成</a></p>\n<ul>\n<li><a href=\"/docs/integration/#%E8%8E%B7%E5%8F%96-appkey\">获取 appKey</a></li>\n<li><a href=\"/docs/integration/#%E6%A3%80%E6%9F%A5%E6%9B%B4%E6%96%B0%E3%80%81%E4%B8%8B%E8%BD%BD%E6%9B%B4%E6%96%B0\">检查更新、下载更新</a></li>\n<li><a href=\"/docs/integration/#%E5%88%87%E6%8D%A2%E7%89%88%E6%9C%AC\">切换版本</a></li>\n<li><a href=\"/docs/integration/#%E9%A6%96%E6%AC%A1%E5%90%AF%E5%8A%A8%E3%80%81%E5%9B%9E%E6%BB%9A\">首次启动、回滚</a></li>\n<li><a href=\"/docs/integration/#%E5%AE%8C%E6%95%B4%E7%9A%84%E7%A4%BA%E4%BE%8B\">完整的示例</a></li>\n</ul>\n</li>\n</ul>","frontmatter":{"title":"代码集成","order":1,"type":"快速入门"},"fields":{"path":"/docs/integration.md","slug":"/docs/integration","modifiedTime":1651656022664}},"allMarkdownRemark":{"edges":[{"node":{"frontmatter":{"title":"常见问题","order":23,"type":"其他"},"fields":{"slug":"/docs/faq","path":"/docs/faq.md"}}},{"node":{"frontmatter":{"title":"更新日志","order":22,"type":"其他"},"fields":{"slug":"/docs/changelog","path":"/docs/changelog.md"}}},{"node":{"frontmatter":{"title":"场景实践","order":13,"type":"开发指南"},"fields":{"slug":"/docs/bestpractice","path":"/docs/bestpractice.md"}}},{"node":{"frontmatter":{"title":"命令行工具","order":12,"type":"开发指南"},"fields":{"slug":"/docs/cli","path":"/docs/cli.md"}}},{"node":{"frontmatter":{"title":"API参考","order":11,"type":"开发指南"},"fields":{"slug":"/docs/api","path":"/docs/api.md"}}},{"node":{"frontmatter":{"title":"发布热更新","order":2,"type":"快速入门"},"fields":{"slug":"/docs/publish","path":"/docs/publish.md"}}},{"node":{"frontmatter":{"title":"代码集成","order":1,"type":"快速入门"},"fields":{"slug":"/docs/integration","path":"/docs/integration.md"}}},{"node":{"frontmatter":{"title":"安装配置","order":0,"type":"快速入门"},"fields":{"slug":"/docs/getting-started","path":"/docs/getting-started.md"}}}]}},"pageContext":{"slug":"/docs/integration","type":"/docs/"}},"staticQueryHashes":[]}