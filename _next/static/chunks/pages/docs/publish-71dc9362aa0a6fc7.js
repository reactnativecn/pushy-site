(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3850],{52698:function(s,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/publish",function(){return n(27124)}])},27124:function(s,e,n){"use strict";n.r(e),n.d(e,{__toc:function(){return o}});var i=n(52676),l=n(58332),r=n(37451),a=n(5287),c=n(6911);let o=[{depth:2,value:"发布原生基准版本",id:"发布原生基准版本"},{depth:3,value:"iOS",id:"ios"},{depth:3,value:"Android",id:"android"},{depth:3,value:"Harmony",id:"harmony"},{depth:2,value:"发布热更新版本",id:"发布热更新版本"},{depth:2,value:"灰度发布",id:"灰度发布"},{depth:3,value:"什么是灰度发布",id:"什么是灰度发布"},{depth:3,value:"灰度发布的作用",id:"灰度发布的作用"},{depth:3,value:"工作原理",id:"工作原理"},{depth:3,value:"使用方法",id:"使用方法"},{depth:4,value:"通过网页端操作",id:"通过网页端操作"},{depth:4,value:"通过命令行操作",id:"通过命令行操作"},{depth:3,value:"注意事项",id:"注意事项"}];function d(s){let e=Object.assign({p:"p",ol:"ol",li:"li",code:"code",a:"a",h2:"h2",h3:"h3",pre:"pre",span:"span",strong:"strong",ul:"ul",h4:"h4"},(0,r.a)(),s.components);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.p,{children:"现在你的应用已经具备了检测更新的功能，下面我们来尝试发布并更新它。流程可参考下图："}),"\n",(0,i.jsx)(a.G,{chart:'flowchart TD\n    codebase["\uD83D\uDDA5️&nbsp;&nbsp;项目代码库"]\n    subgraph 发布原生基准版本\n    tagNativeVersion["\uD83C\uDFF7️&nbsp;&nbsp;(在 git 上)标记原生版本号"]\n    newNativeVersion["\uD83D\uDDC2️&nbsp;&nbsp;新的原生基准版本"]\n    nativePackage["\uD83D\uDCE6&nbsp;&nbsp;原生完整包(apk或ipa文件)"]\n    tagNativeVersion--"\uD83D\uDD28&nbsp;&nbsp;编译"-->nativePackage\n    nativePackage--"⬆️&nbsp;&nbsp;使用<br/>pushy uploadApk/uploadIpa<br/>命令上传"-->newNativeVersion\n    end\n    subgraph 发布热更新版本\n    tagBundleVersion["\uD83C\uDFF7️&nbsp;&nbsp;(在 git 上)标记热更新版本号"]\n    bundlePackage["\uD83C\uDF81&nbsp;&nbsp;js代码与资源包(ppk文件)"]\n    tagBundleVersion--"\uD83D\uDD28&nbsp;&nbsp;使用<br/>pushy bundle<br/>命令生成并上传"-->bundlePackage\n    someNativeVersions["\uD83D\uDDC2️&nbsp;&nbsp;一个或多个原生基准版本"]\n    bundlePackage--"\uD83D\uDD87️&nbsp;&nbsp;绑定"-->someNativeVersions\n    end\n    user["\uD83D\uDC68‍\uD83D\uDC69‍\uD83D\uDC67‍\uD83D\uDC66&nbsp;&nbsp;安装有对应原生基准版本的用户"]\n    codebase--"✏️&nbsp;&nbsp;改动js代码，<br/>或添加、更新js组件，<br/>或添加、更新js代码中引用的图片等资源"-->发布热更新版本\n    codebase--"\uD83D\uDD8A️&nbsp;&nbsp;改动原生代码、设置，<br/>或添加、更新原生组件，<br/>或添加、更新原生代码中引用的图片等资源"-->发布原生基准版本\n    发布热更新版本--"\uD83D\uDCF2&nbsp;&nbsp;推送增量热更新(diff文件)"-->user'}),"\n",(0,i.jsx)(e.p,{children:"流程总结如下："}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["我们需要先打包一个原生 release 版本，在打包前请确保已集成了",(0,i.jsx)(e.code,{children:"react-native-update"}),"并在调试过程中运行正常，安卓端",(0,i.jsxs)(e.a,{href:"/docs/getting-started#%E7%A6%81%E7%94%A8-android-%E7%9A%84-crunch-%E4%BC%98%E5%8C%96",children:["关闭了",(0,i.jsx)(e.code,{children:"crunchPngs"}),"设置"]}),"，打包说明可参考",(0,i.jsx)(e.a,{href:"https://reactnative.cn/docs/publishing-to-app-store",children:"iOS 打包"}),"和",(0,i.jsx)(e.a,{href:"https://reactnative.cn/docs/signed-apk-android",children:"android 打包"}),"。打包完成后请使用",(0,i.jsx)(e.code,{children:"pushy uploadIpa"}),"或者",(0,i.jsx)(e.code,{children:"pushy uploadApk"}),"命令来把这个安装包上传到 pushy 服务器端，以作为之后热更差量对比的基准。同时请保留好这个安装包，上架和分发给用户所使用的安装包",(0,i.jsx)(e.code,{children:"需要和服务器端完全一致"}),"。建议使用 git tag 功能来标记原生版本号（例如",(0,i.jsx)(e.code,{children:"v1.0.0"}),"）。"]}),"\n",(0,i.jsxs)(e.li,{children:["然后在基准版本之上迭代业务逻辑（增删 js 代码，增删图片等静态资源），使用",(0,i.jsx)(e.code,{children:"pushy bundle"}),"命令来生成和发布热更新版本，而不需要重新打包。建议使用 git tag 功能来标记热更版本号（例如",(0,i.jsx)(e.code,{children:"v1.0.1"}),"）。"]}),"\n",(0,i.jsx)(e.li,{children:"如果迭代过程中有原生方面的修改，则需要发布并上传新的原生基准版本（重复步骤 1，但需要设置不同的原生版本号）。可以只保留一个原生基准版本，也可以多版本同时维护。"}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"发布原生基准版本",children:"发布原生基准版本"}),"\n",(0,i.jsx)(e.h3,{id:"ios",children:"iOS"}),"\n",(0,i.jsxs)(e.p,{children:["首先参考",(0,i.jsx)(e.a,{href:"https://reactnative.cn/docs/running-on-device",children:"文档-在设备上运行"}),"，确定你正在使用离线包。然后点击菜单。"]}),"\n",(0,i.jsxs)(e.p,{children:["按照正常的发布流程打包",(0,i.jsx)(e.code,{children:".ipa"}),"文件："]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"Xcode 中运行设备选真机或 Generic iOS Device"}),"\n",(0,i.jsx)(e.li,{children:"菜单中选择 Product - Archive"}),"\n",(0,i.jsxs)(e.li,{children:["Archive 完成后选择",(0,i.jsx)(e.code,{children:"Export"}),"生成.ipa 文件"]}),"\n",(0,i.jsx)(e.li,{children:"然后运行如下命令上传到 pushy 服务器以供后续版本比对之用"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{"data-language":"bash","data-theme":"default",children:(0,i.jsx)(e.code,{"data-language":"bash","data-theme":"default",children:(0,i.jsxs)(e.span,{className:"line",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"$"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"pushy"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"uploadIpa"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"<"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"ipa后缀文"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"件"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:">"})]})})}),"\n",(0,i.jsxs)(e.p,{children:["此 ipa 的",(0,i.jsx)(e.code,{children:"CFBundleShortVersionString"}),"字段(位于",(0,i.jsx)(e.code,{children:"ios/项目名/Info.plist"}),"中)会被记录为原生版本号",(0,i.jsx)(e.code,{children:"packageVersion"}),"。"]}),"\n",(0,i.jsxs)(e.p,{children:["随后你可以选择往 AppStore 上传这个版本（可以重新 export 并调整相关选项，但请不要重新 archive），也可以先通过",(0,i.jsx)(e.a,{href:"https://developer.apple.com/cn/testflight/",children:"Test flight"}),"或",(0,i.jsx)(e.a,{href:"https://www.pgyer.com/doc/view/build_ipa",children:"蒲公英"}),"等渠道进行真机安装测试。请注意：暂不支持通过 Xcode 直接进行热更新测试。"]}),"\n",(0,i.jsxs)(e.p,{children:["如果后续需要再次 archive 打包（例如修改原生代码或配置。如果只是修改 js 代码则不需要重新打包。），请先",(0,i.jsx)(e.strong,{children:"更改版本号"}),"，并在打包完成后再次",(0,i.jsx)(e.code,{children:"uploadIpa"}),"到服务器端记录，否则后续生成的相同版本的原生包会由于",(0,i.jsxs)(e.a,{href:"faq#%E7%83%AD%E6%9B%B4%E6%96%B0%E6%8A%A5%E9%94%99%EF%BC%9A%E7%83%AD%E6%9B%B4%E6%96%B0%E5%B7%B2%E6%9A%82%E5%81%9C%EF%BC%8C%E5%8E%9F%E5%9B%A0%EF%BC%9Abuildtime-mismatch%E3%80%82",children:["编译时间戳不一致而",(0,i.jsx)(e.code,{children:"无法获取热更新"})]}),"。"]}),"\n",(0,i.jsx)(e.h3,{id:"android",children:"Android"}),"\n",(0,i.jsxs)(e.p,{children:["首先参考",(0,i.jsx)(e.a,{href:"https://reactnative.cn/docs/signed-apk-android",children:"文档-打包 APK"}),"设置签名，然后在 android 文件夹下运行",(0,i.jsx)(e.code,{children:"./gradlew assembleRelease"}),"或",(0,i.jsx)(e.code,{children:"./gradlew aR"}),"，你就可以在",(0,i.jsx)(e.code,{children:"android/app/build/outputs/apk/release/app-release.apk"}),"中找到你的应用包。"]}),"\n",(0,i.jsx)(e.p,{children:"然后运行如下命令"}),"\n",(0,i.jsx)(e.pre,{"data-language":"bash","data-theme":"default",children:(0,i.jsxs)(e.code,{"data-language":"bash","data-theme":"default",children:[(0,i.jsxs)(e.span,{className:"line",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"$"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"pushy"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"uploadApk"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"android/app/build/outputs/apk/release/app-release.apk"})]}),"\n",(0,i.jsx)(e.span,{className:"line",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# 如果你打的是 aab 格式的包，则请使用以下命令"})}),"\n",(0,i.jsx)(e.span,{className:"line",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# pushy uploadAab android/app/build/outputs/bundle/release/app-release.aab"})})]})}),"\n",(0,i.jsxs)(e.p,{children:["即可上传 apk 以供后续版本比对之用。此 apk 的",(0,i.jsx)(e.code,{children:"versionName"}),"字段(位于",(0,i.jsx)(e.code,{children:"android/app/build.gradle"}),"中)会被记录为原生版本号",(0,i.jsx)(e.code,{children:"packageVersion"}),"。"]}),"\n",(0,i.jsx)(e.p,{children:"随后你可以选择往应用市场发布这个版本，也可以先往设备上直接安装这个 apk 文件以进行测试。"}),"\n",(0,i.jsxs)(e.p,{children:["如果后续需要再次打包（例如修改原生代码或配置。如果只是修改 js 代码则不需要重新打包。），请先",(0,i.jsx)(e.strong,{children:"更改版本号"}),"，并再次",(0,i.jsx)(e.code,{children:"uploadApk"}),"到服务器端记录，否则后续生成的相同版本的原生包会由于",(0,i.jsxs)(e.a,{href:"faq#%E7%83%AD%E6%9B%B4%E6%96%B0%E6%8A%A5%E9%94%99%EF%BC%9A%E7%83%AD%E6%9B%B4%E6%96%B0%E5%B7%B2%E6%9A%82%E5%81%9C%EF%BC%8C%E5%8E%9F%E5%9B%A0%EF%BC%9Abuildtime-mismatch%E3%80%82",children:["编译时间戳不一致而",(0,i.jsx)(e.code,{children:"无法获取热更新"})]}),"。"]}),"\n",(0,i.jsx)(e.h3,{id:"harmony",children:"Harmony"}),"\n",(0,i.jsxs)(e.p,{children:["首先下载鸿蒙开发IDE DevEco-Studio，然后通过Build => Build Hap(s)/App(s) => Build App(s)，你就可以在",(0,i.jsx)(e.code,{children:"harmony/build/outputs/default/harmony-default-unsigned.app"}),"中找到你的应用包。"]}),"\n",(0,i.jsx)(e.p,{children:"然后运行如下命令"}),"\n",(0,i.jsx)(e.pre,{"data-language":"bash","data-theme":"default",children:(0,i.jsx)(e.code,{"data-language":"bash","data-theme":"default",children:(0,i.jsxs)(e.span,{className:"line",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"$"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"pushy"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"uploadApp"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"harmony/build/outputs/default/harmony-default-unsigned.app"})]})})}),"\n",(0,i.jsxs)(e.p,{children:["即可上传 app 以供后续版本比对之用。此 app 的",(0,i.jsx)(e.code,{children:"versionName"}),"字段(位于",(0,i.jsx)(e.code,{children:"harmony/AppScope/app.json5"}),"中)会被记录为原生版本号",(0,i.jsx)(e.code,{children:"packageVersion"}),"。"]}),"\n",(0,i.jsxs)(e.p,{children:["随后你可以选择往华为应用市场发布这个版本，也可以先往设备上通过命令",(0,i.jsx)(e.code,{children:"hdc shell"}),"命令安装这个 app 文件以进行测试。"]}),"\n",(0,i.jsxs)(e.p,{children:["如果后续需要再次打包（例如修改原生代码或配置。如果只是修改 js 代码则不需要重新打包。），请先",(0,i.jsx)(e.strong,{children:"更改版本号"}),"，并再次",(0,i.jsx)(e.code,{children:"uploadApp"}),"到服务器端记录，否则后续生成的相同版本的原生包会由于",(0,i.jsxs)(e.a,{href:"faq#%E7%83%AD%E6%9B%B4%E6%96%B0%E6%8A%A5%E9%94%99%EF%BC%9A%E7%83%AD%E6%9B%B4%E6%96%B0%E5%B7%B2%E6%9A%82%E5%81%9C%EF%BC%8C%E5%8E%9F%E5%9B%A0%EF%BC%9Abuildtime-mismatch%E3%80%82",children:["编译时间戳不一致而",(0,i.jsx)(e.code,{children:"无法获取热更新"})]}),"。"]}),"\n",(0,i.jsx)(e.h2,{id:"发布热更新版本",children:"发布热更新版本"}),"\n",(0,i.jsxs)(e.p,{children:["你可以尝试修改一行代码(譬如将版本一修改为版本二)，然后使用",(0,i.jsx)(e.code,{children:"pushy bundle --platform <ios|android|harmony>"}),"命令来生成新的热更新版本。"]}),"\n",(0,i.jsxs)(c.UW,{type:"info",children:[(0,i.jsxs)(e.p,{children:["如果你使用了较新版本的",(0,i.jsx)(e.code,{children:"expo"}),"或其他没有",(0,i.jsx)(e.code,{children:"index.js"}),"的框架，执行",(0,i.jsx)(e.code,{children:"bundle"}),"命令时会报错。此时请手动创建一个",(0,i.jsx)(e.code,{children:"index.js"}),"文件，在其中引用框架自身的入口文件即可。具体入口文件的路径如何，请参考框架的说明文档或者",(0,i.jsx)(e.code,{children:"package.json"}),"中的",(0,i.jsx)(e.code,{children:"main"}),"字段。例如针对",(0,i.jsx)(e.code,{children:"expo"}),"的",(0,i.jsx)(e.code,{children:"index.js"}),"可能是如下这样写："]}),(0,i.jsx)(e.pre,{"data-language":"js","data-theme":"default",children:(0,i.jsx)(e.code,{"data-language":"js","data-theme":"default",children:(0,i.jsxs)(e.span,{className:"line",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"expo-router/entry"'}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]})})})]}),"\n",(0,i.jsx)(e.pre,{"data-language":"bash","data-theme":"default",children:(0,i.jsxs)(e.code,{"data-language":"bash","data-theme":"default",children:[(0,i.jsxs)(e.span,{className:"line",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"$"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"pushy"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"bundle"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--platform"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"android"})]}),"\n",(0,i.jsxs)(e.span,{className:"line",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Bundling"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"with"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"React"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"Native"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"version:"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"0.22"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:".2"})]}),"\n",(0,i.jsxs)(e.span,{className:"line",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"<"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"各种进度输出"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:">"})]}),"\n",(0,i.jsxs)(e.span,{className:"line",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Bundled"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"saved"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"to:"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"build/output/android.1459850548545.ppk"})]}),"\n",(0,i.jsxs)(e.span,{className:"line",children:[(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Would"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"you"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"like"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"to"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"publish"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"it?"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Y/N"}),(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"})]})]})}),"\n",(0,i.jsxs)(e.p,{children:["如果想要立即上传，此时输入 Y。当然，你也可以在将来使用",(0,i.jsx)(e.code,{children:"pushy publish --platform android build/output/android.1459850548545.ppk"}),"来上传刚才打包好的热更新包。"]}),"\n",(0,i.jsx)(e.pre,{"data-language":"text","data-theme":"default",children:(0,i.jsxs)(e.code,{"data-language":"text","data-theme":"default",children:[(0,i.jsx)(e.span,{className:"line",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  Uploading [========================================================] 100% 0.0s"})}),"\n",(0,i.jsx)(e.span,{className:"line",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"Enter version name: <输入热更新版本名字，如1.0.0-rc>"})}),"\n",(0,i.jsx)(e.span,{className:"line",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"Enter description: <输入热更新版本描述>"})}),"\n",(0,i.jsx)(e.span,{className:"line",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:'Enter meta info: {"ok":1}'})}),"\n",(0,i.jsx)(e.span,{className:"line",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"Ok."})}),"\n",(0,i.jsx)(e.span,{className:"line",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"Would you like to bind packages to this version?(Y/N)"})})]})}),"\n",(0,i.jsx)(e.p,{children:"此时版本已经提交到 pushy 服务，但用户暂时看不到此更新，你需要先将特定的原生包版本绑定到此热更新版本上。"}),"\n",(0,i.jsxs)(e.p,{children:["此时输入 Y 立即绑定，你也可以在将来使用",(0,i.jsx)(e.code,{children:"pushy update --platform <ios|android|harmony>"}),"来对已上传的热更包和原生包进行绑定。除此以外，你还可以在网页端操作，简单的将对应的原生包版本拖到需要的热更新版本下即可。"]}),"\n",(0,i.jsx)(e.pre,{"data-language":"text","data-theme":"default",children:(0,i.jsxs)(e.code,{"data-language":"text","data-theme":"default",children:[(0,i.jsx)(e.span,{className:"line",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"┌────────────┬──────────────────────────────────────┐"})}),"\n",(0,i.jsx)(e.span,{className:"line",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"│ Package Id │               Version                │"})}),"\n",(0,i.jsx)(e.span,{className:"line",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"├────────────┼──────────────────────────────────────┤"})}),"\n",(0,i.jsx)(e.span,{className:"line",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"│   46272    │ 2.0(normal)                          │"})}),"\n",(0,i.jsx)(e.span,{className:"line",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"├────────────┼──────────────────────────────────────┤"})}),"\n",(0,i.jsx)(e.span,{className:"line",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"│   45577    │ 1.0(normal)                          │"})}),"\n",(0,i.jsx)(e.span,{className:"line",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"└────────────┴──────────────────────────────────────┘"})}),"\n",(0,i.jsx)(e.span,{className:"line",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"共 2 个包"})}),"\n",(0,i.jsx)(e.span,{className:"line",children:(0,i.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"输入原生包 id: 46272"})})]})}),"\n",(0,i.jsx)(e.p,{children:"版本绑定完毕后，服务器会在几秒内生成差量补丁，客户端就可以获取到更新了。"}),"\n",(0,i.jsxs)(e.p,{children:["后续要继续发布新的热更新，只需反复执行",(0,i.jsx)(e.code,{children:"pushy bundle"}),"命令即可，不需要重新打包。"]}),"\n",(0,i.jsx)(e.p,{children:"恭喜你，至此为止，你已经完成了植入代码热更新的全部工作。"}),"\n",(0,i.jsx)(e.h2,{id:"灰度发布",children:"灰度发布"}),"\n",(0,i.jsx)(e.p,{children:"灰度发布（又称金丝雀发布、渐进式发布）是一种降低热更新发布风险的策略，通过逐步扩大更新范围来验证新版本的稳定性。"}),"\n",(0,i.jsx)(e.h3,{id:"什么是灰度发布",children:"什么是灰度发布"}),"\n",(0,i.jsx)(e.p,{children:"灰度发布是指在正式全量发布热更新之前，先将更新推送给一小部分用户（如 5%、10%），观察这部分用户的使用情况后，再逐步扩大更新比例，直到最终推送给所有用户。"}),"\n",(0,i.jsx)(e.h3,{id:"灰度发布的作用",children:"灰度发布的作用"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"降低风险"}),"：如果新版本存在 bug，只会影响小部分用户，可以及时发现并回滚"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"验证稳定性"}),"：通过小范围用户的真实使用反馈，验证新版本在各种设备和网络环境下的表现"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"平滑过渡"}),"：避免突然的全量更新对服务器造成的压力峰值"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"快速止损"}),"：一旦发现问题，可以立即停止灰度，将影响范围控制在最小"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"工作原理",children:"工作原理"}),"\n",(0,i.jsx)(e.p,{children:"当你设置了灰度比例（如 10%）后，检查更新时会根据每个用户的设备 UUID 进行哈希计算，确定该用户是否在灰度范围内："}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"灰度范围内的用户会收到新版本的更新推送"}),"\n",(0,i.jsx)(e.li,{children:"灰度范围外的用户会收到上一个全量版本（如果有），或显示为已是最新"}),"\n",(0,i.jsx)(e.li,{children:"同一用户的灰度状态是稳定的，不会因为多次检查更新而变化"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"使用方法",children:"使用方法"}),"\n",(0,i.jsx)(e.h4,{id:"通过网页端操作",children:"通过网页端操作"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["登录 ",(0,i.jsx)(e.a,{href:"https://update.reactnative.cn",children:"Pushy 管理后台"})]}),"\n",(0,i.jsx)(e.li,{children:"选择对应的应用和原生包版本"}),"\n",(0,i.jsx)(e.li,{children:'点击"发布"按钮'}),"\n",(0,i.jsx)(e.li,{children:"选择灰度发布比例"}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"通过命令行操作",children:"通过命令行操作"}),"\n",(0,i.jsxs)(e.p,{children:["请查看",(0,i.jsx)(e.a,{href:"cli#pushy-update",children:"命令行工具文档中的 rollout 参数"})]}),"\n",(0,i.jsx)(e.h3,{id:"注意事项",children:"注意事项"}),"\n",(0,i.jsx)(c.UW,{type:"warning",children:(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"重要提示"}),"：灰度版本与全量版本是独立的绑定关系。"]})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"同时只能有一个灰度版本"}),"：每个原生包版本只能绑定一个灰度热更版本（比例小于100%）和一个全量热更版本"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"优先级"}),"：如果同时存在灰度版本和全量版本，灰度范围内命中的用户会收到灰度版本，没有命中的用户会收到全量版本"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"提升为全量"}),"：将灰度比例设置为 100% 后，该版本会自动提升为全量版本，替换原有的全量版本"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"客户端版本要求"}),"：",(0,i.jsx)(e.code,{children:"react-native-update"})," >= 10.32.0 才能支持同时发布灰度和全量版本。"]}),"\n"]})]})}e.default=(0,l.j)({MDXContent:function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,r.a)(),s.components);return e?(0,i.jsx)(e,{...s,children:(0,i.jsx)(d,{...s})}):d(s)},pageOpts:{filePath:"pages/docs/publish.mdx",route:"/docs/publish",frontMatter:{order:2,title:"发布热更新",type:"快速入门"},title:"发布热更新",headings:o},pageNextRoute:"/docs/publish"})}},function(s){s.O(0,[386,8332,483,2888,9774,179],function(){return s(s.s=52698)}),_N_E=s.O()}]);