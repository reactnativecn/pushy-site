(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9904],{11361:function(s,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/bestpractice",function(){return n(65860)}])},45065:function(s,e){"use strict";e.Z={src:"/_next/static/media/testqrcode.24c22c1e.png",height:626,width:750,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAHCAMAAAACh/xsAAAAVFBMVEX////+/v7+/f38/Pz8+/v7+/v6+vr5+fr5+fn5+Pn4+Pj39/r29/f29vb19vb19fX09PTz8/Py8/Pz8vLy8vL07/Dw8PD64+Td3d3a2tq7vb20s7NBCb0kAAAAO0lEQVR42gVACRJAMAxc4qhKNEvE9f9/GmQ0VzXD2okPV5lQR9Hl3GaQB+63CoLZP58ZyPBohYidmWT8W3QDL57S3woAAAAASUVORK5CYII=",blurWidth:8,blurHeight:7}},65860:function(s,e,n){"use strict";n.r(e),n.d(e,{__toc:function(){return o},default:function(){return h}});var l=n(52676),r=n(58332),i=n(37451),a={src:"/_next/static/media/exportipa.91920cd4.png",height:518,width:952,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAECAYAAACzzX7wAAAAZElEQVR4nDWM0QmAMAxELw20CDqAKLj/RA6gOIJNC2mMFe/rePc40manSF0IajFGyveNWgrGaUJgBpnZISJrCKEx8yeIIKWEOAxduHLOMzwv9A5VBRHBH7uwO9jMrPqLc+rjnwerazS2i5etmgAAAABJRU5ErkJggg==",blurWidth:8,blurHeight:4},c=n(45065);let o=[{depth:4,value:"优化原生和热更包体积",id:"优化原生和热更包体积"},{depth:5,value:"iOS 原生包优化(ipa)",id:"ios-原生包优化ipa"},{depth:5,value:"Android 原生包优化(apk)",id:"android-原生包优化apk"},{depth:5,value:"热更新包优化(ppk)",id:"热更新包优化ppk"},{depth:4,value:"有很多渠道包需要热更，如何操作比较方便？",id:"有很多渠道包需要热更如何操作比较方便"},{depth:4,value:"如何支持 aab 格式的原生包？",id:"如何支持-aab-格式的原生包"},{depth:4,value:"测试与回滚",id:"测试与回滚"},{depth:4,value:"元信息(Meta Info)的使用",id:"元信息meta-info的使用"}];function t(s){let e=Object.assign({h4:"h4",h5:"h5",p:"p",img:"img",ul:"ul",li:"li",a:"a",code:"code",pre:"pre",span:"span",ol:"ol",details:"details",summary:"summary",strong:"strong",blockquote:"blockquote"},(0,i.a)(),s.components);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.h4,{id:"优化原生和热更包体积",children:"优化原生和热更包体积"}),"\n",(0,l.jsx)(e.h5,{id:"ios-原生包优化ipa",children:"iOS 原生包优化(ipa)"}),"\n",(0,l.jsx)(e.p,{children:"对于同一份 archive（其版本号、编译时间和内置 bundle 已固定，不会受导出方式所影响），可以用不同选项多次导出 ipa，选择其中最小的上传到 pushy 服务器作为热更基准包。"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.img,{alt:"bitcode",placeholder:"blur",src:a})}),"\n",(0,l.jsx)(e.h5,{id:"android-原生包优化apk",children:"Android 原生包优化(apk)"}),"\n",(0,l.jsx)(e.p,{children:"apk 的优化主要考虑两个方向："}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"https://reactnative.cn/docs/signed-apk-android#%E5%90%AF%E7%94%A8proguard%E6%9D%A5%E5%87%8F%E5%B0%91apk%E7%9A%84%E5%A4%A7%E5%B0%8F%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89",children:"启用 proguard 压缩混淆源码"}),"。但这一步可能导致一些使用反射的代码运行时报错，启用后需要充分测试每个页面和功能，以及需要阅读一些第三方关于 proguard 的特别设置说明。"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"https://reactnative.cn/docs/signed-apk-android#%E9%92%88%E5%AF%B9%E4%B8%8D%E5%90%8C%E7%9A%84-cpu-%E6%9E%B6%E6%9E%84%E7%94%9F%E6%88%90-apk-%E4%BB%A5%E5%87%8F%E5%B0%8F-apk-%E6%96%87%E4%BB%B6%E7%9A%84%E5%A4%A7%E5%B0%8F",children:"分开编译不同的 cpu 架构"}),"。找到",(0,l.jsx)(e.code,{children:"android/app/build.gradle"}),"中的 cpu 架构部分，如下所示启用",(0,l.jsx)(e.code,{children:"enable"}),"选项："]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{"data-language":"diff","data-theme":"default",children:(0,l.jsxs)(e.code,{"data-language":"diff","data-theme":"default",children:[(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"splits {"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    abi {"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        reset()"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"#EF6270"},children:"-       enable enableSeparateBuildPerCPUArchitecture"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"#4BB74A"},children:"+       enable true        // 启用单独的 cpu 架构编译"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        universalApk false  // If true, also generate a universal APK"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,l.jsxs)(e.p,{children:["如此一来会在编译目录中输出多个 apk 文件，分发和上传到热更新服务时只需要使用",(0,l.jsx)(e.code,{children:"app-arm64-v8a-release.apk"}),"文件，可以大幅减小 apk 的大小。"]}),"\n",(0,l.jsx)(e.h5,{id:"热更新包优化ppk",children:"热更新包优化(ppk)"}),"\n",(0,l.jsx)(e.p,{children:"热更新包的主要内容是 js 包和其所引用的静态资源（主要是图片）。"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["js 包成分分析。可以借助一些第三方工具（如",(0,l.jsx)(e.a,{href:"https://github.com/IjzerenHein/react-native-bundle-visualizer",children:"react-native-bundle-visualizer"}),"）来分析 js 文件中哪些占比较大，是否可以用其他库替换等（如 dayjs 替换 moment，lodash-es 替换 lodash）。"]}),"\n",(0,l.jsxs)(e.li,{children:["图片优化。\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"在保证体验的情况下，使用一些工具对图片进行裁剪压缩。"}),"\n",(0,l.jsx)(e.li,{children:"如不需要图片的透明像素，可以考虑将 png 格式转为 jpg 格式。"}),"\n",(0,l.jsxs)(e.li,{children:["还可以进一步考虑压缩比更高的图片格式，例如 webp 格式（需要第三方原生插件例如",(0,l.jsx)(e.a,{href:"https://github.com/Aleksefo/react-native-webp-format#readme",children:"react-native-webp-format"}),"），heif 格式（iOS 11 和 Android 10 以上原生支持）等。这里有个图片格式对比可供参考 ",(0,l.jsx)(e.a,{href:"https://compare.rokka.io/_compare/#heif=40&jpeg=80&webp=80&av1=40&width=800",children:"https://compare.rokka.io/_compare/#heif=40&jpeg=80&webp=80&av1=40&width=800"}),"。"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.h4,{id:"有很多渠道包需要热更如何操作比较方便",children:"有很多渠道包需要热更，如何操作比较方便？"}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsxs)(e.li,{children:["如果渠道包的",(0,l.jsx)(e.code,{children:"js代码和初始资源"}),"有差别（无论多么细微的差别都会生成不同的 jsbundle），那么只能单独生成 apk，分别上传和绑定。可以考虑写一些脚本自动调用 cli 来执行批量操作。"]}),"\n",(0,l.jsxs)(e.li,{children:["如果渠道包的",(0,l.jsx)(e.code,{children:"js代码和初始资源"}),"完全一致，可以考虑使用",(0,l.jsx)(e.a,{href:"https://developer.android.com/studio/build/build-variants?hl=zh-cn",children:"Flavor 构建"}),"，或其他一些动态生成渠道包的方案（比如",(0,l.jsx)(e.a,{href:"https://github.com/Tencent/VasDolly",children:"腾讯的 VasDolly"}),"，",(0,l.jsx)(e.a,{href:"https://github.com/Meituan-Dianping/walle",children:"美团的 walle"}),"等），这样所有的渠道包基于同一个基础 apk 生成（因而会有相同的编译时间戳和 jsbundle）。这样可以只用上传一个基础 apk，对此 apk 的热更操作可以对所有渠道包生效。"]}),"\n",(0,l.jsxs)(e.li,{children:["如果您是",(0,l.jsx)(e.code,{children:"高级版"}),"、",(0,l.jsx)(e.code,{children:"专业版"}),"或",(0,l.jsx)(e.code,{children:"大客户VIP版"}),"客户，也可以考虑在管理后台的应用设置中启用",(0,l.jsx)(e.code,{children:"忽略编译时间戳"}),"。此选项仅对比版本号，不校验时间戳，可提供更宽容的热更策略，但可能消耗更多流量。"]}),"\n"]}),"\n",(0,l.jsx)(e.h4,{id:"如何支持-aab-格式的原生包",children:"如何支持 aab 格式的原生包？"}),"\n",(0,l.jsx)(e.p,{children:"将 react-native-update-cli 更新到 v2.6.0 以上版本，即可使用 pushy parseAab 和 pushy uploadAab 命令来支持 aab 格式的原生包。"}),"\n",(0,l.jsx)(e.h4,{id:"测试与回滚",children:"测试与回滚"}),"\n",(0,l.jsx)(e.p,{children:"自 v10.11.2 版本开始，可以使用以下两种快捷扫码方案来测试热更，而无需提前进行绑定："}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.img,{alt:"testqrcode",placeholder:"blur",src:c.Z})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["若应用启用了 ",(0,l.jsx)(e.a,{href:"https://reactnative.cn/docs/next/linking#%E5%90%AF%E7%94%A8-deep-links",children:"DeepLink"})," 功能"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:'代码中无需任何改动，只需在上述界面中勾选“使用 Deep Link”，填入您应用的协议名，例如"pushy://"，然后使用系统相机或系统内置的扫一扫功能扫码（注意不能使用微信扫码），即可自动调起应用并触发更新。'}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"若应用自带扫码功能"}),"\n"]}),"\n",(0,l.jsxs)(e.p,{children:["请参考 ",(0,l.jsx)(e.a,{href:"api#function-parsetestqrcodeqrcode-string",children:"parseTestQrCode"})," 方法的说明。"]}),"\n",(0,l.jsxs)(e.details,{children:["\n",(0,l.jsx)(e.summary,{children:"若您的应用不具有上述两项功能，或 pushy 版本低于 v10.11.2，则可以参考如下测试方式（不推荐）"}),"\n",(0,l.jsxs)(e.p,{children:["先发布一个",(0,l.jsx)(e.strong,{children:"测试包"}),"，再发布一个除了版本号以外均完全相同的",(0,l.jsx)(e.strong,{children:"正式包"}),"。"]}),"\n",(0,l.jsxs)(e.p,{children:["例如，假设我们有一个正式包，版本为",(0,l.jsx)(e.code,{children:"1.6.0"}),"，那么可以修改版本号重新打包一个",(0,l.jsx)(e.code,{children:"1001.6.0"}),"，以一个明显不太正常的版本号来标识它是一个测试版本，同时后几位相同，可以表明它和某个正式版本存在关联（内容/依赖一致）。"]}),"\n",(0,l.jsxs)(e.p,{children:["在每次往发布包发起热更新之前，先对",(0,l.jsx)(e.strong,{children:"测试包"}),(0,l.jsx)(e.code,{children:"1001.6.0"}),"进行更新操作，基本测试通过之后，再在网页后台上将热更包重新绑定到",(0,l.jsx)(e.strong,{children:"正式包"}),(0,l.jsx)(e.code,{children:"1.6.0"}),"上。如果在测试包中发现了重大问题，你就可以先进行修复，更新测试确认通过后再部署到正式线上环境。这样，可以最大程度的避免发生线上事故。"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:"若您用来测试的原生包当前已经有发布的热更版本且更新策略是立即应用，那么和扫码测试之间可能产生策略冲突，比如扫码更新后又立即强制更新到发布版本，对测试带来不便。此时可以考虑在扫码更新之后，利用 beforeCheckUpdate 回调临时禁止更新检查，直到下次启动再恢复。"}),"\n",(0,l.jsx)(e.pre,{"data-language":"js","data-theme":"default",children:(0,l.jsxs)(e.code,{"data-language":"js","data-theme":"default",children:[(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// isFirstTimeDebug 这个标志位需要 v10.37.0+ 版本，表示当前是扫码热更后的第一次启动"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" { isFirstTimeDebug } "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'react-native-update/src/core'"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"pushyClient"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"new"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Pushy"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"({"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"beforeCheckUpdate"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" () "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" (isFirstTimeDebug) {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// 如果当前是扫码热更后的第一次启动，则跳过热更检查"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"false"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"true"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  }"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"})"})})]})}),"\n",(0,l.jsx)(e.p,{children:"万一确实发生线上事故需要回滚的话，先立即对原生包或者整个应用设置暂停热更，然后更改绑定到之前正常的版本，或者利用版本控制系统回滚代码到正常的状态，然后重新生成热更包并推送。"}),"\n",(0,l.jsx)(e.h4,{id:"元信息meta-info的使用",children:"元信息(Meta Info)的使用"}),"\n",(0,l.jsxs)(e.p,{children:["在发布热更新版本时，或者在网页端，你可以编辑版本的元信息。这是一段在检查更新时可以获得的字符串，你可以在其中按你所想的格式（一般建议用",(0,l.jsx)(e.a,{href:"https://developer.mozilla.org/zh-CN/docs/Learn/JavaScript/Objects/JSON",children:"JSON 格式"}),"）保存一些信息。"]}),"\n",(0,l.jsxs)(e.p,{children:["比如我们可以在元信息中约定字段标志",(0,l.jsx)(e.code,{children:"silent"}),"，表示需要静默更新。当我们上传热更包填写 metainfo 时，以",(0,l.jsx)(e.a,{href:"https://developer.mozilla.org/zh-CN/docs/Learn/JavaScript/Objects/JSON",children:"JSON 格式"}),"输入："]}),"\n",(0,l.jsx)(e.pre,{"data-language":"json","data-theme":"default",children:(0,l.jsx)(e.code,{"data-language":"json","data-theme":"default",children:(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"{ "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:'"silent"'}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"true"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" }"})]})})}),"\n",(0,l.jsxs)(e.blockquote,{children:["\n",(0,l.jsx)(e.p,{children:"请注意，我们并不对输入做任何格式校验和约束，请自行校验输入是否正确。"}),"\n"]}),"\n",(0,l.jsxs)(e.p,{children:["此时在客户端检查更新时，能获取到我们刚刚输入的元信息，但它并不具备任何功能，只是一个字符串而已。所以我们其实需要",(0,l.jsx)(e.strong,{children:"预先"}),"在更新流程中加入对应的处理逻辑："]}),"\n",(0,l.jsx)(e.pre,{"data-language":"js","data-theme":"default",children:(0,l.jsxs)(e.code,{"data-language":"js","data-theme":"default",children:[(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// 调用 useUpdate() 获取 updateInfo"})}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"updateInfo"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:".expired) {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// ... 原生包版本过期，下载或跳转下载页面"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"} "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"else"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"updateInfo"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:".upToDate) {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// ... 没有更新，弹提示或忽略"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"} "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"else"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// 有更新，一般来说我们在这里给用户弹窗提示，让用户选择是否更新"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// 那么静默更新的本质其实就是不弹窗，直接执行，所以可以在这里加入额外的判断流程"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// ..."})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,l.jsx)(e.p,{children:"我们在原有的更新流程中加入元信息的读取和判断："}),"\n",(0,l.jsx)(e.pre,{"data-language":"js","data-theme":"default",children:(0,l.jsxs)(e.code,{"data-language":"js","data-theme":"default",children:[(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" metaInfo "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {};"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"try"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// 注意 JSON 输入有可能有错误，需要用 try 语句来避免应用被带崩"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  metaInfo "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"JSON"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:".parse"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"updateInfo"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:".metaInfo);"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"} "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"catch"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" (e) {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// 异常处理，忽略或上报？"})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,l.jsx)(e.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"metaInfo"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:".silent) {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// 如果热更包携带有 silent 字段，不询问用户，直接执行更新"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"switchVersion"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"();"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"} "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"else"}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// 否则还是走之前的询问流程"})]}),"\n",(0,l.jsxs)(e.span,{className:"line",children:[(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,l.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Alert.alert('提示', '检查到新的版本......."})]}),"\n",(0,l.jsx)(e.span,{className:"line",children:(0,l.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,l.jsx)(e.p,{children:"又比如，可能某个版本包含一些重要的公告内容，所以还可以在上面插入一个公告字段等等。如何使用元信息，完全取决于您的想象力！"})]})}var h=(0,r.j)({MDXContent:function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,i.a)(),s.components);return e?(0,l.jsx)(e,{...s,children:(0,l.jsx)(t,{...s})}):t(s)},pageOpts:{filePath:"pages/docs/bestpractice.md",route:"/docs/bestpractice",frontMatter:{order:13,title:"场景实践",type:"开发指南"},title:"场景实践",headings:o},pageNextRoute:"/docs/bestpractice"})}},function(s){s.O(0,[8332,2888,9774,179],function(){return s(s.s=11361)}),_N_E=s.O()}]);