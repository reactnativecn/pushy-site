[{"id":0,"title":"API参考","content":"JavaScript 方法#\n\nnew Pushy(options: PushyOptions)#\n\n创建 Pushy 热更新服务实例，其构造参数如下：\n\n\n\nuseUpdate()#\n\n热更相关的工具函数。此方法也可使用别名 usePushy 引入。\n\nINFO\n\n注意，在使用 <UpdateProvider> 的当前组件（一般是根组件）中无法直接调用useUpdate，只有当前组件的子组件才能调用。\n\n\n\n其类型定义和功能如下：\n\n\n\n--------------------------------------------------------------------------------\n\nasync function checkUpdate()#\n\n触发更新检查，返回updateInfo（注意在 v10.26.0\n版本之前，checkUpdate方法本身没有返回值，只能从useUpdate()返回的updateInfo中获取，且我们仍然推荐优先使用useUpdate()来\n获取），返回值有三种情形：\n\n 1. {expired: true}：该应用原生包已过期（三种情况：1. 主动设置为过期状态，2. 主动删除，3.\n    从未上传），需要引导用户下载或跳转到应用市场(需要在网页管理端设置中填写downloadUrl)。如需在应用内执行 apk 更新，还需配置安装权限。\n\n\n\n 2. {upToDate: true}：当前已经更新到最新，无需进行更新。\n\n 3. {update:\n    true}：当前有新版本可以更新。name、description字段可以用于展示给用户版本号，更新内容等信息，而metaInfo字段则可以根据你的需求\n    自定义一些标记(如是否静默更新、是否强制更新等等，自己根据标记的属性做一些条件流程控制)，具体用法可参考场景实践。另外还有几个字段，包含了热更新文件的下\n    载地址，\n\n\n\n--------------------------------------------------------------------------------\n\nasync function downloadUpdate()#\n\n下载热更包。仅当update:true时实际进行下载。会更新progress数据。v10.16.0+ 版本返回值为boolean，表示是否下载成功。\n\n--------------------------------------------------------------------------------\n\nasync function downloadAndInstallApk(url)#\n\n下载更新的 apk 包并直接安装。url必须为可直接下载到 apk 文件的地址。\n\n由于系统安全限制等各种外部因素，此功能并不能保证一定正常调用。在应用当前运行周期内，如果下载或者安装失败，则再次调用时不会重试，只会静默失败。\n\n注意要使用这个功能还需要在AndroidManifest.xml中手动添加安装权限，如果需要考虑 Android 7.0 以下的客户，则还需要添加外部存储权限。\n\n\n\n注意某些应用市场可能会因为上述权限拒绝应用上架。去掉上述两个权限并不影响热更新功能。\n\n--------------------------------------------------------------------------------\n\nfunction markSuccess()#\n\n一般情况下请勿手动调用此函数。调用此函数作为更新成功的标记（否则下次启动会默认失败自动回滚）。\n\n--------------------------------------------------------------------------------\n\nasync function getCurrentVersionInfo()#\n\n获取当前已热更版本的信息（如尚未热更过则返回空对象）。v10.31.2 版本之后可以直接用 currentVersionInfo 代替。\n\n返回值示例：\n\n\n\n--------------------------------------------------------------------------------\n\nfunction restartApp()#\n\n立即重启应用。v10.28.2+ 版本可用。\n\n--------------------------------------------------------------------------------\n\nfunction switchVersion()#\n\n立即重启应用，并加载已经下载完毕的版本。\n\n> 注意!不可依赖progress来判断下载完成，必须要在await downloadUpdate()之后再调用此方法。\n\n--------------------------------------------------------------------------------\n\nfunction switchVersionLater()#\n\n在下一次启动应用的时候加载已经下载完毕的版本。\n\n> 注意!不可依赖progress来判断下载完成，必须要在await downloadUpdate()之后再调用此方法。\n\n--------------------------------------------------------------------------------\n\nfunction parseTestQrCode(qrCode: string)#\n\n解析测试二维码，一般用于给 QA 人员测试热更新。如果在应用中已有扫码功能，则可以在应用中扫描 pushy 后台的测试二维码来测试任意版本的热更包。\n\n\n\n注意使用此方法，上述界面中的\"使用 Deep Link\"选项 勾选。\n\n代码示例：\n\n\n\n--------------------------------------------------------------------------------\n\n\nAndroid 方法#\n\nUpdateContext.setCustomInstanceManager(ReactInstanceManager instanceManager)#\n\n如果是集成/混编 Android 方案，则可以使用此方法传入你自行创建的 ReactInstanceManager。自v5.5.8版本起可用。\n\n示例：\n\n","routePath":"/docs/api","lang":"","toc":[{"text":"JavaScript 方法","id":"javascript-方法","depth":3,"charIndex":-1},{"text":"new Pushy(options: PushyOptions)","id":"new-pushyoptions-pushyoptions","depth":4,"charIndex":15},{"text":"useUpdate()","id":"useupdate","depth":4,"charIndex":79},{"text":"async function checkUpdate()","id":"async-function-checkupdate","depth":4,"charIndex":303},{"text":"async function downloadUpdate()","id":"async-function-downloadupdate","depth":4,"charIndex":913},{"text":"async function downloadAndInstallApk(url)","id":"async-function-downloadandinstallapkurl","depth":4,"charIndex":1105},{"text":"function markSuccess()","id":"function-marksuccess","depth":4,"charIndex":1474},{"text":"async function getCurrentVersionInfo()","id":"async-function-getcurrentversioninfo","depth":4,"charIndex":1630},{"text":"function restartApp()","id":"function-restartapp","depth":4,"charIndex":1833},{"text":"function switchVersion()","id":"function-switchversion","depth":4,"charIndex":1963},{"text":"function switchVersionLater()","id":"function-switchversionlater","depth":4,"charIndex":2156},{"text":"function parseTestQrCode(qrCode: string)","id":"function-parsetestqrcodeqrcode-string","depth":4,"charIndex":2357},{"text":"Android 方法","id":"android-方法","depth":3,"charIndex":2606},{"text":"UpdateContext.setCustomInstanceManager(ReactInstanceManager instanceManager)","id":"updatecontextsetcustominstancemanagerreactinstancemanager-instancemanager","depth":4,"charIndex":2619}],"domain":"","frontmatter":{"order":11,"title":"API参考","type":"开发指南"},"version":""},{"id":1,"title":"场景实践","content":"优化原生和热更包体积#\n\niOS 原生包优化(ipa)#\n\n对于同一份 archive（其版本号、编译时间和内置 bundle 已固定，不会受导出方式所影响），可以用不同选项多次导出 ipa，选择其中最小的上传到\npushy 服务器作为热更基准包。\n\n\n\nAndroid 原生包优化(apk)#\n\napk 的优化主要考虑两个方向：\n\n * 启用 proguard 压缩混淆源码。但这一步可能导致一些使用反射的代码运行时报错，启用后需要充分测试每个页面和功能，以及需要阅读一些第三方关于\n   proguard 的特别设置说明。\n * 分开编译不同的 cpu 架构。找到android/app/build.gradle中的 cpu 架构部分，如下所示启用enable选项：\n\n\n\n如此一来会在编译目录中输出多个 apk 文件，分发和上传到热更新服务时只需要使用app-arm64-v8a-release.apk文件，可以大幅减小 apk\n的大小。\n\n热更新包优化(ppk)#\n\n热更新包的主要内容是 js 包和其所引用的静态资源（主要是图片）。\n\n * js 包成分分析。可以借助一些第三方工具（如react-native-bundle-visualizer）来分析 js\n   文件中哪些占比较大，是否可以用其他库替换等（如 dayjs 替换 moment，lodash-es 替换 lodash）。\n * 图片优化。\n   * 在保证体验的情况下，使用一些工具对图片进行裁剪压缩。\n   * 如不需要图片的透明像素，可以考虑将 png 格式转为 jpg 格式。\n   * 还可以进一步考虑压缩比更高的图片格式，例如 webp 格式（需要第三方原生插件例如react-native-webp-format），heif\n     格式（iOS 11 和 Android 10 以上原生支持）等。这里有个图片格式对比可供参考\n     https://compare.rokka.io/_compare/#heif=40&jpeg=80&webp=80&av1=40&width=800\n     。\n\n有很多渠道包需要热更，如何操作比较方便？#\n\n 1. 如果渠道包的js代码和初始资源有差别（无论多么细微的差别都会生成不同的 jsbundle），那么只能单独生成\n    apk，分别上传和绑定。可以考虑写一些脚本自动调用 cli 来执行批量操作。\n 2. 如果渠道包的js代码和初始资源完全一致，可以考虑使用Flavor 构建，或其他一些动态生成渠道包的方案（比如腾讯的 VasDolly，美团的\n    walle等），这样所有的渠道包基于同一个基础 apk 生成（因而会有相同的编译时间戳和 jsbundle）。这样可以只用上传一个基础 apk，对此\n    apk 的热更操作可以对所有渠道包生效。\n 3. 如果您是高级版、专业版或大客户VIP版客户，也可以考虑在管理后台的应用设置中启用忽略编译时间戳。此选项仅对比版本号，不校验时间戳，可提供更宽容的热更策略\n    ，但可能消耗更多流量。\n\n如何支持 aab 格式的原生包？#\n\n将 react-native-update-cli 更新到 v2.6.0 以上版本，即可使用 pushy parseAab 和 pushy uploadAab\n命令来支持 aab 格式的原生包。\n\n测试与回滚#\n\n自 v10.11.2 版本开始，可以使用以下两种快捷扫码方案来测试热更，而无需提前进行绑定：\n\n\n\n * 若应用启用了 DeepLink 功能\n\n代码中无需任何改动，只需在上述界面中勾选“使用 Deep\nLink”，填入您应用的协议名，例如\"pushy://\"，然后使用系统相机或系统内置的扫一扫功能扫码（注意不能使用微信扫码），即可自动调起应用并触发更新。\n\n * 若应用自带扫码功能\n\n请参考 parseTestQrCode 方法的说明。\n\n先发布一个测试包，再发布一个除了版本号以外均完全相同的正式包。\n\n例如，假设我们有一个正式包，版本为1.6.0，那么可以修改版本号重新打包一个1001.6.0，以一个明显不太正常的版本号来标识它是一个测试版本，同时后几位相同，\n可以表明它和某个正式版本存在关联（内容/依赖一致）。\n\n在每次往发布包发起热更新之前，先对测试包1001.6.0进行更新操作，基本测试通过之后，再在网页后台上将热更包重新绑定到正式包1.6.0上。如果在测试包中发现了\n重大问题，你就可以先进行修复，更新测试确认通过后再部署到正式线上环境。这样，可以最大程度的避免发生线上事故。\n\n若您用来测试的原生包当前已经有发布的热更版本且更新策略是立即应用，那么和扫码测试之间可能产生策略冲突，比如扫码更新后又立即强制更新到发布版本，对测试带来不便。此\n时可以考虑在扫码更新之后，利用 beforeCheckUpdate 回调临时禁止更新检查，直到下次启动再恢复。\n\n\n\n万一确实发生线上事故需要回滚的话，先立即对原生包或者整个应用设置暂停热更，然后更改绑定到之前正常的版本，或者利用版本控制系统回滚代码到正常的状态，然后重新生成热\n更包并推送。\n\n元信息(Meta Info)的使用#\n\n在发布热更新版本时，或者在网页端，你可以编辑版本的元信息。这是一段在检查更新时可以获得的字符串，你可以在其中按你所想的格式（一般建议用JSON\n格式）保存一些信息。\n\n比如我们可以在元信息中约定字段标志silent，表示需要静默更新。当我们上传热更包填写 metainfo 时，以JSON 格式输入：\n\n\n\n> 请注意，我们并不对输入做任何格式校验和约束，请自行校验输入是否正确。\n\n此时在客户端检查更新时，能获取到我们刚刚输入的元信息，但它并不具备任何功能，只是一个字符串而已。所以我们其实需要预先在更新流程中加入对应的处理逻辑：\n\n\n\n我们在原有的更新流程中加入元信息的读取和判断：\n\n\n\n又比如，可能某个版本包含一些重要的公告内容，所以还可以在上面插入一个公告字段等等。如何使用元信息，完全取决于您的想象力！","routePath":"/docs/bestpractice","lang":"","toc":[{"text":"优化原生和热更包体积","id":"优化原生和热更包体积","depth":4,"charIndex":-1},{"text":"有很多渠道包需要热更，如何操作比较方便？","id":"有很多渠道包需要热更如何操作比较方便","depth":4,"charIndex":899},{"text":"如何支持 aab 格式的原生包？","id":"如何支持-aab-格式的原生包","depth":4,"charIndex":1301},{"text":"测试与回滚","id":"测试与回滚","depth":4,"charIndex":1419},{"text":"元信息(Meta Info)的使用","id":"元信息meta-info的使用","depth":4,"charIndex":2158}],"domain":"","frontmatter":{"order":13,"title":"场景实践","type":"开发指南"},"version":""},{"id":2,"title":"命令行工具（内置）","content":"安装#\n\n\n\n\n命令#\n\npushy bundle#\n\n生成热更资源包。会自动探测项目中是否使用了 expo、taro 等框架并自动调用对应的命令行打包。如果探测不准确或使用对应命令行打包时报错，可尝试使用\n--rncli 参数来指定官方命令行打包。\n\n * platform: ios|android|harmony 对应的平台\n * entryFile: 入口脚本文件\n * intermediaDir: 临时文件输出目录\n * output: 最终 ppk 文件输出路径\n * dev: 是否打包开发版本\n * sourcemap: 是否生成 sourcemap(需 cli 版本 1.11.0+)\n * no-interactive: 不进行交互式提示\n * rncli: 指定使用官方命令行打包 (需 cli 版本 1.40.0+)\n * expo: 指定使用 expo 的命令行打包 (需 cli 版本 1.40.0+)\n * taro: 指定使用 taro 的命令行打包 (需 cli 版本 1.40.0+)\n\n从 v1.44.2 版本开始，新增了以下直接上传发布的参数（等同于打包完成后连续调用 pushy publish 命令）：\n\n * name: 指定热更新版本的名字(热更自身的版本号)\n * description: 指定热更新版本的描述信息，可以对用户进行展示\n * metaInfo: 指定热更新版本的元信息，可以用来保存一些额外信息，具体用法可参考场景实践。\n\n从 v1.46.1 版本开始，在传入 name， description， metaInfo 参数的同时，可继续叠加以下参数（等同于在调用pushy\npublish 命令后，再连续调用 pushy update 命令）：\n\n * packageId: 要绑定的原生包 ID （多选一）\n * packageVersion: 要绑定的原生包版本名（多选一）\n * minPackageVersion: 要绑定的最低原生包版本，大于等于此版本的将逐个绑定（多选一）\n * maxPackageVersion: 要绑定的最高原生包版本，小于等于此版本的将逐个绑定（多选一）\n * packageVersionRange: 要绑定的原生包版本范围（多选一），范围格式遵循 semver 的语法，可参考\n   https://quickref.cnxiaobai.com/docs/semver.html 或 https://devhints.io/semver\n\n示例：\n\n\n\n--------------------------------------------------------------------------------\n\npushy parseIpa [ipaFile]#\n\n解析 ipa 文件并输出一些相关信息，如版本号，编译时间戳等。\n\n--------------------------------------------------------------------------------\n\npushy parseApk [apkFile]#\n\n解析 apk 文件并输出一些相关信息，如版本号，编译时间戳等。\n\n--------------------------------------------------------------------------------\n\npushy parseApp [appFile]#\n\n解析 app 文件并输出一些相关信息，如版本号，编译时间戳等。\n\n--------------------------------------------------------------------------------\n\npushy parseAab [aabFile]#\n\n解析 aab 文件并输出一些相关信息，如版本号，编译时间戳等。\n\n--------------------------------------------------------------------------------\n\npushy diff [origin][next]#\n\n提供两个 ppk 文件，生成从 origin 到 next 版本的差异更新包。\n\n * output: diff 文件输出路径\n\n--------------------------------------------------------------------------------\n\npushy diffFromApk [apkFile][next]#\n\n提供一个 apk 文件和一个 ppk 文件，生成从 apk 文件到 next 版本的差异更新包。\n\n如果使用热更新开放平台，你不需要自己执行此命令。\n\n * output: diff 文件输出路径\n\n--------------------------------------------------------------------------------\n\npushy diffFromApp [appFile][next]#\n\n提供一个 app 文件和一个 ppk 文件，生成从 app 文件到 next 版本的差异更新包。\n\n如果使用热更新开放平台，你不需要自己执行此命令。\n\n * output: diff 文件输出路径\n\n--------------------------------------------------------------------------------\n\npushy diffFromIpa [ipaFile][next]#\n\n提供一个 ipa 文件和一个 ppk 文件，生成从 ipa 文件到 next 版本的差异更新包。\n\n如果使用热更新开放平台，你不需要自己执行此命令。\n\n * output: diff 文件输出路径\n\n--------------------------------------------------------------------------------\n\npushy login [email][pwd]#\n\n登录热更新开放平台。你需要先登录才能使用下面的命令。\n\n--------------------------------------------------------------------------------\n\npushy logout#\n\n登出并清除本地的登录信息\n\n--------------------------------------------------------------------------------\n\npushy me#\n\n查看自己是否已经登录，以及昵称等信息。\n\n--------------------------------------------------------------------------------\n\npushy createApp#\n\n创建应用并立刻绑定到当前工程。这项操作也可以在网页管理端进行。\n\n * platform: ios|android|harmony 对应的平台\n * name: 应用名称\n * downloadUrl: 应用安装包的下载地址\n\n--------------------------------------------------------------------------------\n\npushy deleteApp [appId]#\n\n删除已有应用。所有已创建的应用包、热更新版本都会被同时删除。这项操作也可以在网页管理端进行。\n\n * appId: 要删除的应用 ID\n\n--------------------------------------------------------------------------------\n\npushy apps#\n\n查看当前已创建的全部应用。这项操作也可以在网页管理端进行。\n\n * platform: ios|android|harmony 对应的平台\n\n--------------------------------------------------------------------------------\n\npushy selectApp [appId]#\n\n绑定应用到当前工程。\n\n * platform: ios|android|harmony 对应的平台\n\n--------------------------------------------------------------------------------\n\npushy uploadIpa [ipaFile]#\n\n上传 ipa 文件到开放平台。\n\n * note: 备注（cli 需 1.24.0 +）\n\n--------------------------------------------------------------------------------\n\npushy uploadApk [apkFile]#\n\n上传 apk 文件到开放平台。\n\n * note: 备注（cli 需 1.24.0 +）\n\n--------------------------------------------------------------------------------\n\npushy uploadApp [appFile]#\n\n上传 app 文件到开放平台。\n\n * note: 备注（cli 需 1.24.0 +）\n\n--------------------------------------------------------------------------------\n\npushy uploadAab [aabFile]#\n\n上传 aab 文件到开放平台。\n\n * note: 备注（cli 需 2.6.0 +）\n\n--------------------------------------------------------------------------------\n\npushy packages#\n\n查看已经上传的原生包。这项操作也可以在网页管理端进行。\n\n * platform: ios|android|harmony 对应的平台\n\n--------------------------------------------------------------------------------\n\npushy deletePackage#\n\n删除已经上传的原生包。\n\n * appId: 要删除的原生包所属的应用 ID\n * packageId: 要删除的原生包 ID\n\n--------------------------------------------------------------------------------\n\npushy publish [ppkFile]#\n\n发布新的热更新版本（ppk 文件）。\n\n * platform: ios|android|harmony 对应的平台\n * name: 当前热更新版本的名字(版本号)\n * description: 当前热更新版本的描述信息，可以对用户进行展示\n * metaInfo: 当前热更新版本的元信息，可以用来保存一些额外信息，具体用法可参考场景实践。\n\n从 v1.46.1 版本开始，支持以下参数（等同于在 调用pushy publish 命令后，再连续调用 pushy update 命令）：\n\n * packageId: 要绑定的原生包 ID （多选一）\n * packageVersion: 要绑定的原生包版本名（多选一）\n * minPackageVersion: 要绑定的最低原生包版本，大于等于此版本的将逐个绑定（多选一）\n * maxPackageVersion: 要绑定的最高原生包版本，小于等于此版本的将逐个绑定（多选一）\n * packageVersionRange: 要绑定的原生包版本范围（多选一），范围格式遵循 semver 的语法，可参考\n   https://quickref.cnxiaobai.com/docs/semver.html 或 https://devhints.io/semver\n\n示例：\n\n\n\n--------------------------------------------------------------------------------\n\npushy versions#\n\n分页列举可用的版本。这项操作也可以在网页管理端进行。\n\n * platform: ios|android|harmony 对应的平台\n\n--------------------------------------------------------------------------------\n\npushy deleteVersion#\n\n删除已经发布的热更新版本。\n\n * appId: 要删除的热更新版本所属的应用 ID\n * versionId: 要删除的热更新版本 ID\n\n--------------------------------------------------------------------------------\n\npushy update#\n\n为一个原生包版本绑定发布一个热更新版本。这项操作也可以在网页管理端进行。以下参数中packageId，packageVersion，minPackageVers\nion，maxPackageVersion和packageVersionRange中多选一即可。\n\ncli 2.4.0 版本开始可以同时绑定一个全量和一个灰度版本。2.4.0 之前全量和灰度版本会互相覆盖，后设置的生效。\n\n * platform: ios|android|harmony 对应的平台\n * versionId: 要绑定的热更新版本 ID\n * rollout: 灰度发布范围（整数取值 1 - 100，对应 1% - 100% 终端设备覆盖率），默认为 100（需 cli 版本 1.31.0+）\n * dryRun: 是否只进行预览，不进行实际绑定（需 cli 版本 1.45.4+）\n * packageId: 要绑定的原生包 ID （多选一）\n * packageVersion: 要绑定的原生包版本名（多选一，需 cli 版本 1.7.2+）\n * minPackageVersion: 要绑定的最低原生包版本，大于等于此版本的将逐个绑定（多选一，需 cli 版本 1.27.0+）\n * maxPackageVersion: 要绑定的最高原生包版本，小于等于此版本的将逐个绑定（多选一，需 cli 版本 1.27.0+）\n * packageVersionRange: 要绑定的原生包版本范围（多选一，需 cli 版本 1.45.4+），范围格式遵循 semver 的语法，可参考\n   https://quickref.cnxiaobai.com/docs/semver.html 或 https://devhints.io/semver\n\n示例：\n\n","routePath":"/docs/cli","lang":"","toc":[{"text":"安装","id":"安装","depth":3,"charIndex":-1},{"text":"命令","id":"命令","depth":3,"charIndex":7},{"text":"pushy bundle","id":"pushy-bundle","depth":4,"charIndex":12},{"text":"pushy parseIpa [ipaFile]","id":"pushy-parseipa-ipafile","depth":4,"charIndex":1163},{"text":"pushy parseApk [apkFile]","id":"pushy-parseapk-apkfile","depth":4,"charIndex":1305},{"text":"pushy parseApp [appFile]","id":"pushy-parseapp-appfile","depth":4,"charIndex":1447},{"text":"pushy parseAab [aabFile]","id":"pushy-parseaab-aabfile","depth":4,"charIndex":1589},{"text":"pushy diff [origin][next]","id":"pushy-diff-originnext","depth":4,"charIndex":1731},{"text":"pushy diffFromApk [apkFile][next]","id":"pushy-difffromapk-apkfilenext","depth":4,"charIndex":1906},{"text":"pushy diffFromApp [appFile][next]","id":"pushy-difffromapp-appfilenext","depth":4,"charIndex":2124},{"text":"pushy diffFromIpa [ipaFile][next]","id":"pushy-difffromipa-ipafilenext","depth":4,"charIndex":2342},{"text":"pushy login [email][pwd]","id":"pushy-login-emailpwd","depth":4,"charIndex":2560},{"text":"pushy logout","id":"pushy-logout","depth":4,"charIndex":2697},{"text":"pushy me","id":"pushy-me","depth":4,"charIndex":2808},{"text":"pushy createApp","id":"pushy-createapp","depth":4,"charIndex":2922},{"text":"pushy deleteApp [appId]","id":"pushy-deleteapp-appid","depth":4,"charIndex":3136},{"text":"pushy apps","id":"pushy-apps","depth":4,"charIndex":3313},{"text":"pushy selectApp [appId]","id":"pushy-selectapp-appid","depth":4,"charIndex":3479},{"text":"pushy uploadIpa [ipaFile]","id":"pushy-uploadipa-ipafile","depth":4,"charIndex":3639},{"text":"pushy uploadApk [apkFile]","id":"pushy-uploadapk-apkfile","depth":4,"charIndex":3795},{"text":"pushy uploadApp [appFile]","id":"pushy-uploadapp-appfile","depth":4,"charIndex":3951},{"text":"pushy uploadAab [aabFile]","id":"pushy-uploadaab-aabfile","depth":4,"charIndex":4107},{"text":"pushy packages","id":"pushy-packages","depth":4,"charIndex":4262},{"text":"pushy deletePackage","id":"pushy-deletepackage","depth":4,"charIndex":4430},{"text":"pushy publish [ppkFile]","id":"pushy-publish-ppkfile","depth":4,"charIndex":4599},{"text":"pushy versions","id":"pushy-versions","depth":4,"charIndex":5277},{"text":"pushy deleteVersion","id":"pushy-deleteversion","depth":4,"charIndex":5444},{"text":"pushy update","id":"pushy-update","depth":4,"charIndex":5619}],"domain":"","frontmatter":{"order":12,"title":"命令行工具（内置）","type":"开发指南"},"version":""},{"id":3,"title":"命令行工具（自定义模块）","content":"模块化功能 (Module System)#\n\n从 v2.0.0 版本开始，CLI 支持模块化扩展，允许开发者自定义命令和工作流。\n\n\n核心概念#\n\n * CLI Module: 包含自定义命令和工作流的模块\n * Command: 单个可执行的命令\n * Workflow: 由多个步骤组成的复杂工作流\n * Module Manager: 管理模块注册和执行的核心组件\n\n\n模块注册#\n\n\n\n\n创建自定义模块#\n\n\n\n\n查看已注册模块命令#\n\n\n\n--------------------------------------------------------------------------------\n\n\n工作流系统 (Workflow System)#\n\n工作流是由多个步骤组成的复杂任务执行流程，支持条件执行、错误处理和结果传递。\n\n\n内置工作流#\n\n1. 用户认证工作流#\n\npushy auth-check#\n\n检查用户认证状态\n\n\n\npushy login-flow#\n\n完整的用户登录流程\n\n\n\n2. 应用管理工作流#\n\npushy workflow multi-platform-app-management#\n\n跨平台应用统一管理\n\n\n\npushy workflow incremental-build#\n\n增量构建工作流，生成差异更新包\n\n\n\n\n工作流管理命令#\n\n列出所有可用工作流\n\n\n\npushy workflow#\n\n执行指定工作流\n\n\n\npushy list#\n\n列出所有已注册的模块\n\n\n\n\n工作流特性#\n\n 1. 步骤化执行: 工作流由多个步骤组成，按顺序执行\n 2. 结果传递: 每个步骤的结果可以传递给下一个步骤\n 3. 条件执行: 支持根据条件决定是否执行某个步骤\n 4. 错误处理: 内置错误处理和回滚机制\n 5. 进度反馈: 实时显示执行进度和状态\n 6. 参数验证: 执行前自动验证必需参数\n\n--------------------------------------------------------------------------------\n\n\n示例项目#\n\n在项目的 example/ 目录中提供了完整的模块和工作流使用示例：\n\n * example/modules/ - 自定义模块示例\n * example/workflows/ - 自定义工作流示例\n * example/scripts/ - 使用脚本示例\n\n运行示例：\n\n","routePath":"/docs/cli_module","lang":"","toc":[{"text":"模块化功能 (Module System)","id":"模块化功能-module-system","depth":2,"charIndex":-1},{"text":"核心概念","id":"核心概念","depth":3,"charIndex":67},{"text":"模块注册","id":"模块注册","depth":3,"charIndex":188},{"text":"创建自定义模块","id":"创建自定义模块","depth":3,"charIndex":198},{"text":"查看已注册模块命令","id":"查看已注册模块命令","depth":3,"charIndex":211},{"text":"工作流系统 (Workflow System)","id":"工作流系统-workflow-system","depth":2,"charIndex":308},{"text":"内置工作流","id":"内置工作流","depth":3,"charIndex":375},{"text":"1. 用户认证工作流","id":"1-用户认证工作流","depth":4,"charIndex":383},{"text":"2. 应用管理工作流","id":"2-应用管理工作流","depth":4,"charIndex":459},{"text":"工作流管理命令","id":"工作流管理命令","depth":3,"charIndex":587},{"text":"工作流特性","id":"工作流特性","depth":3,"charIndex":666},{"text":"示例项目","id":"示例项目","depth":2,"charIndex":907}],"domain":"","frontmatter":{"order":12,"title":"命令行工具（自定义模块）","type":"开发指南"},"version":""},{"id":4,"title":"常见问题","content":"如果本页面没能回答您的疑问，您可以去issues 区或 QQ 群 729013783 提问，或给我们发邮件。\n\n\n业务问题#\n\n热更新究竟能否上架？#\n\n您可能听说过各种说法，但大量实践表明，热更新目前能够顺利上架 AppStore\n和其他各种应用市场。唯一需要注意的是，在审核期间请不要发布热更新，不要让审核人员看到各种更新相关的提示和弹窗，即可顺利通过。\n\n--------------------------------------------------------------------------------\n\n是否可以在海外使用？#\n\n可以的，国内外都有高速 CDN 节点。\n\n--------------------------------------------------------------------------------\n\n哪些修改可以热更新？哪些不能？#\n\n我们把对应用的修改分为两类：\n\n * 不可热更新 —— 原生修改，即所有需要编译后才能生效的修改：\n   \n   * 任何在 iOS 或者 Android 目录中的修改、增删。\n   * 任何含有原生代码的第三方组件的更新、修改。\n\n * 可以热更新 —— 非原生修改，即所有无需编译，刷新即可生效的修改：\n   \n   * js 代码修改，包括第三方纯 js 组件的更新、修改。\n   * 可以在 js 代码中 require/import 的资源文件，例如图片。\n\n需要注意的是，即便资源文件可以热更新，但这些热更新后的资源文件会以file://协议的形式提供访问，某些读取资源文件的第三方可能并不支持file://协议。\n\n--------------------------------------------------------------------------------\n\n热更新成功完成，但是重启后又回滚了是怎么回事？#\n\n可以正常更新，但是重启后回滚，一般有两种可能的情况：\n\n * 没有正确配置 bundleUrl\n * （仅有 v10 以下版本存在此可能性，v10 及更高版本不存在此情况）没有正确调用 markSuccess\n\n如果你确定上述两个步骤都正确无误，请在issues 区给我们留言反馈。\n\n--------------------------------------------------------------------------------\n\n热更新报错：“热更新已暂停，原因：编译时间戳与服务器记录不一致。”#\n\n当您每次编译产生一个原生包时，其中都会记录一个编译时间戳buildTime(可以使用pushy parseIpa a.ipa或是pushy parseApk\na.apk命令来查看)。如果您需要把这个包发给客户并希望使用热更新功能，那么就需要使用 upload\n命令来上传到我们的服务器，而服务器端会记录这个包的版本号和编译时间戳以便后续比对记录。\n\n举例来说，假如我已经上传了一个 1.0\n版本原生包（1A包），但后来由于种种原因我又重新打包了（1B包）但没有上传，这两个包有相同的版本号，但会有不同的编译时间戳。此时有几种可能的情况：\n\n 1. 我忘记上传过1A包，1B包没有实质更改且还没有客户安装。此时应当放弃1B包，只让客户下载安装1A包。\n 2. 我忘记上传过1A包，又生成了1B包且已有客户安装。此时1A包客户可以获取热更新，1B包客户无法获取热更新。要使两批客户都能获取热更新，要么想办法通知1B\n    包客户装回1A包，要么重新发布一个高于1.0版本的原生包且上传到 pushy\n    服务器，并删除1.0版本的记录，此时1A包和1B包的客户都会收到版本过期需要下载新版本的通知。\n 3. 我知道上传过1A包，但我有原生方面的修改需要打了一个新的1B包。此时若将1B包上传到 pushy\n    服务器会提示版本验证错误，因为已经存在有相同的1.0版本。所以需要首先更改原生版本号再次打包，并首先将此新版本上传到服务器，然后分发给客户。这样1.0版\n    本和新版本可以并存且都可以获得热更新。\n\n请谨记，任何时候生成原生包，请 1)先修改原生版本号，2)并上传到 pushy 服务器，才可以正常获得热更新。\n\nINFO\n\n如果您是高级版、专业版或大客户VIP版客户，也可以考虑在管理后台的应用设置中启用忽略编译时间戳。此选项仅对比版本号，不校验时间戳，可提供更宽容的热更策略，但可能\n消耗更多流量，适合需要管理多个分发渠道的客户。\n\n--------------------------------------------------------------------------------\n\n\n付费问题#\n\n我应该选择哪个业务版本呢？#\n\n其实完全无需考虑，先从最高配额的专业版开始体验（新用户注册验证通过后，将自动获得 7\n天专业版试用），各个版本的使用流程完全一致！当试用时间到期后，若当前版本的配额不能满足需求，可随时补差价升级到更高配额的版本。升级自动按天数计算差价，绝无额外费\n用。\n\n目前仅有一项额外的付费专用功能，即忽略编译时间戳设置（在管理后台的应用设置中），此选项仅对比版本号，不校验时间戳，可提供更宽容的热更策略，但可能消耗更多流量，适\n合需要管理多个分发渠道的客户。此功能目前仅支持高级版、专业版和大客户VIP版。\n\n--------------------------------------------------------------------------------\n\n我可以试用付费版本先评估一下效果吗？#\n\n新用户注册验证通过后，将自动获得 7 天专业版试用。如您需要更长的评估时间，可将注册用户名、邮箱、公司（或个人）名称发送至 hi@charmlot.com\n，标题注明“pushy 评估试用延长”，我们会为您酌情延长评估时间。\n试用期间只能选择续费专业版或升级到更高版本，如需购买其他版本，请等待试用期过期，或者联系客服去除试用。\n\n--------------------------------------------------------------------------------\n\n配额具体如何计算？#\n\n配额主要分为 4 种：\n\n 1. 可创建的应用数量，注意 iOS 和 Android 版本记做不同的应用。\n 2. 原生包数量及大小，不同应用分开计算。原生包指通过pushy uploadIpa/uploadApk命令上传到 Pushy\n    服务器上作为热更新起始版本的完整 apk/ipa 安装包。\n 3. 热更包数量及大小，不同应用分开计算。热更包指通过pushy bundle所命令生成的 ppk\n    文件。注意这不是用户实际下载的更新文件，用户下载的是通过比对生成的增量 diff 文件（比 ppk 文件要小得多）。\n 4. 每日总热更查询次数，所有应用累加计算。每次用户打开应用时，会向服务器查询是否有新的热更新。这个查询次数会被计入每日总热更查询次数。当日超过限额次数后，接\n    口将不再返回新的热更新信息，直到次日重置。\n\n> 这里有一些对包大小的优化建议可供参考。\n\n以上 2、3 条为账户下每个应用单独计算，第 4\n条为账户下所有应用累加计算。具体配额和费用由于运营成本可能会有调整，请以价格表页面为准。已购买的用户在续费前不受调整影响。\n\n--------------------------------------------------------------------------------\n\n达到配额后还可以正常使用吗？#\n\n当应用、原生包、热更包数量达到配额限制后，您将无法执行相应的新增操作。但用户端仍可正常检查更新，下载已发布的更新。您可选择升级到更高配额，或是通过删除已不再使用\n的应用、原生包、热更包来使数量降低到配额以内，以便继续执行新增操作。\n\n若原生包、热更包大小超过限额，则会导致上传失败。您可以选择升级到更高配额，或是想办法进行精简优化。\n若当日热更检查次数超过限额，则会导致接口返回空数据。您可以选择升级到更高配额，或是优化热更策略，减少用户端检查更新的频率。\n\n--------------------------------------------------------------------------------\n\n我可以单独升级某项配额吗？#\n\n如果您需要单独升级某些配额（需要达到高级版以上），请通过邮件 hi@charmlot.com 或 QQ 34731408\n与我们联系，我们将根据您的个性化需求为您定制方案和报价。\n\n--------------------------------------------------------------------------------\n\n付费业务到期后不续费，现有应用还能否正常使用？#\n\n到期后按免费版额度执行。如您现有应用已超出配额，则必须通过删除操作降低到配额以内，方可执行新的操作（如创建应用，上传热更等），但不影响用户获取之前已发布的热更。\n\n--------------------------------------------------------------------------------\n\n如何获取付费的专人技术支持？#\n\n请将您的用户名和订单截图发送至 hi@charmlot.com ，同时提供您希望的技术联系方式（QQ、微信等），核实后会有技术专员添加您为好友。\n\n--------------------------------------------------------------------------------\n\n如何开具发票？#\n\n请将具体开票需求发送至 hi@charmlot.com\n，并附上注册邮箱和订单截图。我们默认会回复普通电子发票到注册邮箱，类目为软件服务。如需指定接受邮箱或手机，请在邮件正文中注明。如需要邮寄纸质发票请注明邮寄地址，\n邮费为到付。 如邮件发送后三个工作日内未收到回复，请联系 QQ 客服 34731408。\n\n--------------------------------------------------------------------------------\n\n可以使用银行转账付款吗？#\n\n可以的。请对照价格表，将对应版本的款项转账至：\n\n公司名称    武汉青罗网络科技有限公司\n账号      8888888048825564\n开户行名称   浙江网商银行\n开户地区    浙江省杭州市\n支行名称    浙江网商银行股份有限公司\n联行号     323331000001\n\n转账完成后请截图发送至 hi@charmlot.com ，并写明注册邮箱，我们将在一个工作日内开通对应服务。\n\n--------------------------------------------------------------------------------\n\n可以按月付款吗？#\n\n需要月付的客户请联系 QQ 客服 34731408，月付价格为年付价格 / 8。如标准版当前价格为 800 元每年，则月付价格为 100 元每月。\n月付客户需累计支付满 500 元后才能开具发票。大客户VIP版不支持月付。\n\n--------------------------------------------------------------------------------\n\n大客户方案#\n\n如果您的应用有大规模的活跃用户，日均所有应用累计总查询次数超过 100 万次，则建议选择我们专门针对大规模应用优化的大客户VIP版。\n大客户VIP版在应用数量、原生包数量、热更包数量等方面配额与专业版相同。\n\n当前价格如下表：\n\n服务版本   日均总热更查询次数   价格（元/年）\nVIP1   1000 万次     30000\nVIP2   5000 万次     60000\nVIP3   1 亿次        120000\nVIP4   1 亿次以上      请联系客服\n\n具体试用和对接请联系 QQ 客服 34731408","routePath":"/docs/faq","lang":"","toc":[{"text":"业务问题","id":"业务问题","depth":3,"charIndex":56},{"text":"热更新究竟能否上架？","id":"热更新究竟能否上架","depth":4,"charIndex":63},{"text":"是否可以在海外使用？","id":"是否可以在海外使用","depth":4,"charIndex":262},{"text":"哪些修改可以热更新？哪些不能？","id":"哪些修改可以热更新哪些不能","depth":4,"charIndex":378},{"text":"热更新成功完成，但是重启后又回滚了是怎么回事？","id":"热更新成功完成但是重启后又回滚了是怎么回事","depth":4,"charIndex":793},{"text":"热更新报错：“热更新已暂停，原因：编译时间戳与服务器记录不一致。”","id":"热更新报错热更新已暂停原因编译时间戳与服务器记录不一致","depth":4,"charIndex":1044},{"text":"付费问题","id":"付费问题","depth":3,"charIndex":1992},{"text":"我应该选择哪个业务版本呢？","id":"我应该选择哪个业务版本呢","depth":4,"charIndex":1999},{"text":"我可以试用付费版本先评估一下效果吗？","id":"我可以试用付费版本先评估一下效果吗","depth":4,"charIndex":2347},{"text":"配额具体如何计算？","id":"配额具体如何计算","depth":4,"charIndex":2616},{"text":"达到配额后还可以正常使用吗？","id":"达到配额后还可以正常使用吗","depth":4,"charIndex":3196},{"text":"我可以单独升级某项配额吗？","id":"我可以单独升级某项配额吗","depth":4,"charIndex":3525},{"text":"付费业务到期后不续费，现有应用还能否正常使用？","id":"付费业务到期后不续费现有应用还能否正常使用","depth":4,"charIndex":3714},{"text":"如何获取付费的专人技术支持？","id":"如何获取付费的专人技术支持","depth":4,"charIndex":3904},{"text":"如何开具发票？","id":"如何开具发票","depth":4,"charIndex":4077},{"text":"可以使用银行转账付款吗？","id":"可以使用银行转账付款吗","depth":4,"charIndex":4324},{"text":"可以按月付款吗？","id":"可以按月付款吗","depth":4,"charIndex":4621},{"text":"大客户方案","id":"大客户方案","depth":4,"charIndex":4827}],"domain":"","frontmatter":{"order":23,"title":"常见问题","type":"其他"},"version":""},{"id":5,"title":"安装配置","content":"INFO\n\n请注意，当前版本的api经过了完全重构，与之前的版本(v10.0以下)不兼容。如果你需要查看之前版本的文档，请点击这里\n\n首先你应该有一个基于 React Native 开发的应用，我们把具有 package.json 的目录叫做你的应用根目录。\n如果你还没有初始化应用，请参阅开始使用 React Native。\n\n我们假设你已经拥有了开发 React Native 应用的一切环境，包括Node.js、Xcode、Android SDK等等。\n\n","routePath":"/docs/getting-started","lang":"","toc":[],"domain":"","frontmatter":{"order":0,"title":"安装配置","type":"快速入门"},"version":""},{"id":6,"title":"代码集成","content":"INFO\n\n请注意，当前版本的api经过了完全重构，与之前的版本(v10.0以下)不兼容。如果你需要查看之前版本的文档，请点击这里\n\n安装配置完成后，确定应用编译顺利通过，下面我们来进行代码集成。\n\n\n获取 appKey#\n\n检查更新时必须提供你的appKey，这个值保存在update.json中（使用pushy createApp或pushy\nselectApp命令后会自动生成），并且根据平台不同而不同。你可以用如下的代码获取appKey：\n\n\n\n也可以在网页端的应用设置中查看应用的 appKey。\n\n\n初始化服务#\n\n\n\n如没有特别的自定义需求，那么到此热更新已经可以开始正常运作（如需在应用内执行 apk 更新，还需配置安装权限）。在默认的配置下，在 App\n启动，以及从后台切换到前台时会触发更新检查，弹出提示的内容也固定。\n\n如需简单调整检查和更新策略，可参考以下内置的策略参数：\n\ncheckStrategy（检查更新策略）#\n\n用于控制自动检查更新的触发时机：\n\n * \"both\"（默认值）：在 App 启动时和从后台切换到前台时都会检查更新\n * \"onAppStart\"：仅在 App 启动时检查更新\n * \"onAppResume\"：仅在 App 从后台切换到前台时检查更新\n * null：不自动检查更新，必须手动调用 checkUpdate 方法（需 v10.4.2+ 版本）\n\n示例：\n\n\n\nupdateStrategy（更新应用策略）#\n\n用于控制检测到更新后的自动下载和应用行为：\n\n * \"alwaysAlert\"：调试环境（__DEV__）的默认值，使用系统 alert 提示热更，并在有报错时弹出提示\n * \"alertUpdateAndIgnoreError\"：生产环境的默认值，有热更时使用系统 alert 提示，但不弹出报错提示\n * \"silentAndNow\"：自动静默下载并立即应用热更（会立即重启应用）\n * \"silentAndLater\"：自动静默下载，但仅在用户杀掉 App 后重启时应用更新\n * null：不自动下载和应用更新，需完全自定义热更界面\n\n示例：\n\n\n\n如需更大程度的自定义，如自定义触发时机，以及修改界面提示等，请参考下面的自定义更新界面。\n\n\n自定义更新界面#\n\n默认配置下，pushy 会以系统 alert 的形式来弹出更新提示，如需自定义更新界面，首先请关闭默认的 updateStrategy 更新策略，并打开\ndebug 选项以便调试：\n\n\n\n所有更新相关的数据可以通过一个单一的useUpdate()hook\n函数来获取（此函数也有别名usePushy()），然后可以根据其提供的数据来自行渲染自定义的界面，如下面的例子：\n\n\n\n其中checkUpdate方法可以用来手动触发更新检查。虽然这个方法会返回updateInfo（仅限 v10.26.0+\n版本），但我们仍然推荐优先使用useUpdate()来获取updateInfo。\n\nINFO\n\n依赖useUpdate()而不是checkUpdate来获取updateInfo，这样做虽然一开始可能觉得不太直观，但可以将检查逻辑和更新逻辑完全解耦，使更新流\n程上的各个组件不需要互相依赖和影响。 比如检查更新的按钮只管调用checkUpdate，某个显示小红点的组件只管从 useUpdate()\n中获取updateInfo，而主要的下载流程可以写一个单独的useEffect，这几者之间并不需要考虑先后顺序、组件层级或者传递数据。\n又比如你可能在多处都有检查更新的调用，比如 app 启动时、前后台切换时，又或者使用 deeplink\n和扫码，这些不同的检查逻辑也不用重复去实现后续的更新逻辑。\n\nupdateInfo 有三种情况：\n\n 1. {expired: true}：该应用原生包已过期（三种情况：1. 主动设置为过期状态，2. 主动删除，3. 从未上传），开发者应该在 pushy\n    的管理后台添加一个更新下载链接，并自行提示用户下载。如需在应用内执行 apk 更新，还需配置安装权限。\n\n 2. {upToDate: true}：当前已经更新到最新，无需进行更新。\n\n 3. {update: true}：当前有新版本可以更新。info\n    的name、description字段可以用于提示用户，而metaInfo字段则可以根据你的需求自定义其它属性(如是否静默更新、是否强制更新等等)，具体\n    用法可参考场景实践。另外还有几个字段，包含了补丁包的下载地址等。 pushy 会首先尝试耗费流量更少的更新方式。\n\n当返回的updateInfo中update字段为 true\n时，即可调用downloadUpdate方法来下载更新，此时可以获取到下载的进度数据progress。下载完成后（注意!不可依赖progress来判断下载完成，\n必须要await\ndownloadUpdate()之后）可以调用switchVersion来立即重启更新，也可以使用switchVersionLater来标记下次启动时更新。\n\n\n统计数据#\n\n初始化 Pushy 客户端时可以传入自定义的 logger 函数，其中可以自己记录日志或上报统计数据，比如下面的例子使用 Google Analytics\n来上报事件：\n\n\n\n以上提及的所有 api 的说明文档可在这里查看。还有一些其他常见的场景可以参考场景实践。\n\n现在，你的应用已经可以通过 pushy 服务检查版本并进行更新了。下一步，你可以开始尝试发布应用包和版本，请参阅发布热更新。","routePath":"/docs/integration","lang":"","toc":[{"text":"获取 appKey","id":"获取-appkey","depth":3,"charIndex":100},{"text":"初始化服务","id":"初始化服务","depth":3,"charIndex":255},{"text":"checkStrategy（检查更新策略）","id":"checkstrategy检查更新策略","depth":4,"charIndex":399},{"text":"updateStrategy（更新应用策略）","id":"updatestrategy更新应用策略","depth":4,"charIndex":612},{"text":"自定义更新界面","id":"自定义更新界面","depth":3,"charIndex":963},{"text":"统计数据","id":"统计数据","depth":3,"charIndex":2145}],"domain":"","frontmatter":{"order":1,"title":"代码集成","type":"快速入门"},"version":""},{"id":7,"title":"产品简介","content":"#\n\nINFO\n\n现已全面支持鸿蒙系统以及 React Native 新架构！\n\nPushy (npm 包名: react-native-update ) 是面向 React Native 应用提供的专业热更新服务，由 React\nNative 中文网独家研发并持续维护。我们致力于为全球 React Native 开发者提供最快速、最稳定、最经济的热更新体验。\n\n\n🚀 为什么选择 Pushy？#\n\n\n极致的更新体验#\n\n * 🎯 超小更新包：基于 bsdiff/hdiff 算法的增量更新，通常只需几十至几百 KB（相比其他全量更新服务的几十 MB，节省流量 99%+）\n\n * ⚡️ 极速分发：国内用户使用阿里云高速 CDN，国外用户智能分流至 Cloudflare，在各地区都使用覆盖率最好的 CDN 服务商，更新成功率高达\n   99.9%+\n\n * 🛡️ 安全可靠：内置崩溃回滚机制，出现问题自动回退，确保应用稳定运行\n\n * 🌐 全平台覆盖：完美支持 iOS、Android，且业内独家第一方支持 鸿蒙（HarmonyOS）\n\n * 🔍 深耕 React Native 生态：\n   \n   * ✅ Expo - 无缝集成\n   * ✅ 新架构 - 第一时间跟进支持\n   * ✅ Hermes - 完整支持字节码格式\n\n * 📖 核心逻辑完全开源：客户端、命令行工具以及管理界面代码都完全开源，接受社区审计，代码透明可信，你可以随时迁移到自建服务器或其他服务\n\n * 🔒 数据安全：可以自行插入数据埋点，完全掌控自己的数据\n\n * 💬 专业人工支持：提供付费专人技术支持，有问必答，确保你的应用稳定运行\n\n * 🏆 多年稳定运营：从 2016 年开始运营至今，服务众多知名企业和应用\n\n\n💰 性价比之选#\n\n相比同类服务，Pushy 不仅功能更强大，价格也更亲民：\n\n对比项     PUSHY          EXPO UPDATE\n起步价     ¥66/月          ~¥136/月\n流量计费    不单独计费          超出需额外付费\n更新包大小   几十至几百 KB（增量）   几十 MB（全量）\n国内速度    ⭐⭐⭐⭐⭐ 极快       ⭐⭐ 较慢\n鸿蒙支持    ✅ 支持           ❌ 不支持\n\nWARNING\n\n注意：Microsoft App Center（Code Push）已于 2025 年 3 月 31 日正式停止服务。如果你正在使用 Code\nPush，现在正是迁移到 Pushy 的最佳时机！\n\n使用 Pushy 后，你的团队将获得：\n\n * ✅ 节省 90% 以上的流量成本\n * ✅ 发版速度提升 10 倍以上（无需等待应用商店审核）\n * ✅ Bug 修复时间缩短至分钟级\n * ✅ 用户更新率提升至 99%+（相比应用商店的自然更新率）\n * ✅ 开发迭代更加灵活自由\n\n\n简单易用#\n\n\n\n内置多种更新策略，开箱即用：\n\n * 🔕 静默更新 - 后台自动下载，用户无感知\n * 💬 提示更新 - 友好的系统弹窗提醒\n * ⚙️ 自定义策略 - 完全可控的更新流程\n\n\n🚦 开始使用#\n\n只需三步，即可为你的 React Native 应用添加热更新能力：\n\n 1. 安装配置 - 5 分钟完成基础配置\n 2. 代码集成 - 几行代码即可接入\n 3. 发布更新 - 一条命令推送新版本\n\nNOTE\n\n不确定是否适合你的项目？查看常见问题或者可以去issues 区或 QQ 群 729013783 提问，或给我们发邮件。\n\n立即开始使用 Pushy，让你的 React Native 应用拥有极致的热更新体验！","routePath":"/docs/intro","lang":"","toc":[{"text":"🚀 为什么选择 Pushy？","id":"-为什么选择-pushy","depth":2,"charIndex":183},{"text":"极致的更新体验","id":"极致的更新体验","depth":3,"charIndex":202},{"text":"💰 性价比之选","id":"-性价比之选","depth":2,"charIndex":760},{"text":"简单易用","id":"简单易用","depth":3,"charIndex":1241},{"text":"🚦 开始使用","id":"-开始使用","depth":2,"charIndex":1341}],"domain":"","frontmatter":{"order":0,"title":"产品简介","type":"关于"},"version":""},{"id":8,"title":"发布热更新","content":"现在你的应用已经具备了检测更新的功能，下面我们来尝试发布并更新它。流程可参考下图：\n\n\n\n流程总结如下：\n\n 1. 我们需要先打包一个原生 release\n    版本，在打包前请确保已集成了react-native-update并在调试过程中运行正常，安卓端关闭了crunchPngs设置，打包说明可参考iOS\n    打包和android 打包。打包完成后请使用pushy uploadIpa或者pushy uploadApk命令来把这个安装包上传到 pushy\n    服务器端，以作为之后热更差量对比的基准。同时请保留好这个安装包，上架和分发给用户所使用的安装包需要和服务器端完全一致。建议使用 git tag\n    功能来标记原生版本号（例如v1.0.0）。\n 2. 然后在基准版本之上迭代业务逻辑（增删 js 代码，增删图片等静态资源），使用pushy\n    bundle命令来生成和发布热更新版本，而不需要重新打包。建议使用 git tag 功能来标记热更版本号（例如v1.0.1）。\n 3. 如果迭代过程中有原生方面的修改，则需要发布并上传新的原生基准版本（重复步骤\n    1，但需要设置不同的原生版本号）。可以只保留一个原生基准版本，也可以多版本同时维护。\n\n\n发布原生基准版本#\n\n\niOS#\n\n首先参考文档-在设备上运行，确定你正在使用离线包。然后点击菜单。\n\n按照正常的发布流程打包.ipa文件：\n\n 1. Xcode 中运行设备选真机或 Generic iOS Device\n 2. 菜单中选择 Product - Archive\n 3. Archive 完成后选择Export生成.ipa 文件\n 4. 然后运行如下命令上传到 pushy 服务器以供后续版本比对之用\n\n\n\n此 ipa\n的CFBundleShortVersionString字段(位于ios/项目名/Info.plist中)会被记录为原生版本号packageVersion。\n\n随后你可以选择往 AppStore 上传这个版本（可以重新 export 并调整相关选项，但请不要重新 archive），也可以先通过Test\nflight或蒲公英等渠道进行真机安装测试。请注意：暂不支持通过 Xcode 直接进行热更新测试。\n\n如果后续需要再次 archive 打包（例如修改原生代码或配置。如果只是修改 js\n代码则不需要重新打包。），请先更改版本号，并在打包完成后再次uploadIpa到服务器端记录，否则后续生成的相同版本的原生包会由于编译时间戳不一致而无法获取热更\n新。\n\n\nAndroid#\n\n首先参考文档-打包 APK设置签名，然后在 android 文件夹下运行./gradlew assembleRelease或./gradlew\naR，你就可以在android/app/build/outputs/apk/release/app-release.apk中找到你的应用包。\n\n然后运行如下命令\n\n\n\n即可上传 apk 以供后续版本比对之用。此 apk\n的versionName字段(位于android/app/build.gradle中)会被记录为原生版本号packageVersion。\n\n随后你可以选择往应用市场发布这个版本，也可以先往设备上直接安装这个 apk 文件以进行测试。\n\n如果后续需要再次打包（例如修改原生代码或配置。如果只是修改 js\n代码则不需要重新打包。），请先更改版本号，并再次uploadApk到服务器端记录，否则后续生成的相同版本的原生包会由于编译时间戳不一致而无法获取热更新。\n\n\nHarmony#\n\n首先下载鸿蒙开发IDE DevEco-Studio，然后通过Build => Build Hap(s)/App(s) => Build\nApp(s)，你就可以在harmony/build/outputs/default/harmony-default-unsigned.app中找到你的应用包。\n\n然后运行如下命令\n\n\n\n即可上传 app 以供后续版本比对之用。此 app\n的versionName字段(位于harmony/AppScope/app.json5中)会被记录为原生版本号packageVersion。\n\n随后你可以选择往华为应用市场发布这个版本，也可以先往设备上通过命令hdc shell命令安装这个 app 文件以进行测试。\n\n如果后续需要再次打包（例如修改原生代码或配置。如果只是修改 js\n代码则不需要重新打包。），请先更改版本号，并再次uploadApp到服务器端记录，否则后续生成的相同版本的原生包会由于编译时间戳不一致而无法获取热更新。\n\n\n发布热更新版本#\n\n你可以尝试修改一行代码(譬如将版本一修改为版本二)，然后使用pushy bundle --platform\n<ios|android|harmony>命令来生成新的热更新版本。\n\nINFO\n\n如果你使用了较新版本的expo或其他没有index.js的框架，执行bundle命令时会报错。此时请手动创建一个index.js文件，在其中引用框架自身的入口文\n件即可。具体入口文件的路径如何，请参考框架的说明文档或者package.json中的main字段。例如针对expo的index.js可能是如下这样写：\n\n\n\n\n\n如果想要立即上传，此时输入 Y。当然，你也可以在将来使用pushy publish --platform android\nbuild/output/android.1459850548545.ppk来上传刚才打包好的热更新包。\n\n\n\n此时版本已经提交到 pushy 服务，但用户暂时看不到此更新，你需要先将特定的原生包版本绑定到此热更新版本上。\n\n此时输入 Y 立即绑定，你也可以在将来使用pushy update --platform\n<ios|android|harmony>来对已上传的热更包和原生包进行绑定。除此以外，你还可以在网页端操作，简单的将对应的原生包版本拖到需要的热更新版本下即可\n。\n\n\n\n版本绑定完毕后，服务器会在几秒内生成差量补丁，客户端就可以获取到更新了。\n\n后续要继续发布新的热更新，只需反复执行pushy bundle命令即可，不需要重新打包。\n\n恭喜你，至此为止，你已经完成了植入代码热更新的全部工作。\n\n\n测试与回滚#\n\n请参考最佳实践中的测试与回滚章节。","routePath":"/docs/publish","lang":"","toc":[{"text":"发布原生基准版本","id":"发布原生基准版本","depth":2,"charIndex":542},{"text":"iOS","id":"ios","depth":3,"charIndex":554},{"text":"Android","id":"android","depth":3,"charIndex":1089},{"text":"Harmony","id":"harmony","depth":3,"charIndex":1511},{"text":"发布热更新版本","id":"发布热更新版本","depth":2,"charIndex":1955},{"text":"测试与回滚","id":"测试与回滚","depth":2,"charIndex":2643}],"domain":"","frontmatter":{"order":2,"title":"发布热更新","type":"快速入门"},"version":""},{"id":10,"title":"价格","content":"新注册用户将自动获得 7 天专业版 免费试用评估。到期后转为免费版。如需按月购买，请联系 QQ 客服 34731408。\n\n\n免费版#\n\n * 价格：￥0/年\n * 配额：\n   * 可创建 3 个应用（iOS 和 Android 记作不同应用）\n   * 原生包：30 个，每个最大 30M\n   * 热更包：30 个，每个最大 3M\n   * 更新检查：每天 1 千次（所有应用累加）\n\n开始使用\n\n\n标准版#\n\n * 价格：￥800/年（￥100/月）\n * 配额：\n   * 可创建 5 个应用\n   * 原生包：50 个，每个最大 150M\n   * 热更包：50 个，每个最大 15M\n   * 更新检查：每天 1 万次（所有应用累加）\n   * 提供专人技术支持\n\n立即升级\n\n\n高级版#\n\n * 价格：￥2400/年（￥300/月）\n * 配额：\n   * 可创建 10 个应用\n   * 原生包：60 个，每个最大 500M\n   * 热更包：60 个，每个最大 50M\n   * 更新检查：每天 10 万次（所有应用累加）\n   * 提供专人技术支持\n\n立即升级\n\n\n专业版#\n\n * 价格：￥7200/年（￥900/月）\n * 配额：\n   * 可创建 50 个应用\n   * 原生包：100 个，每个最大 2000M\n   * 热更包：100 个，每个最大 200M\n   * 更新检查：每天 100 万次（所有应用累加）\n   * 提供专人技术支持\n\n立即升级\n\n\n名词说明#\n\n * 应用：iOS 和 Android 版本记作不同应用。\n * 原生包：完整的 apk 或 ipa 安装包。\n * 热更包：pushy bundle 命令生成的 ppk 文件（不是用户实际下载的增量更新文件）。\n * 更新检查次数：指客户端向服务器发起更新检查请求的次数，与是否有新版本无关。\n\n如日更新检查次数超过 100 万次，请参考大客户方案。\n\n对于付费业务还有其他疑问？请参考常见问题。","routePath":"/pricing","lang":"","toc":[{"text":"免费版","id":"免费版","depth":2,"charIndex":62},{"text":"标准版","id":"标准版","depth":2,"charIndex":202},{"text":"高级版","id":"高级版","depth":2,"charIndex":346},{"text":"专业版","id":"专业版","depth":2,"charIndex":493},{"text":"名词说明","id":"名词说明","depth":2,"charIndex":645}],"domain":"","frontmatter":{"title":"价格"},"version":""}]